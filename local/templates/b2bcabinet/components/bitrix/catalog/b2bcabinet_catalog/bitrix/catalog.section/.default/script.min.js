"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,o){return t&&_defineProperties(e.prototype,t),o&&_defineProperties(e,o),e}$(document).on("click touchstart","button.add_to_cart",void 0,addToBasket),$(document).ready(function(){$(document).on("click touchstart","#blank-export-in-excel",this,excelOut)});var CatalogSection=function(){function e(t){_classCallCheck(this,e),this.selector=t,this.scrollEars={showAll:function(){for(var e=document.querySelectorAll(".index_blank .table-responsive .scroll-ears"),t=0;t<e.length;t++)e[t].style.display="flex"},hideAll:function(){for(var e=document.querySelectorAll(".index_blank .table-responsive .scroll-ears"),t=0;t<e.length;t++)e[t].style.display="none"},hideLeft:function(){var e=document.querySelector(".main-grid-ear-left");e.style.opacity="0",e.style.visibility="hidden"},hideRight:function(){var e=document.querySelector(".main-grid-ear-right");e.style.opacity="0",e.style.visibility="hidden"},showLeft:function(){var e=document.querySelector(".main-grid-ear-left");e.style.opacity="1",e.style.visibility="visible"},showRight:function(){var e=document.querySelector(".main-grid-ear-right");e.style.opacity="1",e.style.visibility="visible"}}}return _createClass(e,[{key:"relocateTableHeader",value:function(){for(var e=document.querySelector(this.selector),t=e.querySelector(".index_blank-thead"),o=t.querySelectorAll("th"),r=e.querySelector(".index_blank-thead_fixed"),i=0;i<o.length;i++){var l=document.createElement("div");l.innerText=o[i].innerText,l.style.display="inline-block",r.appendChild(l)}var n={hide:function(){t.style.opacity="0",t.style.visibility="hidden"},show:function(){t.style.opacity="1",t.style.visibility="visible"}};function s(){n.show();for(var e=r.querySelectorAll("div"),t=0;t<o.length;t++)e[t].style.width=o[t].offsetWidth+"px",e[t].style.height=o[t].offsetHeight+"px";n.hide()}n.hide(),s(),window.addEventListener("resize",s)}},{key:"setEarsTopPosition",value:function(){var e=document.querySelector(this.selector),t=e.querySelectorAll(".scroll-ears"),o=document.documentElement.clientHeight,r=e.querySelector(".anchor_header"),i=e.querySelector(".table-responsive").clientHeight,l=0;r&&(l=r.getBoundingClientRect().top);var n=l<0?o/2-l:(o-l)/2,s=100*(n=-l+o>i?(i+l)/2-l:n)/i;s<0?s=0:s>100&&(s=100);for(var a=0;a<t.length;a++)t[a].style.top=s+"%"}},{key:"showEars",value:function(){var e=document.querySelector(this.selector).querySelector(".datatable-scroll"),t=e.scrollWidth,o=e.clientWidth,r=e.scrollLeft;t-o>2?(this.scrollEars.showAll(),0===r?this.scrollEars.hideLeft():this.scrollEars.showLeft(),o+r===t?this.scrollEars.hideRight():this.scrollEars.showRight()):this.scrollEars.hideAll()}},{key:"setEventsIndexBlankTable",value:function(){var e,t=document.querySelector(this.selector),o=t.querySelector(".main-grid-ear-left"),r=t.querySelector(".main-grid-ear-right"),i=t.querySelector(".index_blank-table"),l=this;i&&t.querySelector(".index_blank-thead_fixed-wrapper")&&(t.querySelector(".index_blank-thead_fixed-wrapper").style.width=i.clientWidth+"px"),o.addEventListener("mouseover",function(){e=setInterval(function(){l.scrollTable("left")},.5)}),o.addEventListener("mouseout",function(){clearTimeout(e)}),r.addEventListener("mouseover",function(){e=setInterval(function(){l.scrollTable("right")},.5)}),r.addEventListener("mouseout",function(){clearTimeout(e)}),this.showEars()}},{key:"initPerfectScrols",value:function(){new PerfectScrollbar(".datatable-scroll",{wheelSpeed:.5,wheelPropagation:!0,minScrollbarLength:20,suppressScrollY:!0})}},{key:"setAddCartPosition",value:function(){var e=$(document).scrollTop(),t=0,o=0,r=document.querySelector(this.selector),i=r.querySelector(".index_blank-thead_fixed-wrapper");if(r.querySelector(".anchor_header")&&r.querySelector(".anchor")&&(o=$(this.selector+" .anchor_header").offset().top,t=$(this.selector+" .anchor").offset().top),o>e||t<e+80)i.classList.remove("thead_fixed-wrapper-fixed"),i.style.width="auto",i.style.height="auto",i.style.overflow="",r.querySelector(".index_blank-thead_fixed").style.left="0";else{i.classList.add("thead_fixed-wrapper-fixed");var l=document.querySelector(".index_blank-table"),n=r.querySelector(".index_blank-thead_fixed"),s=r.querySelector(".datatable-scroll"),a=r.querySelector(".table-responsive");i.style.width=l.clientWidth+"px",i.style.height=n.clientHeight+"px",i.style.overflow="hidden",s.addEventListener("scroll",this.scrollHeader.bind(this)),a.addEventListener("scroll",this.scrollHeader.bind(this)),this.scrollHeader()}}},{key:"scrollHeader",value:function(){var e=document.querySelector(this.selector),t=e.querySelector(".datatable-scroll"),o=e.querySelector(".table-responsive"),r=e.querySelector(".index_blank-thead_fixed"),i=o.scrollLeft,l=t.scrollLeft,n=Math.max(l,i);e.querySelector(".thead_fixed-wrapper-fixed")&&(r.style.left="-"+n+"px")}},{key:"scrollTable",value:function(e){var t=document.querySelector(this.selector).querySelector(".datatable-scroll");if(t.scrollWidth-t.clientWidth>2)switch(e){case"left":this.scrollTableLeft();break;case"right":this.scrollTableRight()}this.showEars()}},{key:"scrollTableLeft",value:function(){var e=document.querySelector(this.selector).querySelector(".datatable-scroll");0!==e.scrollLeft&&(e.scrollLeft=e.scrollLeft-5),this.showEars()}},{key:"scrollTableRight",value:function(){var e=document.querySelector(this.selector).querySelector(".datatable-scroll"),t=e.scrollWidth;e.clientWidth+e.scrollLeft<t&&(e.scrollLeft=e.scrollLeft+5),this.showEars()}},{key:"setRowUnderModificationsWidth",value:function(){var e=document.querySelector(this.selector),t=e.querySelector(".datatable-scroll");e.querySelector(".row-under-modifications").style.width=t.clientWidth+"px",this.setHeaderPosition()}},{key:"fixAddToCard",value:function(){var e=document.querySelector(this.selector),t=e.querySelector(".datatable-scroll");e.querySelector(".row-under-modifications").style.width=t.clientWidth+"px"}},{key:"setHeaderPosition",value:function(){var e;$(this.selector+" .row-under-modifications").length>0&&(e=$(this.selector+" .row-under-modifications").offset().top)>$(window).height()&&(e=$(window).height());var t=$(document).scrollTop(),o=$(this.selector+" .anchor").offset().top,r=$(this.selector+" .anchor_header").offset().top,i=$(this.selector+" .row-under-modifications").outerHeight();o<t+i+e||r+100>t+$(window).height()?($(this.selector+" .row-under-modifications").addClass("row-under-modifications-fixed"),$(this.selector+" .row-under-modifications").removeClass("fixed-add-cart-animation")):($(this.selector+" .row-under-modifications").removeClass("row-under-modifications-fixed"),$(this.selector+" .row-under-modifications").addClass("fixed-add-cart-animation"))}},{key:"init",value:function(){document.querySelector(this.selector).querySelector(".nothing_to_show")||(window.addEventListener("DOMContentLoaded",this.setEventsIndexBlankTable.bind(this)),window.addEventListener("DOMContentLoaded",this.fixAddToCard.bind(this)),window.addEventListener("DOMContentLoaded",this.initPerfectScrols.bind(this)),window.addEventListener("resize",this.setAddCartPosition.bind(this)),window.addEventListener("resize",this.showEars.bind(this)),window.addEventListener("resize",this.setRowUnderModificationsWidth.bind(this)),window.addEventListener("load",this.setAddCartPosition.bind(this)),window.addEventListener("load",this.relocateTableHeader.bind(this)),window.addEventListener("load",this.setEarsTopPosition.bind(this)),window.addEventListener("load",this.setHeaderPosition.bind(this)),window.addEventListener("scroll",this.setAddCartPosition.bind(this)),window.addEventListener("scroll",this.setEarsTopPosition.bind(this)),window.addEventListener("scroll",this.setHeaderPosition.bind(this)))}}]),e}();function addToBasket(){document.querySelector(".modal_add_to_bascket-preloader").style.display="flex",document.querySelector(".modal_add_to_bascket-on_success").style.display="none",document.querySelector(".modal_add_to_bascket-on_error").style.display="none";const e=document.querySelector(".modal_add_to_bascket-on_error"),t=e.querySelector("p.error-text");setTimeout(function(){$.ajax({type:"POST",url:site_path+"include/ajax/b2b_buy.php",data:{action:"add"},success:function(o){if("OK"===(o=JSON.parse(o)).STATUS){var r=$(".form-control.touchspin-empty");$.each(r,function(e,t){$(t).val(0)}),$(".cart_header a span:last-child").html(o.BASKET_ITEM_QNT),document.querySelector(".modal_add_to_bascket-on_success").style.display="block",document.querySelector(".modal_add_to_bascket-preloader").style.display="none"}else if("ERROR"===o.STATUS){if(o.MESSAGE)if(t)t.innerHTML=o.MESSAGE;else{let t=document.createElement("p");t.classList.add("error-text"),t.innerHTML=o.MESSAGE,e.append(t)}e.style.display="block",document.querySelector(".modal_add_to_bascket-preloader").style.display="none"}else e.style.display="block",document.querySelector(".modal_add_to_bascket-preloader").style.display="none"},error:function(){document.querySelector(".modal_add_to_bascket-on_error").style.display="block",document.querySelector(".modal_add_to_bascket-preloader").style.display="none"}})},15)}function setExcelOutIcon(e){document.querySelector(".export_excel_preloader > i").setAttribute("class",e)}function excelOut(){setExcelOutIcon("icon-spinner2 spinner` mr-2"),setTimeout(function(){var e="";if($.ajax({type:"POST",async:!1,url:site_path+"include/ajax/blank_excel_export.php",data:{table_header:tableHeader,filterProps:filterProps,priceCodes:priceCodes,file:e},success:function(t){if(void 0!==t&&""!==t)try{t=JSON.parse(t)}catch(e){}void 0!==t.TYPE?console.log(t.MESSAGE):void 0!==t&&""!==t&&(e=t)},complete:function(){setExcelOutIcon("icon-upload mr-2")}}),void 0!==e&&""!==e){var t=new Date,o=t.getDate();o<10&&(o="0"+o);var r=t.getMonth()+1;r<10&&(r="0"+r);var i=t.getHours();i<10&&(i="0"+i);var l=t.getMinutes();l<10&&(l="0"+l);var n=t.getSeconds();n<10&&(n="0"+n);var s=1e9*Math.random()-.5;s=Math.round(s);var a="blank_"+t.getFullYear()+"_"+r+"_"+o+"_"+i+"_"+l+"_"+n+"_"+s+".xlsx",d=document.createElement("a");d.setAttribute("href",e),d.setAttribute("download",a);var c=document.createEvent("MouseEvents");c.initMouseEvent("click",!0,!1,window,0,0,0,0,0,!1,!1,!1,!1,0,null),d.dispatchEvent(c)}},15)}function setExcelOutIconImport(e){for(var t=document.querySelectorAll("#mfi-mfiEXCEL_FILE-button > span > i"),o=0;o<t.length;o++)t[o].setAttribute("class",e)}BX.addCustomEvent("onUploadDone",function(e){""!==e.file_id&&void 0!==e.file_id&&(setExcelOutIconImport("icon-spinner2 spinner mr-2"),setTimeout(function(){$.ajax({type:"POST",async:!1,url:site_path+"include/ajax/blank_excel_import.php",data:{file_id:e.file_id,quantity:tableHeader.QUANTITY},success:function(e){if(void 0!==e&&"null"!==e&&""!==e){var t=JSON.parse(e),o=Object.keys(t).length;if(void 0===t.TYPE||"null"===t.TYPE||""===t.TYPE){var r=document.createElement("button");r.setAttribute("type","button"),r.setAttribute("class","modal_excel-import-btn"),r.setAttribute("data-toggle","modal"),r.setAttribute("data-target","#modal_excel-import");var i=document.createEvent("MouseEvents");i.initMouseEvent("click",!0,!1,window,0,0,0,0,0,!1,!1,!1,!1,0,null),document.body.append(r),r.dispatchEvent(i);var l=BX.message("TITLE_IMPORT_SUCCESSFUL");t.TOTAL_COUNT&&(o-=1),document.querySelector(".modal_excel-import_success h6").textContent=l.replace("#PRODUCTS#",o)}}else location.reload()},complete:function(){setExcelOutIconImport("icon-upload mr-2")}})},15))}),BX.ready(function(){const e=document.querySelector("#modal_excel-import");if(e){e.addEventListener("click",o);const r=e.querySelectorAll('[data-dismiss="modal"]');for(var t=0;t<r.length;t++)r[t].addEventListener("click",o)}function o(){location.reload()}});