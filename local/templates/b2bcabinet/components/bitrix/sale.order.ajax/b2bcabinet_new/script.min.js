function addControl(e){var t=e.id.split("[")[0],o=e.id.split("[")[1].replace("[","").replace("]",""),i=parseInt(o)+1,r=document.createElement("input");r.type="file",r.name=t+"["+i+"]",r.id=t+"["+i+"]",r.className="form-input-styled",r.onchange=function(){addControl(this)};var n=document.createElement("br");$(r).insertAfter(BX(e.id).parentNode),$(n).insertAfter(BX(e.id).parentNode),$(r).uniform()}BX.saleOrderAjax={BXCallAllowed:!1,options:{},indexCache:{},controls:{},modes:{},properties:{},init:function(e){var t=this;this.options=e,window.submitFormProxy=BX.proxy(function(){t.submitFormProxy.apply(t,arguments)},this),BX(function(){t.initDeferredControl()}),BX(function(){t.BXCallAllowed=!0}),this.controls.scope=BX("card"),BX.bindDelegate(this.controls.scope,"click",{className:"-bx-popup-set-mode-add-loc"},function(){var e=BX.create("input",{attrs:{type:"hidden",name:"PERMANENT_MODE_STEPS",value:"1"}});BX.prepend(e,BX("ORDER_FORM")),t.BXCallAllowed=!1,submitForm()}),BX.proxy("eventForRadiabattonLabele",this)},eventForRadiabattonLabele:function(){person_type_wripper=this.controls.scope.querySelector('[data-entity="person_type_wripper"]'),person_type_wripper&&Array.prototype.slice.call(person_type_wripper.querySelectorAll(".form-check-label")).forEach(function(e){var t=e.querySelector("input");e.addEventListener("click",function(e){t.click()})})},cleanUp:function(){for(var e in this.properties)this.properties.hasOwnProperty(e)&&(void 0!==this.properties[e].input&&(BX.unbindAll(this.properties[e].input),this.properties[e].input=null),void 0!==this.properties[e].control&&BX.unbindAll(this.properties[e].control));this.properties={}},addPropertyDesc:function(e){this.properties[e.id]=e.attributes,this.properties[e.id].id=e.id},initDeferredControl:function(){var e,t,o,i,r,n,s,p,l=this;if(void 0!==window.BX.locationsDeferred)for(k in this.BXCallAllowed=!1,window.BX.locationsDeferred)window.BX.locationsDeferred[k].call(this),window.BX.locationsDeferred[k]=null,delete window.BX.locationsDeferred[k],this.properties[k].control=window.BX.locationSelectors[k],delete window.BX.locationSelectors[k];for(let a in this.properties){if(this.properties[a].isZip&&(e=this.controls.scope.querySelector('[data-property-id-row="'+a+'"]'),BX.type.isElementNode(e)&&(t=e.querySelector('input[type="text"]'),BX.type.isElementNode(t)))){for(i in this.properties[a].input=t,o=!1,this.properties)if("LOCATION"===this.properties[i].type){o=i;break}!1!==o&&BX.bindDebouncedChange(t,function(i){t=null,e=null,BX.type.isNotEmptyString(i)&&/^\s*\d+\s*$/.test(i)&&i.length>3&&l.getLocationByZip(i,function(e){l.properties[o].control.setValueByLocationId(e)},function(){try{l.properties[o].control.clearSelected(locationId)}catch(e){}})})}"LOCATION"===this.properties[a].type&&void 0!==this.properties[a].control&&(n=(r=this.properties[a].control).getSysCode(),void 0!==this.properties[a].altLocationPropId&&("sls"===n&&r.replaceTemplate("nothing-found",this.options.messages.notFoundPrompt),"slst"===n&&function(e,t){t.setOption("pseudoValues",["other"]),t.bindEvent("control-before-display-page",function(e){t=null;var o=e.getParentValue();if(o!=this.getOption("rootNodeValue")&&this.checkCanSelectItem(o)){var i=e.getControl();void 0===i.vars.cache.nodes.other&&i.fillCache([{CODE:"other",DISPLAY:l.options.messages.otherLocation,IS_PARENT:!1,VALUE:"other"}],{modifyOrigin:!0,modifyOriginPosition:"prepend"})}}),s=BX("LOCATION_ALT_PROP_DISPLAY_MANUAL["+parseInt(e)+"]"),t.bindEvent("after-select-real-value",function(){BX.type.isDomNode(s)&&(s.value="0")}),t.bindEvent("after-select-pseudo-value",function(){BX.type.isDomNode(s)&&(s.value="1")}),t.bindEvent("before-set-value",function(){BX.type.isDomNode(s)&&(s.value="0")}),BX.type.isDomNode(s)&&"1"==s.value&&null!=(p=t.getAdapterAtPosition(t.getStackSize()-1))&&p.setValuePair("other",l.options.messages.otherLocation)}(a,r)))}this.BXCallAllowed=!0},checkMode:function(e,t){if("altLocationChoosen"==t&&this.checkAbility(e,"canHaveAltLocation")){var o=this.getInputByPropId(this.properties[e].altLocationPropId),i=this.properties[e].altLocationPropId;if(!1!==o&&o.value.length>0&&!o.disabled&&"default"!=this.properties[i].valueSource)return!0}return!1},checkAbility:function(e,t){if(void 0===this.properties[e]&&(this.properties[e]={}),void 0===this.properties[e].abilities&&(this.properties[e].abilities={}),void 0!==this.properties[e].abilities&&this.properties[e].abilities[t])return!0;if("canHaveAltLocation"===t&&"LOCATION"===this.properties[e].type&&void 0!==this.properties[e].altLocationPropId&&(this.properties[this.properties[e].altLocationPropId],1)){var o=this.properties[e].altLocationPropId;if(void 0!==this.properties[e].control&&"slst"===this.properties[e].control.getSysCode()&&!1!==this.getInputByPropId(o))return this.properties[e].abilities[t]=!0,!0}return!1},getInputByPropId:function(e){if(this.properties[e].input)return this.properties[e].input;var t=this.getRowByPropId(e);if(BX.type.isElementNode(t)){var o=t.querySelector('input[type="text"]');if(BX.type.isElementNode(o))return this.properties[e].input=o,o}return!1},getRowByPropId:function(e){if(this.properties[e].row)return this.properties[e].row;var t=this.controls.scope.querySelector('[data-property-id-row="'+e+'"]');return!!BX.type.isElementNode(t)&&(this.properties[e].row=t,t)},getAltLocPropByRealLocProp:function(e){return!!this.properties[e].altLocationPropId&&this.properties[this.properties[e].altLocationPropId]},toggleProperty:function(e,t,o){var i=this.properties[e];i.row&&(i.row=this.getRowByPropId(e)),i.input&&(i.input=this.getInputByPropId(e)),t?(o||BX.show(i.row),i.input.disabled=!1):(o||BX.hide(i.row),i.input.disabled=!0)},submitFormProxy:function(e,t){for(var o in this.properties)if(void 0!==this.properties[o].control&&this.properties[o].control==t){o;break}"other"!==e&&this.BXCallAllowed&&(this.BXCallAllowed=!1,submitForm())},getPreviousAdapterSelectedNode:function(e,t){var o=t.getIndex(),i=e.getAdapterAtPosition(o-1);if(void 0!==i&&null!=i){var r=i.getControl().getValue();if(void 0!==r){var n=e.getNodeByValue(r);return void 0!==n&&n}}return!1},getLocationByZip:function(e,t,o){if(void 0===this.indexCache[e]){ShowWaitWindow();var i=this;BX.ajax({url:this.options.source,method:"post",dataType:"json",async:!0,processData:!0,emulateOnload:!0,start:!0,data:{ACT:"GET_LOC_BY_ZIP",ZIP:e},onsuccess:function(r){CloseWaitWindow(),r.result?(i.indexCache[e]=r.data.ID,t.apply(i,[r.data.ID])):o.call(i)},onfailure:function(e,t){CloseWaitWindow()}})}else t.apply(this,[this.indexCache[e]])}};