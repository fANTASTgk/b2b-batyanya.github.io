class JCSmartFilter{constructor(e,t,i){this.ajaxURL=e,this.form=null,this.timer=null,this.cacheKey="",this.cache=[],this.popups=[],this.viewMode=t,this.inputValues=[],this.params=i,i&&i.SEF_SET_FILTER_URL&&(this.bindUrlToButton("set_filter",i.SEF_SET_FILTER_URL),this.sef=!0),i&&i.SEF_DEL_FILTER_URL&&this.bindUrlToButton("del_filter",i.SEF_DEL_FILTER_URL)}keyup(e){this.timer&&clearTimeout(this.timer),this.timer=setTimeout(BX.delegate((function(){this.reload(e)}),this),500)}click(e){this.timer&&clearTimeout(this.timer),this.timer=setTimeout(BX.delegate((function(){this.reload(e)}),this),500)}reload(e){if(""!==this.cacheKey)return this.timer&&clearTimeout(this.timer),void(this.timer=setTimeout(BX.delegate((function(){this.reload(e)}),this),1e3));if(this.cacheKey="|",this.position=BX.pos(e,!0),this.form=BX.findParent(e,{tag:"form"}),this.form){var t=[];t[0]={name:"ajax",value:"y"},this.gatherInputsValues(t,BX.findChildren(this.form,{tag:new RegExp("^(input|select)$","i")},!0)),this.inputValues=[];for(let e in t)if(-1!=t[e].name.indexOf("arrFilter")){var i=t[e].name;"Y"!=t[e].value&&""!=t[e].value&&-1==t[e].name.indexOf("MIN")&&-1==t[e].name.indexOf("MAX")&&(i+="_"+t[e].value),this.inputValues[i]=t[e].value}for(var r=0;r<t.length;r++)this.cacheKey+=t[r].name+":"+t[r].value+"|";if(this.cache[this.cacheKey])this.curFilterinput=e,this.postHandler(this.cache[this.cacheKey],!0);else{if(this.sef)BX("set_filter").disabled=!0;this.curFilterinput=e,BX.ajax.loadJSON(this.ajaxURL,this.values2post(t),BX.delegate(this.postHandler,this))}if(e.dataset.type&&"section"===e.dataset.type){let e=document.createElement("input");e.value=BX.message("form_submit"),e.name="set_filter",e.type="hidden",this.form.appendChild(e),this.form.submit()}}}updateItem(e,t){if("N"===t.PROPERTY_TYPE||t.PRICE){var i=window["trackBar"+e];!i&&t.ENCODED_ID&&(i=window["trackBar"+t.ENCODED_ID]),i&&t.VALUES&&(t.VALUES.MIN&&(t.VALUES.MIN.FILTERED_VALUE?i.setMinFilteredValue(t.VALUES.MIN.FILTERED_VALUE):i.setMinFilteredValue(t.VALUES.MIN.VALUE)),t.VALUES.MAX&&(t.VALUES.MAX.FILTERED_VALUE?i.setMaxFilteredValue(t.VALUES.MAX.FILTERED_VALUE):i.setMaxFilteredValue(t.VALUES.MAX.VALUE)))}else if(t.VALUES)for(var r in t.VALUES)if(t.VALUES.hasOwnProperty(r)){var n=t.VALUES[r];BX(n.CONTROL_ID)}}postHandler(e,t){var i,r,n,a=BX("modef"),s=BX("modef_num");if(e&&e.ITEMS){for(var o in this.popups)this.popups.hasOwnProperty(o)&&this.popups[o].destroy();for(var l in this.popups=[],e.ITEMS)e.ITEMS.hasOwnProperty(l)&&this.updateItem(l,e.ITEMS[l]);for(var c in a&&s&&(s.innerHTML=e.ELEMENT_COUNT,i=BX.findChildren(a,{tag:"A",class:"set_filter"},!0),e.FILTER_URL&&i&&(i[0].href=BX.util.htmlspecialcharsback(e.FILTER_URL)),e.FILTER_AJAX_URL&&e.COMPONENT_CONTAINER_ID&&(BX.unbindAll(i[0]),BX.bind(i[0],"click",(function(t){return r=BX.util.htmlspecialcharsback(e.FILTER_AJAX_URL),BX.ajax.insertToNode(r,e.COMPONENT_CONTAINER_ID),BX.PreventDefault(t)}))),e.COMPONENT_CONTAINER_ID?(r=BX.util.htmlspecialcharsback(e.FILTER_AJAX_URL),BX.ajax.insertToNode(r,e.COMPONENT_CONTAINER_ID)):("none"===a.style.display&&(a.style.display="inline-block"),"VERTICAL"==this.viewMode&&(n=BX.findChild(BX.findParent(this.curFilterinput,{class:"bx_filter_parameters_box"}),{class:"bx_filter_container_modef"},!0,!1))&&n.appendChild(a),e.SEF_SET_FILTER_URL&&this.bindUrlToButton("set_filter",e.SEF_SET_FILTER_URL))),e.ITEMS){var u=e.ITEMS[c];for(var h in u.VALUES)this.inputValues.hasOwnProperty(u.VALUES[h].CONTROL_ID)&&(this.inputValues[u.VALUES[h].CONTROL_ID]="MIN"!=h&&"MAX"!=h?u.VALUES[h].VALUE:BX.Currency.currencyFormat(u.VALUES[h].HTML_VALUE,u.VALUES[h].CURRENCY,!0))}}this.sef&&(BX("set_filter").disabled=!1);t||""===this.cacheKey||(this.cache[this.cacheKey]=e),this.cacheKey=""}bindUrlToButton(e,t){var i,r,n=BX(e);if(n){"submit"===n.type&&(n.type="button"),BX.bind(n,"click",(i=t,r=function(e){return window.location.href=e,!1},function(){return r(i)}))}}gatherInputsValues(e,t){if(t)for(var i=0;i<t.length;i++){var r=t[i];if(!r.disabled&&r.type)switch(r.type.toLowerCase()){case"text":case"textarea":case"password":case"hidden":case"select-one":r.value.length&&(e[e.length]={name:r.name,value:r.value});break;case"radio":case"checkbox":r.checked&&(e[e.length]={name:r.name,value:r.value});break;case"select-multiple":for(var n=0;n<r.options.length;n++)r.options[n].selected&&(e[e.length]={name:r.name,value:r.options[n].value});break;default:break}}}values2post(e){for(var t=[],i=t,r=0,n="",a=/arrFilter[\w\d]+/;r<e.length;){var s=e[r].name.indexOf("[");if(-1===s)i[e[r].name]=e[r].value,i=t,r++;else{var o=e[r].name.substring(0,s),l=e[r].name.substring(s+1);i[o]||(i[o]=[]);var c=l.indexOf("]");-1===c?(i=t,r++):0===c?(i=i[o],e[r].name=""+i.length):(i=i[o],e[r].name=l.substring(0,c)+l.substring(c+1))}this.params.INSTANT_RELOAD&&r!==e.length&&e[r].name&&a.test(e[r].name)&&(""===n&&(n=location.origin+location.pathname+"?set_filter=Y&"),n+=e[r].name+"="+e[r].value,r!==e.length-1&&(n+="&"))}return this.params.INSTANT_RELOAD&&a.test(n)?history.pushState({},null,n):this.params.INSTANT_RELOAD&&history.pushState({},null,location.origin+location.pathname),t}hideFilterProps(e){var t=e.parentNode,i=t.querySelector("[data-role='bx_filter_block']"),r=t.querySelector("[data-role='prop_angle']");if(mql.matches){var n=$(i);n.find(".checkboxes_with_pictures").length&&n.find(".checkboxes_with_pictures span.bx-color-sl").each((function(e,t){$(this).after('<span class="color_value">'+$(this).find("span.bx-filter-btn-color-icon").attr("title")+"</span>")})),n.prepend('<div class="properties_block_title"><span>'+$(e).find("span.item_name").text()+"</span></div>").show("slide",{direction:"right"})}else if(BX.hasClass(t,"active"))new BX.easing({duration:300,start:{opacity:1,height:i.offsetHeight},finish:{opacity:0,height:0},step:function(e){i.style.opacity=e.opacity,i.style.height=e.height+"px"},complete:function(){i.setAttribute("style",""),BX.removeClass(t,"active")}}).animate(),BX.addClass(r,"fa-angle-down"),BX.removeClass(r,"fa-angle-up");else{i.style.display="block",i.style.opacity=0,i.style.height="auto";var a=i.offsetHeight;i.style.height=0,new BX.easing({duration:300,start:{opacity:0,height:0},finish:{opacity:1,height:a},step:function(e){i.style.opacity=e.opacity,i.style.height=e.height+"px"},complete:function(){}}).animate(),BX.addClass(t,"active"),BX.removeClass(r,"fa-angle-down"),BX.addClass(r,"fa-angle-up")}}showDropDownPopup(e,t){var i=e.querySelector('[data-role="dropdownContent"]');this.popups["smartFilterDropDown"+t]=BX.PopupWindowManager.create("smartFilterDropDown"+t,e,{autoHide:!0,offsetLeft:0,offsetTop:3,overlay:!1,draggable:{restrict:!0},closeByEsc:!0,content:BX.clone(i),className:"smartFilter-property-list"}),this.popups["smartFilterDropDown"+t].show()}selectDropDownItem(e){return void this.keyup(BX(e));BX.findParent(BX(controlId),{className:"bx-filter-select-container"},!1).querySelector('[data-role="currentOption"]').innerHTML=e.innerHTML,BX.PopupWindowManager.getCurrentPopup().close()}}function searchfieldRefresh(){$(".bx_filter_parameters_box").each((function(e,t){$(this).find(".find_property_value").length&&filterList($(this).find(".find_property_value"),$(this).find(".blank_ul_wrapper"))}))}function filterList(e,t){$(e).change((function(){var i=$(e).val();return i?($matches=$(t).find("label:Contains("+i+")").parent(),$(".bx_filter_parameters_box_checkbox",t).not($matches).slideUp(),$matches.slideDown()):$(t).find(".bx_filter_parameters_box_checkbox").slideDown(),!1})).keyup((function(){$(this).change()}))}function setState(){let e=document.querySelector(".bx_filter").querySelectorAll(".bx_filter_parameters_box"),t=[],i=JSON.stringify(t);for(let i=0;e.length>i;i++){var r={};r.state=e[i].getAttribute("class"),r.dataPropid=e[i].getAttribute("data-propid"),t.push(r)}window.sessionStorage.setItem("item",i)}function getState(){if(window.sessionStorage.getItem("item"))for(var e=JSON.parse(window.sessionStorage.getItem("item")),t=document.querySelector(".bx_filter"),i=0;e.length>i;i++){var r='[data-propid ="'+e[i].dataPropid+'"]',n=e[i].state,a=t.querySelector(r);a&&(a.removeAttribute("class"),a.setAttribute("class",n))}}function setItemsCheckboxesEvents(){let e=document.querySelectorAll(".catalog_section");for(let r=0;r<e.length;r++){let n=e[r].querySelector("a > .form-check input"),a=e[r].querySelectorAll("ul > .nav-item");const s=r;n.addEventListener("click",(function(){t(e[s])}));for(let t=0;t<a.length;t++)a[t].addEventListener("click",(function(){i(e[s])})),i(e[s])}function t(e){let t=e.querySelectorAll(".nav-group-sub .nav-item .form-check .form-check-label .uniform-checker > span");for(let i=0;i<t.length;i++){let r=t[i].querySelector("input");e.querySelector("a > .form-check input").checked?(e.querySelector("a > .form-check .uniform-checker").setAttribute("indeterminate","false"),t[i].classList.add("checked"),r.checked=!0):(t[i].classList.remove("checked"),r.checked=!1)}}function i(e){let t=e.querySelectorAll(".nav-group-sub .nav-item .form-check .form-check-label .uniform-checker > span"),i=0;for(let e=0;e<t.length;e++)t[e].querySelector("input").checked&&i++;t.length===i?(e.querySelector("a > .form-check .uniform-checker").setAttribute("indeterminate","false"),e.querySelector("a > .form-check input").classList.add("checked"),e.querySelector("a > .form-check span").classList.add("checked"),e.querySelector("a > .form-check input").checked=!0):i>0?(e.querySelector("a > .form-check span").classList.remove("checked"),e.querySelector("a > .form-check input").classList.remove("checked"),e.querySelector("a > .form-check .uniform-checker").setAttribute("indeterminate","true"),e.querySelector("a > .form-check input").checked=!1):(e.querySelector("a > .form-check input").classList.remove("checked"),e.querySelector("a > .form-check span").classList.remove("checked"),e.querySelector("a > .form-check .uniform-checker").setAttribute("indeterminate","false"))}}function selectSize(e){BX.toggleClass(e,"border-text-warning");let t=e.parentElement,i=t.querySelector("input").getAttribute("id"),r=t.querySelector("label");smartFilter.keyup(BX(i)),BX.toggleClass(r,"bx-active")}function fixFilterButtons(){function e(){if(document.querySelector(".row-under-modifications-filter")){let e=$(".row-under-modifications-filter").offset().top,t=document.querySelector(".row-under-modifications-filter");e>window.innerHeight&&(e=window.innerHeight);let i=window.pageYOffset,r=document.querySelector(".anchor_filter").getBoundingClientRect().top+window.pageYOffset,n=document.querySelector(".anchor_header_filter").getBoundingClientRect().top+window.pageYOffset,a=t.offsetHeight;r<i+a+e||n+100>i+$(window).height()?(t.classList.add("row-under-modifications-filter-fixed"),t.classList.remove("fixed-add-cart-animation")):(t.classList.remove("row-under-modifications-filter-fixed"),t.classList.add("fixed-add-cart-animation"))}}window.addEventListener("scroll",e),window.addEventListener("resize",(function(){let t=document.querySelector(".index_blank-filter");document.querySelector(".row-under-modifications-filter").style.width=t.clientWidth-2+"px",e()})),e()}function setPerfectScrolls(){return;const e=[];let t=document.querySelectorAll(".perfectscroll");for(let i=0;i<t.length;i++)e[i]=new PerfectScrollbar(t[i],{wheelSpeed:.5,wheelPropagation:!0,minScrollbarLength:20})}BX.namespace("BX.Iblock.SmartFilter"),BX.Iblock.SmartFilter=function(){var e=function(e){"object"==typeof e&&(this.containerSlider=BX(e.containerSlider),this.tracker=BX(e.tracker),this.trackerWrap=BX(e.trackerWrap),this.minInput=BX(e.minInputId),this.maxInput=BX(e.maxInputId),this.minPrice=parseFloat(e.minPrice),this.maxPrice=parseFloat(e.maxPrice),this.curMinPrice=parseFloat(e.curMinPrice),this.curMaxPrice=parseFloat(e.curMaxPrice),this.fltMinPrice=e.fltMinPrice?parseFloat(e.fltMinPrice):parseFloat(e.curMinPrice),this.fltMaxPrice=e.fltMaxPrice?parseFloat(e.fltMaxPrice):parseFloat(e.curMaxPrice),this.precision=e.precision||0,this.priceDiff=this.maxPrice-this.minPrice,this.leftPercent=0,this.rightPercent=0,this.fltMinPercent=0,this.fltMaxPercent=0,this.filParamsFrom=e.FROM,this.isTouch=!1,this.init(),BX.bind(this.minInput,"keyup",BX.proxy((function(e){this.onInputChange()}),this)),BX.bind(this.maxInput,"keyup",BX.proxy((function(e){this.onInputChange()}),this)))};return e.prototype.init=function(){var e;this.curMinPrice>this.minPrice&&(e=this.curMinPrice-this.minPrice,this.leftPercent=100*e/this.priceDiff),this.setMinFilteredValue(this.fltMinPrice),this.curMaxPrice<this.maxPrice&&(e=this.maxPrice-this.curMaxPrice,this.rightPercent=100*e/this.priceDiff),this.setMaxFilteredValue(this.fltMaxPrice),void 0===this.containerSlider.noUiSlider&&noUiSlider.create(this.containerSlider,{start:[this.curMinPrice||this.fltMinPrice,this.curMaxPrice||this.fltMaxPrice],behaviour:"drag",step:1,connect:!0,range:{min:this.fltMinPrice,max:this.fltMaxPrice}}),this.containerSlider.noUiSlider.on("change",function(e,t){t?(this.maxInput.value=Math.round(e[t]),smartFilter.keyup(this.maxInput)):(this.minInput.value=Math.round(e[t]),smartFilter.keyup(this.minInput))}.bind(this))},e.prototype.setMinFilteredValue=function(e){if(this.fltMinPrice=parseFloat(e),this.fltMinPrice>=this.minPrice){var t=this.fltMinPrice-this.minPrice;this.fltMinPercent=100*t/this.priceDiff}},e.prototype.setMaxFilteredValue=function(e){if(this.fltMaxPrice=parseFloat(e),this.fltMaxPrice<=this.maxPrice){var t=this.maxPrice-this.fltMaxPrice;this.fltMaxPercent=100*t/this.priceDiff}},e.prototype.getXCoord=function(e){var t=e.getBoundingClientRect(),i=document.body,r=document.documentElement,n=window.pageXOffset||r.scrollLeft||i.scrollLeft,a=r.clientLeft||i.clientLeft||0,s=t.left+n-a;return Math.round(s)},e.prototype.getPageX=function(e){e=e||window.event;var t=null;if(this.isTouch&&null!=event.targetTouches[0])t=e.targetTouches[0].pageX;else if(null!=e.pageX)t=e.pageX;else if(null!=e.clientX){var i=document.documentElement,r=document.body;t=e.clientX+(i.scrollLeft||r&&r.scrollLeft||0),t-=i.clientLeft||0}return t},e.prototype.recountMinPrice=function(){var e=this.priceDiff*this.leftPercent/100;(e=(this.minPrice+e).toFixed(this.precision))!=this.minPrice?this.minInput.value=e:this.minInput.value="",smartFilter.keyup(this.minInput)},e.prototype.recountMaxPrice=function(){var e=this.priceDiff*this.rightPercent/100;(e=(this.maxPrice-e).toFixed(this.precision))!=this.maxPrice?this.maxInput.value=e:this.maxInput.value="",smartFilter.keyup(this.maxInput)},e.prototype.onInputChange=function(){this.moveSlider()},e.prototype.moveSlider=function(){this.containerSlider.noUiSlider.updateOptions({start:[this.minInput.value||this.fltMinPrice,this.maxInput.value||this.fltMaxPrice]})},e.prototype.delay=function(e){timer&&clearTimeout(timer),timer=setTimeout(e.bind(this),500)},e}(),$(document).ready((function(){let e=document.querySelectorAll(".bx_filter .bx_filter_parameters_box");for(let t=0;e.length>t;t++){const i=e[t].querySelector(".find_property_value_wrapper"),r=e[t].querySelector(".find_property_value"),n=e[t].querySelectorAll(".bx_filter_parameters_box_checkbox"),a=e[t].querySelector(".find_property_value__button-search"),s=e[t].querySelector(".find_property_value__button-close"),o=e[t].querySelectorAll(".form-check-label"),l=new Event("input");let c;if(i&&n.length>7&&(i.style.display="block",a.addEventListener("click",(function(e){e.preventDefault(),r.focus(),a.style.display="none",s.style.display="flex"})),s.addEventListener("mousedown",(function(e){e.preventDefault(),r.focus(),a.style.display="flex",s.style.display="none",r.value="",r.dispatchEvent(l),r.blur()})),r.addEventListener("focus",(function(){a.style.display="none",s.style.display="flex"})),r.addEventListener("blur",(function(){a.style.display="flex",s.style.display="none"})),o)){let e=Array.prototype.slice.call(o);r.addEventListener("input",(function(){c=new RegExp(r.value,"i"),e.forEach((function(e){c.test(e.textContent)?e.parentNode.style.display="block":e.parentNode.style.display="none"}))}))}e[t].addEventListener("click",(function(){setTimeout(setState,2e3)}))}})),window.addEventListener("DOMContentLoaded",(function(){getState(),setPerfectScrolls()})),$(document).ready(setItemsCheckboxesEvents),window.addEventListener("load",(function(){fixFilterButtons()}));