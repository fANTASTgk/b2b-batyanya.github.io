var allGagdgetHoldersSC=[];function getGadgetHolderSC(t){return allGagdgetHoldersSC[t]}function SCGadget(gadgetHolderID,allGadgets){var _this=this;if(BX.addCustomEvent("onAjaxFailure",(function(t){"auth"==t&&(top.location=top.location.href)})),_this.gadgetHolderID=gadgetHolderID,_this.allGadgets=allGadgets,allGagdgetHoldersSC[_this.gadgetHolderID]=_this,_this.menuItems=[],void 0!==arGDGroups)for(var gr_id in arGDGroups){if(arGDGroups.hasOwnProperty(gr_id)){var items=[];for(var _gid in arGDGroups[gr_id].GADGETS)if(arGDGroups[gr_id].GADGETS.hasOwnProperty(_gid)){var gid=arGDGroups[gr_id].GADGETS[_gid];for(var i in _this.allGadgets)if(_this.allGadgets[i].ID.toUpperCase()==gid.toUpperCase()){_this.allGadgets[i].ONCLICK="getGadgetHolderSC('"+_this.gadgetHolderID+"').Add('"+_this.allGadgets[i].ID+"')",items[items.length]=_this.allGadgets[i];break}}}_this.menuItems[gr_id]={ID:gr_id,TEXT:'<div class="widget_button"><div class="widgets_cabinet_title">'+arGDGroups[gr_id].NAME+'</div><div class="widgets_cabinet_descr">'+arGDGroups[gr_id].DESCRIPTION+"</div></div>",MENU:items}}_this.gdList=Array(),_this.gdCols=Array(),_this.__GDList=function(){_this.gdList=Array(),_this.gdCols=Array();var t,e,i,s,a=document.getElementById("GDHolder_"+_this.gadgetHolderID).children;for(s=0;s<a.length;s++)if("s"==a[s].id.substring(0,1)){for(i in e=Array(),t=a[s].childNodes)if(t.hasOwnProperty(i)){if(!t[i])continue;!t[i].tagName||"TABLE"!=t[i].tagName.toUpperCase()&&"DIV"!=t[i].tagName.toUpperCase()||"t"!=t[i].id.substring(0,1)||(e[e.length]=t[i])}_this.gdList[_this.gdCols.length]=e,a[s].realPos=jsUtils.GetRealPos(a[s]),_this.gdCols[_this.gdCols.length]=a[s]}},_this.gdDrag=!1,_this.mousePos={x:0,y:0},_this.zind=0,_this.tmpDiv=!1,_this.DragStart=function(t,e){if(e){if(e.srcElement&&"a"==e.srcElement.tagName.toLowerCase())return!1;if(e.originalTarget&&"a"==e.originalTarget.tagName.toLowerCase())return!1}_this.__GDList();var i=BX("t"+t),s=jsUtils.GetRealPos(i),a=BX("d"+t);return a.style.display="block",a.width=i.offsetWidth+"px",a.style.height=i.offsetHeight+"px",i.style.position="absolute",i.style.width=a.offsetWidth+"px",i.style.height=a.offsetHeight+"px",i.style.border="1px solid var(--grey-800)",i.style.borderRadius="calc(var(--border-radius) * 2)",_this.zind=i.style.zIndex,i.style.zIndex="10000",i.style.left=s.left+20+"px",i.style.top=s.top+"px",i.style.MozOpacity=.6,i.style.opacity=.6,i.style.filter="gray() alpha(opacity=60)",_this.gdDrag=t,_this.tmpDiv=document.createElement("DIV"),_this.tmpDiv.style.display="none",_this.tmpDiv.innerHTML="",i.parentNode.insertBefore(_this.tmpDiv,i),document.body.appendChild(i),_this.mousePos.x=e.clientX+document.body.scrollLeft,_this.mousePos.y=e.clientY+document.body.scrollTop,"function"==typeof changeWidgetWidth&&changeWidgetWidth(),!1},_this.onMouseMove=function(t){if(!1!==_this.gdDrag){var e=document.getElementById("t"+_this.gdDrag),i=t.clientX+document.body.scrollLeft,s=t.clientY+document.body.scrollTop;e.style.left=parseInt(e.style.left)+i-_this.mousePos.x+"px",e.style.top=parseInt(e.style.top)+s-_this.mousePos.y+"px";var a,d,n,o=jsUtils.GetRealPos(e),r=!1,l=o.left+(o.right-o.left)/2,g=o.top+(o.bottom-o.top)/2;for(d=0;d<_this.gdCols.length;d++)if((a=_this.gdCols[d].realPos).left<=l&&a.right>=l){for(n in _this.gdList[d])if(_this.gdList[d].hasOwnProperty(n)&&g<(_this.gdList[d][n].id==e.id?jsUtils.GetRealPos(document.getElementById("d"+_this.gdDrag)):jsUtils.GetRealPos(_this.gdList[d][n])).bottom){r=_this.gdList[d][n],_this.gdList[d][n].id==e.id?document.getElementById("d"+_this.gdDrag).parentNode.insertBefore(_this.tmpDiv,document.getElementById("d"+_this.gdDrag)):r.parentNode.insertBefore(_this.tmpDiv,r);break}r||(r="last");break}if(r){var c=document.getElementById("d"+_this.gdDrag);c.parentNode.removeChild(c),"last"==r?_this.gdCols[d].appendChild(c):_this.tmpDiv.parentNode.insertBefore(c,_this.tmpDiv)}_this.mousePos.x=i,_this.mousePos.y=s,"function"==typeof changeWidgetWidth&&changeWidgetWidth()}},_this.onMouseUp=function(t){if(!1!==_this.gdDrag){var e=BX("t"+_this.gdDrag);e.style.MozOpacity=1,e.style.opacity=1,e.style.filter="",e.style.position="static",e.style.border="0px",e.style.width="",e.style.height="",e.style.zIndex=_this.zind;var i=BX("d"+_this.gdDrag);i.style.display="none",e.parentNode.removeChild(e),i.parentNode.insertBefore(e,i),_this.gdDrag=!1,_this.tmpDiv.parentElement.removeChild(_this.tmpDiv),_this.sendWait||(_this.sendWait=!0,setTimeout("getGadgetHolderSC('"+_this.gadgetHolderID+"').SendUpdatedInfo();",1e3)),"function"==typeof changeWidgetWidth&&changeWidgetWidth()}},_this.GetPosString=function(){var t,e,i,s=document.getElementById("GDHolder_"+_this.gadgetHolderID).children,a="",d=-1,n=0;for(i=0;i<s.length;i++)if("s"==s[i].id.substring(0,1))for(e in d++,n=0,t=s[i].childNodes)if(t.hasOwnProperty(e)){if(!t[e])continue;!t[e].tagName||"TABLE"!=t[e].tagName.toUpperCase()&&"DIV"!=t[e].tagName.toUpperCase()||"t"!=t[e].id.substring(0,1)||(a=a+"&POS["+d+"]["+n+"]="+encodeURIComponent(t[e].id.substring(1))+(null!=t[e].querySelector(".card-collapsed")?"*H":""),n++)}return a},_this.GetPos=function(){const t=document.getElementById("GDHolder_"+_this.gadgetHolderID).children;let e,i,s;const a=[];let d=-1,n=0;for(s=0;s<t.length;s++)if("s"==t[s].id.substring(0,1))for(i in d++,n=0,e=t[s].childNodes,e)if(e.hasOwnProperty(i)){if(!e[i])continue;!e[i].tagName||"TABLE"!=e[i].tagName.toUpperCase()&&"DIV"!=e[i].tagName.toUpperCase()||"t"!=e[i].id.substring(0,1)||(void 0===a[d]&&(a[d]=[]),a[d][n]=e[i].id.substring(1)+(null!=e[i].querySelector(".card-collapsed")?"*H":""),n++)}return a.length?a:[[0]]},_this.SendUpdatedInfo=function(t){t=t||"update_position",_this.sendUpdate||!1!==_this.gdDrag?setTimeout("getGadgetHolderSC('"+_this.gadgetHolderID+"').SendUpdatedInfo('"+t+"');",500):(_this.sendUpdate=!0,_this.sendWait=!1,BX.ajax({url:updateURL,method:"POST",dataType:"html",data:{sessid:BX.bitrix_sessid(),gd_ajax:_this.gadgetHolderID,gd_ajax_action:t,POS:_this.GetPos()},onsuccess:function(e){_this.sendUpdate=!1,"clear_settings"==t&&(window.location=window.location)},onfailure:function(t){_this.sendUpdate=!1,alert(langGDError1)}}))},_this.Add=function(t){var e=document.getElementById("GDHolderForm_"+_this.gadgetHolderID);e.gid.value=t,e.action.value="add",BX.showWait(),BX.ajax({url:e.getAttribute("action"),method:"POST",data:Object.fromEntries(new FormData(e)),onsuccess:function(e){BX.closeWait();const i=t.split("@")[0]?t.split("@")[0]:t,s=document.querySelector(`.widget_button[data-id-gadget="${i}"]`),a=e.match(/<!-- widgets -->(.*[\s\S]*)<!-- \/widgets -->/);if(null!=a){document.querySelector("[data-update-widgets-block]").innerHTML=a[1];const e=new RegExp(`data-gadget="${t}@(.[^"]*)"`),i=a[1].match(e)[1];s&&(s.classList.add("widget_button--active"),s.onclick=_this.Delete.bind(null,`${t}@${i}`)),App.initCardActions()}},onfailure:function(t){BX.closeWait()}})},_this.UpdSettings=function(t){var e=document.getElementById("GDHolderForm_"+_this.gadgetHolderID);function i(t,i){var s;if("object"==typeof i||i instanceof Array)for(var a in i)i.hasOwnProperty(a)&&((s=document.createElement("INPUT")).type="hidden",s.name="settings["+t+"][]",s.value=i[a],e.appendChild(s));else(s=document.createElement("INPUT")).type="hidden",s.name="settings["+t+"]",s.value=i,e.appendChild(s)}e.gid.value=t,e.action.value="update",_this.loader(document.getElementById("t"+t));for(var s,a=document.getElementById("dset"+t),d=0;d<a._inputs.length;d++)if(s=document.getElementById(t+"_"+a._inputs[d]))if("SELECT"==s.tagName.toUpperCase()&&s.multiple){for(var n=[],o=0;o<s.options.length;o++)s.options[o].selected&&n.push(s.options[o].value);i(a._inputs[d],n)}else"INPUT"==s.tagName.toUpperCase()&&"CHECKBOX"==s.type.toUpperCase()?i(a._inputs[d],s.checked?"Y":"N"):i(a._inputs[d],s.value);const r=e.querySelector('input[name="settings[CITY]"]');r&&(r.value="c"===r.value[0]?r.value:"c"+r.value),e.submit()},_this.SetForAll=function(){langGDConfirm=langGDConfirm1,arguments[0]&&("SU"==arguments[0]&&(langGDConfirm=langGDConfirmUser),"SG"==arguments[0]&&(langGDConfirm=langGDConfirmGroup)),swal.fire({title:langGDClearTitleConfirm,text:langGDConfirm,icon:"warning",showCancelButton:!0,showCloseButton:!0,customClass:{confirmButton:"btn btn-primary",cancelButton:"btn"},confirmButtonText:langGDButtonConfirm,cancelButtonText:langGDButtonCancel,dangerMode:!0}).then((t=>{t.isConfirmed&&(BX.showWait(),_this.SendUpdatedInfo("clear_settings"))})),_this.SendUpdatedInfo("save_default")},_this.ClearUserSettings=function(){_this.SendUpdatedInfo("clear_settings")},_this.ClearUserSettingsConfirm=function(){swal.fire({title:langGDClearTitleConfirm,text:langGDClearConfirm,icon:"warning",showCancelButton:!0,showCloseButton:!0,customClass:{confirmButton:"btn btn-primary",cancelButton:"btn"},confirmButtonText:langGDButtonConfirm,cancelButtonText:langGDButtonCancel,dangerMode:!0}).then((t=>{t.isConfirmed&&(BX.showWait(),_this.SendUpdatedInfo("clear_settings"))}))},_this.Delete=function(t){var e=document.getElementById("t"+t);e&&e.parentNode.removeChild(e);var i=document.getElementById("d"+t);i&&i.parentNode.removeChild(i);let s=t.split("@")[0]?t.split("@")[0]:t,a=document.querySelector(`.widget_button[data-id-gadget="${s}"]`);return a&&(a.classList.remove("widget_button--active"),a.onclick=_this.Add.bind(null,s)),_this.sendWait||(_this.sendWait=!0,setTimeout("getGadgetHolderSC('"+_this.gadgetHolderID+"').SendUpdatedInfo();",500)),"function"==typeof changeWidgetWidth&&changeWidgetWidth(),!1},_this.Hide=function(t,e){var i=document.getElementById("t"+t);if(i){for(var s=i.className.split(" "),a="",d=0;d<s.length;d++)-1!=s[d].search("sotbit")&&(a+=s[d]+" ");return i.className.indexOf(" gdhided")>0?i.className="data-table-gadget "+a:i.className="data-table-gadget gdhided "+a,_this.sendWait||(_this.sendWait=!0,setTimeout("getGadgetHolderSC('"+_this.gadgetHolderID+"').SendUpdatedInfo();",500)),"function"==typeof changeWidgetWidth&&changeWidgetWidth(),!1}},_this.CloseSettingsForm=function(t){document.getElementById("dset"+t).style.display="none"},_this.loader=function(t){t&&t.insertAdjacentHTML("beforeend",'<div class="card-loader">\n                            <div class="spinner-grow">\n                                <span class="visually-hidden">Loading...</span>\n                            </div>\n                        </div>')},_this.closeLoader=function(t){t.querySelector(".card-loader").remove()},SCGadget.prototype.ShowSettings=function(id,t){var dS=document.getElementById("dset"+id),is_selected="";const widget=document.getElementById("t"+id);return t=t||"get_settings",_this=this,_this.loader(widget),"none"!=dS.style.display?(dS.style.display="none",_this.closeLoader(widget),void("function"==typeof changeWidgetWidth&&changeWidgetWidth())):(BX.ajax({url:updateURL,method:"POST",dataType:"html",data:{sessid:BX.bitrix_sessid(),gd_ajax:_this.gadgetHolderID,gid:id,gd_ajax_action:t},onsuccess:function(data){_this.closeLoader(widget);var before=(new Date).getTime(),dSet=document.getElementById("dset"+id),param,param_id,oEl;dSet.innerHTML="",dSet._inputs=[];try{eval("var gdObject = "+data)}catch(t){return}for(param_id in gdObject)if(gdObject.hasOwnProperty(param_id)){param=gdObject[param_id];var str="",input_id=id+"_"+param_id;if(param.TYPE=param.TYPE||"STRING",param.VALUE||"undefined"==param.DEFAULT||(param.VALUE=param.DEFAULT),"STRING"==param.TYPE)str='<span class="form-label">'+param.NAME+':</span><input type="text" class="form-control form-control-sm" name="GP_'+param_id+'" id="'+input_id+'" size="40" value="'+jsUtils.htmlspecialchars(param.VALUE)+'">';else if("LIST"==param.TYPE){var aR=[];for(var vid in param.VALUES)if(param.VALUES.hasOwnProperty(vid)){if("Y"==param.MULTIPLE)if(is_selected="",param.VALUE instanceof Array){for(var k=0;k<param.VALUE.length;k++)if(param.VALUE[k]==vid){is_selected=" selected";break}}else is_selected=param.VALUE==vid?" selected":"";else is_selected=param.VALUE==vid?" selected":"";aR.push('<option value="'+vid+'" '+is_selected+">"+param.VALUES[vid]+"</option>")}0==aR.length&&aR.push('<option value="'+param.VALUE+'" '+is_selected+">"+param.VALUE+"</option>"),str='<span class="col-form-label">'+param.NAME+':</span><select class="'+param_id+'-select form-select form-select-sm" id="'+input_id+'" '+("Y"==param.MULTIPLE?'multiple="multiple"':"")+">"+aR.join("")+"</select>"}else"CHECKBOX"==param.TYPE&&(str=param.NAME+': <input type="checkbox" class="form-check-input ms-1" id="'+input_id+'" value="Y" '+("Y"==param.VALUE?" checked":"")+">");oEl=document.createElement("DIV"),oEl.setAttribute("class","gdsettrow "+param_id),oEl.innerHTML=str,dSet.appendChild(oEl),dSet._inputs[dSet._inputs.length]=param_id}oEl=document.createElement("DIV"),oEl.setAttribute("class","gdsettrow button-row"),oEl.innerHTML='<input type="button" class="btn btn-sm btn-flat-primary" value="OK" onclick="getGadgetHolderSC(\''+_this.gadgetHolderID+"').UpdSettings('"+id+'\');"> <input type="button" class="btn btn-sm btn-flat-danger" value="'+langGDButtonCancel+'" onclick="getGadgetHolderSC(\''+_this.gadgetHolderID+"').CloseSettingsForm('"+id+"');\">",dSet.appendChild(oEl),dSet.style.display="block","function"==typeof changeWidgetWidth&&changeWidgetWidth()},onfailure:function(t){_this.closeLoader(widget),alert(langGDError2)}}),!1)},SCGadget.prototype.ShowAddGDMenu=function(t){toggleAdd()},jsUtils.addEvent(document.body,"mousemove",_this.onMouseMove),jsUtils.addEvent(document.body,"mouseup",_this.onMouseUp)}function toggleAdd(){const t=document.querySelector(".widgets_cabinet"),e=document.querySelector(".body_widgets_main");t.classList.toggle("show_widgets"),e.classList.toggle("body_widgets"),document.querySelector(".body_class").classList.toggle("stop-scrolling"),t.classList.contains("show_widgets")||document.querySelector(".widget-btn").click()}function savePositionCollapse(t){setTimeout("getGadgetHolderSC('"+t+"').SendUpdatedInfo('update_position', event);",500)}