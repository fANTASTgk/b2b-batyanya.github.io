(function(exports,main_core_events,ui_cnt,main_core){"use strict";var _templateObject,_templateObject2,_templateObject$1,_templateObject2$1,_templateObject3,_templateObject4,_templateObject5,_templateObject6,_templateObject7,_templateObject8,_templateObject9,_templateObject10,_templateObject11,_templateObject12,_templateObject13,_templateObject14,_templateObject15,_templateObject$2,_templateObject2$2,_templateObject3$1,_templateObject4$1,_templateObject5$1;function _createForOfIteratorHelper(t,e){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=_unsupportedIterableToArray(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var n=0,s=function(){};return{s:s,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,r=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return a=t.done,t},e:function(t){r=!0,o=t},f:function(){try{a||null==i.return||i.return()}finally{if(r)throw o}}}}function _unsupportedIterableToArray(t,e){if(t){if("string"==typeof t)return _arrayLikeToArray(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?_arrayLikeToArray(t,e):void 0}}function _arrayLikeToArray(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}function ownKeys(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(i),!0).forEach((function(e){babelHelpers.defineProperty(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):ownKeys(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}(function(){BX.namespace("BX.Grid"),BX.Grid.ActionPanel=function(t,e,i){this.parent=null,this.rel={},this.actions=null,this.types=null,this.lastActivated=[],this.init(t,e,i),this.button=[],this.elements=[],this.buttonOnChange=[],this.buttonData={}},BX.Grid.ActionPanel.prototype={init:function init(parent,actions,types){this.parent=parent,this.actions=eval(actions),this.types=eval(types),BX.addCustomEvent(window,"Dropdown::change",BX.proxy(this._dropdownEventHandle,this)),BX.addCustomEvent(window,"Dropdown::load",BX.proxy(this._dropdownEventHandle,this));var panel=this.getPanel();BX.bind(panel,"change",BX.delegate(this._checkboxChange,this)),BX.bind(panel,"click",BX.delegate(this._clickOnButton,this)),BX.addCustomEvent(window,"Grid::updated",BX.proxy(this._gridUpdatedEventHandle,this))},destroy:function(){BX.removeCustomEvent(window,"Dropdown::change",BX.proxy(this._dropdownEventHandle,this)),BX.removeCustomEvent(window,"Dropdown::load",BX.proxy(this._dropdownEventHandle,this)),BX.removeCustomEvent(window,"Grid::updated",BX.proxy(this._gridUpdatedEventHandle,this))},_gridUpdatedEventHandle:function(){var t=BX("grid_cancel_button");t&&BX.fireEvent(BX.firstChild(t),"click")},_dropdownEventHandle:function(t,e,i,n){this.isPanelControl(BX(t))&&this._dropdownChange(t,e,i,n)},resetForAllCheckbox:function(){var t=this.getForAllCheckbox();BX.type.isDomNode(t)&&(t.checked=null)},getForAllCheckbox:function(){return BX.Grid.Utils.getByClass(this.getPanel(),this.parent.settings.get("classForAllCheckbox"),!0)},getPanel:function(){return BX.Grid.Utils.getByClass(this.parent.getContainer(),this.parent.settings.get("classActionPanel"),!0)},getApplyButton:function(){return BX.Grid.Utils.getByClass(this.getPanel(),this.parent.settings.get("classPanelApplyButton"),!0)},isPanelControl:function(t){return BX.hasClass(t,this.parent.settings.get("classPanelControl"))},getTextInputs:function(){return BX.Grid.Utils.getBySelector(this.getPanel(),'input[type="text"]')},getHiddenInputs:function(){return BX.Grid.Utils.getBySelector(this.getPanel(),'input[type="hidden"]')},getSelects:function(){return BX.Grid.Utils.getBySelector(this.getPanel(),"select")},getDropdowns:function(){return BX.Grid.Utils.getByClass(this.getPanel(),this.parent.settings.get("classDropdown"))},getCheckboxes:function(){return BX.Grid.Utils.getByClass(this.getPanel(),this.parent.settings.get("classPanelCheckbox"))},getButtons:function(){return BX.Grid.Utils.getByClass(this.getPanel(),this.parent.settings.get("classPanelButton"))},isDropdown:function(t){return BX.hasClass(t,this.parent.settings.get("classDropdown"))},isCheckbox:function(t){return BX.hasClass(t,this.parent.settings.get("classPanelCheckbox"))},isTextInput:function(t){return"text"===t.type},isHiddenInput:function(t){return"hidden"===t.type},isSelect:function(t){return"SELECT"===t.tagName},createDropdown:function(t,e){var i=t.EMPTY_TEXT||"",n="Y"===t.MULTIPLE,s=this.createContainer(t.ID,e,{}),o=BX.create("div",{props:{className:"main-dropdown main-grid-panel-control",id:t.ID+"_control"},attrs:{name:t.NAME,"data-name":t.NAME,"data-empty-text":i,"data-multiple":n?"Y":"N","data-items":JSON.stringify(t.ITEMS),"data-value":n?"":t.ITEMS[0].VALUE,"data-popup-position":"fixed"},children:[BX.create("span",{props:{className:"main-dropdown-inner"},html:n?i:t.ITEMS[0].NAME})]});return s.appendChild(o),s},createCheckbox:function(t,e){var i=this.createContainer(t.ID,e,{}),n=BX.create("span",{props:{className:"main-grid-checkbox-container"}}),s=BX.create("span",{props:{className:"main-grid-control-panel-content-title"}}),o=BX.create("input",{props:{type:"checkbox",className:this.parent.settings.get("classPanelCheckbox")+" main-grid-checkbox",id:t.ID+"_control"},attrs:{value:t.VALUE||"",title:t.TITLE||"",name:t.NAME||"","data-onchange":JSON.stringify(t.ONCHANGE)}});return o.checked=t.CHECKED||null,i.appendChild(n),i.appendChild(s),n.appendChild(o),n.appendChild(BX.create("label",{props:{className:"main-grid-checkbox"},attrs:{for:t.ID+"_control",title:t.TITLE}})),s.appendChild(BX.create("label",{attrs:{for:t.ID+"_control",title:t.TITLE},html:t.LABEL})),i},createText:function(t,e){var i=this.createContainer(t.ID,e,{}),n=BX.type.isNotEmptyString(t.TITLE)?t.TITLE:"";return""!==n&&i.appendChild(BX.create("label",{attrs:{title:n,for:t.ID+"_control"},text:n})),i.appendChild(BX.create("input",{props:{className:"main-grid-control-panel-input-text main-grid-panel-control",id:t.ID+"_control"},attrs:{name:t.NAME,title:n,placeholder:t.PLACEHOLDER||"",value:t.VALUE||"",type:"text","data-onchange":JSON.stringify(t.ONCHANGE||[])}})),i},createHidden:function(t,e){var i=this.createContainer(t.ID,e,{CLASS:"main-grid-panel-hidden-control-container"});return i.appendChild(BX.create("input",{props:{id:t.ID+"_control",type:"hidden"},attrs:{name:t.NAME,value:t.VALUE||""}})),i},createButton:function(t,e){this.buttonOnChange=t.ONCHANGE||[],this.buttonData=t,this.button=this.createButtonNode(t),BX.removeCustomEvent(window,"Grid::unselectRow",BX.proxy(this.prepareButton,this)),BX.removeCustomEvent(window,"Grid::selectRow",BX.proxy(this.prepareButton,this)),BX.removeCustomEvent(window,"Grid::allRowsSelected",BX.proxy(this.prepareButton,this)),BX.removeCustomEvent(window,"Grid::allRowsUnselected",BX.proxy(this.prepareButton,this)),this.buttonData.SETTINGS&&t.ID===this.buttonData.SETTINGS.buttonId&&(BX.addCustomEvent(window,"Grid::unselectRow",BX.proxy(this.prepareButton,this)),BX.addCustomEvent(window,"Grid::selectRow",BX.proxy(this.prepareButton,this)),BX.addCustomEvent(window,"Grid::allRowsSelected",BX.proxy(this.prepareButton,this)),BX.addCustomEvent(window,"Grid::allRowsUnselected",BX.proxy(this.prepareButton,this))),this.prepareButton();var i=this.createContainer(t.ID,e,{});return i.appendChild(this.button),i},createButtonNode:function(t){return BX.create("button",{props:{className:"main-grid-buttons"+(t.CLASS?" "+t.CLASS:""),id:t.ID+"_control",title:BX.type.isNotEmptyString(t.TITLE)?t.TITLE:""},attrs:{name:t.NAME||""},html:t.TEXT})},prepareButton:function(){this.isSetButtonDisabled()?(BX.Dom.attr(this.button,"data-onchange",[]),BX.Dom.addClass(this.button,"ui-btn ui-btn-disabled")):(BX.Dom.attr(this.button,"data-onchange",this.buttonOnChange),BX.Dom.removeClass(this.button,"ui-btn ui-btn-disabled"))},isSetButtonDisabled:function(){return!!(this.buttonData.SETTINGS&&this.buttonData.SETTINGS.minSelectedRows&&this.getSelectedIds().length<this.buttonData.SETTINGS.minSelectedRows)},createLink:function(t,e){var i=this.createContainer(t.ID,e,{}),n=BX.create("a",{props:{className:"main-grid-link"+(t.CLASS?" "+t.CLASS:""),id:t.ID+"_control"},attrs:{href:t.HREF||"","data-onchange":JSON.stringify(t.ONCHANGE||[])},html:t.TEXT});return i.appendChild(n),i},createCustom:function(t,e){var i=this.createContainer(t.ID,e,{CLASS:"main-grid-panel-hidden-control-container"}),n=BX.create("div",{props:{className:"main-grid-panel-custom"+(t.CLASS?" "+t.CLASS:"")},html:t.VALUE});return i.appendChild(n),i},createContainer:function(t,e,i){return t=t.replace("_control",""),e=e.replace("_control",""),i=i||{},BX.create("span",{props:{className:this.parent.settings.get("classPanelControlContainer")+(i.CLASS?" "+i.CLASS:""),id:t},attrs:{"data-relative":e}})},removeItemsRelativeCurrent:function(t){for(var e,i=t,n=[t.id],s=[];i;)e=BX.data(i,"relative"),n.includes(e)&&(n.push(i.id),s.push(i)),i=i.nextElementSibling;s.forEach((function(t){BX.remove(t)}))},validateData:function(t){return"ONCHANGE"in t&&BX.type.isArray(t.ONCHANGE)},activateControl:function(t){var e=BX(t);BX.type.isDomNode(e)&&(BX.removeClass(e,this.parent.settings.get("classDisable")),e.disabled=null)},deactivateControl:function(t){var e=BX(t);BX.type.isDomNode(e)&&(BX.addClass(e,this.parent.settings.get("classDisable")),e.disabled=!0)},showControl:function(t){var e=BX(t);e&&BX.show(e)},hideControl:function(t){var e=BX(t);e&&BX.hide(e)},validateActionObject:function(t){return BX.type.isPlainObject(t)&&"ACTION"in t&&BX.type.isNotEmptyString(t.ACTION)&&(t.ACTION===this.actions.RESET_CONTROLS||"DATA"in t&&BX.type.isArray(t.DATA))},validateControlObject:function(t){return BX.type.isPlainObject(t)&&"TYPE"in t&&"ID"in t},createDate:function(t,e){var i=this.createContainer(t.ID,e,{}),n=BX.decl({block:"main-ui-date",mix:["main-grid-panel-date"],calendarButton:!0,valueDelete:!0,placeholder:"PLACEHOLDER"in t?t.PLACEHOLDER:"",name:"NAME"in t?t.NAME+"_from":"",tabindex:"TABINDEX"in t?t.TABINDEX:"",value:"VALUE"in t?t.VALUE:"",enableTime:"TIME"in t&&t.TIME?"true":"false"});return i.appendChild(n),i},createControl:function(t,e){var i=null;switch(t.TYPE){case this.types.DROPDOWN:i=this.createDropdown(t,e);break;case this.types.CHECKBOX:i=this.createCheckbox(t,e);break;case this.types.TEXT:i=this.createText(t,e);break;case this.types.HIDDEN:i=this.createHidden(t,e);break;case this.types.BUTTON:i=this.createButton(t,e);break;case this.types.LINK:i=this.createLink(t,e);break;case this.types.CUSTOM:i=this.createCustom(t,e);break;case this.types.DATE:i=this.createDate(t,e);break}return i},onChangeHandler:function onChangeHandler(container,actions,isPseudo){var newElement,callback,self=this;BX.type.isDomNode(container)&&BX.type.isArray(actions)?actions.forEach((function(action){self.validateActionObject(action)&&(action.ACTION===self.actions.CREATE&&(self.removeItemsRelativeCurrent(container),action.DATA.reverse(),action.DATA.forEach((function(t){self.validateControlObject(t)&&(newElement=self.createControl(t,container.id||BX.data(container,"relative")),BX.type.isDomNode(newElement)&&(BX.insertAfter(newElement,container),"ONCHANGE"in t&&t.TYPE===self.types.CHECKBOX&&"CHECKED"in t&&t.CHECKED&&self.onChangeHandler(newElement,t.ONCHANGE),t.TYPE===self.types.DROPDOWN&&BX.type.isArray(t.ITEMS)&&t.ITEMS.length&&"ONCHANGE"in t.ITEMS[0]&&BX.type.isArray(t.ITEMS[0].ONCHANGE)&&self.onChangeHandler(newElement,t.ITEMS[0].ONCHANGE)))}))),action.ACTION===self.actions.ACTIVATE&&(self.removeItemsRelativeCurrent(container),BX.type.isArray(action.DATA)&&action.DATA.forEach((function(t){self.lastActivated.push(t.ID),self.activateControl(t.ID)}))),action.ACTION===self.actions.SHOW&&BX.type.isArray(action.DATA)&&action.DATA.forEach((function(t){self.showControl(t.ID)})),action.ACTION===self.actions.HIDE&&BX.type.isArray(action.DATA)&&action.DATA.forEach((function(t){self.hideControl(t.ID)})),action.ACTION===self.actions.HIDE_ALL_EXPECT&&BX.type.isArray(action.DATA)&&(self.getControls()||[]).forEach((function(t){action.DATA.some((function(e){return e.ID===t.id}))||self.hideControl(t.id)})),action.ACTION===self.actions.SHOW_ALL&&(self.getControls()||[]).forEach((function(t){self.showControl(t.id)})),action.ACTION===self.actions.REMOVE&&BX.type.isArray(action.DATA)&&action.DATA.forEach((function(t){BX.remove(BX(t.ID))})),action.ACTION===self.actions.CALLBACK&&this.confirmDialog(action,BX.delegate((function(){BX.type.isArray(action.DATA)&&action.DATA.forEach((function(currentCallback){if(-1!==currentCallback.JS.indexOf("Grid.")){callback=currentCallback.JS.replace("Grid","self.parent"),callback=callback.replace("()",""),callback+=".apply(self.parent, [container])";try{eval(callback)}catch(t){throw new Error(t)}}else if(BX.type.isNotEmptyString(currentCallback.JS))try{eval(currentCallback.JS)}catch(t){throw new Error(t)}}))}),this)),action.ACTION===self.actions.RESET_CONTROLS&&this.removeItemsRelativeCurrent(container))}),this):(isPseudo||this.removeItemsRelativeCurrent(container),self.lastActivated.forEach((function(t){self.deactivateControl(t)})),self.lastActivated=[])},confirmDialog:function(t,e,i){this.parent.confirmDialog(t,e,i)},_dropdownChange:function(t,e,i,n){var s=BX(t).parentNode,o=n&&"ONCHANGE"in n?n.ONCHANGE:null,a=n&&"PSEUDO"in n&&!1!==n.PSEUDO;this.onChangeHandler(s,o,a)},_checkboxChange:function _checkboxChange(event){var onChange;try{onChange=eval(BX.data(event.target,"onchange"))}catch(t){onChange=null}this.onChangeHandler(BX.findParent(event.target,{className:this.parent.settings.get("classPanelContainer")},!0,!1),event.target.checked||-1!==event.target.id.indexOf("actallrows_")?onChange:null)},_clickOnButton:function _clickOnButton(event){var onChange;if(this.isButton(event.target)){event.preventDefault();try{onChange=eval(BX.data(event.target,"onchange"))}catch(t){onChange=null}this.onChangeHandler(BX.findParent(event.target,{className:this.parent.settings.get("classPanelContainer")},!0,!1),onChange)}},isButton:function(t){return BX.hasClass(t,this.parent.settings.get("classPanelButton"))},getSelectedIds:function(){return this.parent.getRows().getSelected().filter((function(t){return t.isShown()})).map((function(t){return t.getId()}))},getControls:function(){return BX.findChild(this.getPanel(),{className:this.parent.settings.get("classPanelControlContainer")},!0,!0)},getValues:function(){var t={},e=this;return([].concat(this.getDropdowns(),this.getTextInputs(),this.getHiddenInputs(),this.getSelects(),this.getCheckboxes(),this.getButtons())||[]).forEach((function(i){if(BX.type.isDomNode(i)){if(e.isDropdown(i)){var n=BX.data(i,"value"),s="Y"===BX.data(i,"multiple");n=null!=n?n:"",t[BX.data(i,"name")]=s?n.split(","):n}if(e.isSelect(i)&&(t[i.getAttribute("name")]=i.options[i.selectedIndex].value),e.isCheckbox(i)&&i.checked&&(t[i.getAttribute("name")]=i.value),(e.isTextInput(i)||e.isHiddenInput(i))&&(t[i.getAttribute("name")]=i.value),e.isButton(i)){var o=BX.data(i,"name"),a=BX.data(i,"value");a=null!=a?a:"",o&&(t[o]=a)}}})),t}}})(),BX.namespace("BX.Grid"),BX.Grid.BaseClass=function(t){this.parent=t},BX.Grid.BaseClass.prototype={getParent:function(){return this.parent}},BX.namespace("BX.Grid"),BX.Grid.ColsSortable=function(t){this.parent=null,this.dragItem=null,this.targetItem=null,this.rowsList=null,this.colsList=null,this.dragRect=null,this.offset=null,this.startDragOffset=null,this.dragColumn=null,this.targetColumn=null,this.isDrag=null,this.init(t)},BX.Grid.ColsSortable.prototype={init:function(t){this.parent=t,this.colsList=this.getColsList(),this.rowsList=this.getRowsList(),this.inited||(this.inited=!0,BX.addCustomEvent("Grid::updated",BX.proxy(this.reinit,this)),BX.addCustomEvent("Grid::headerUpdated",BX.proxy(this.reinit,this))),this.registerObjects()},destroy:function(){BX.removeCustomEvent("Grid::updated",BX.proxy(this.reinit,this)),this.unregisterObjects()},reinit:function(){this.unregisterObjects(),this.reset(),this.init(this.parent)},reset:function(){this.dragItem=null,this.targetItem=null,this.rowsList=null,this.colsList=null,this.dragRect=null,this.offset=null,this.startDragOffset=null,this.dragColumn=null,this.targetColumn=null,this.isDrag=null,this.fixedTableColsList=null},isActive:function(){return this.isDrag},registerObjects:function(){this.unregisterObjects(),this.getColsList().forEach(this.register,this),this.getFixedHeaderColsList().forEach(this.register,this)},unregisterObjects:function(){this.getColsList().forEach(this.unregister,this),this.getFixedHeaderColsList().forEach(this.unregister,this)},unregister:function(t){jsDD.unregisterObject(t)},register:function(t){t.onbxdragstart=BX.proxy(this._onDragStart,this),t.onbxdrag=BX.proxy(this._onDrag,this),t.onbxdragstop=BX.proxy(this._onDragEnd,this),jsDD.registerObject(t)},getColsList:function(){return this.colsList||(this.colsList=BX.Grid.Utils.getByTag(this.parent.getRows().getHeadFirstChild().getNode(),"th"),this.colsList=this.colsList.filter((function(t){return!this.isStatic(t)}),this)),this.colsList},getFixedHeaderColsList:function(){return!this.fixedTableColsList&&this.parent.getParam("ALLOW_PIN_HEADER")&&(this.fixedTableColsList=BX.Grid.Utils.getByTag(this.parent.getPinHeader().getFixedTable(),"th"),this.fixedTableColsList=this.fixedTableColsList.filter((function(t){return!this.isStatic(t)}),this)),this.fixedTableColsList||[]},getRowsList:function(){var t=this.parent.getRows().getSourceRows();return this.parent.getParam("ALLOW_PIN_HEADER")&&(t=t.concat(BX.Grid.Utils.getByTag(this.parent.getPinHeader().getFixedTable(),"tr"))),t},isStatic:function(t){return BX.hasClass(t,this.parent.settings.get("classCellStatic"))&&!BX.hasClass(t,"main-grid-fixed-column")},getDragOffset:function(){var t=this.parent.getScrollContainer().scrollLeft-this.startScrollOffset;return jsDD.x-this.startDragOffset-this.dragRect.left+t},getColumn:function(t){var e=[];return t instanceof HTMLTableCellElement&&(e=this.rowsList.map((function(e){return e.cells[t.cellIndex]}))),e},_onDragStart:function(){this.parent.getParam("ALLOW_PIN_HEADER")&&this.parent.getPinHeader().isPinned()?this.colsList=this.getFixedHeaderColsList():this.colsList=this.getColsList(),this.startScrollOffset=this.parent.getScrollContainer().scrollLeft,this.isDrag=!0,this.dragItem=jsDD.current_node,this.dragRect=this.dragItem.getBoundingClientRect(),this.offset=Math.ceil(this.dragRect.width),this.startDragOffset=jsDD.start_x-this.dragRect.left,this.dragColumn=this.getColumn(this.dragItem),this.dragIndex=BX.Grid.Utils.getIndex(this.colsList,this.dragItem),this.parent.preventSortableClick=!0},isDragToRight:function(t,e){var i=t.getBoundingClientRect(),n=Math.ceil(i.left+i.width/2+BX.scrollLeft(window)),s=this.dragIndex,o=jsDD.x;return e>s&&o>n},isDragToLeft:function(t,e){var i=t.getBoundingClientRect(),n=Math.ceil(i.left+i.width/2+BX.scrollLeft(window)),s=this.dragIndex,o=jsDD.x;return e<s&&o<n},isDragToBack:function(t,e){var i=t.getBoundingClientRect(),n=Math.ceil(i.left+i.width/2+BX.scrollLeft(window)),s=this.dragIndex,o=jsDD.x;return e>s&&o<n||e<s&&o>n},isMovedToRight:function(t){return t.style.transform==="translate3d("+-this.offset+"px, 0px, 0px)"},isMovedToLeft:function(t){return t.style.transform==="translate3d("+this.offset+"px, 0px, 0px)"},isMoved:function(t){return"translate3d(0px, 0px, 0px)"!==t.style.transform&&""!==t.style.transform},moveColumn:function(t,e,i){i=BX.type.isNumber(i)?i:300,BX.Grid.Utils.styleForEach(t,{transition:i+"ms",transform:"translate3d("+e+"px, 0px, 0px)"})},_onDrag:function(){this.dragOffset=this.getDragOffset(),this.targetItem=this.targetItem||this.dragItem,this.targetColumn=this.targetColumn||this.dragColumn;var t=-this.offset,e=this.offset;this.moveColumn(this.dragColumn,this.dragOffset,0),[].forEach.call(this.colsList,(function(i,n){i&&!i.classList.contains("main-grid-cell-static")&&(this.isDragToRight(i,n)&&!this.isMovedToRight(i)&&(this.targetColumn=this.getColumn(i),this.moveColumn(this.targetColumn,t)),this.isDragToLeft(i,n)&&!this.isMovedToLeft(i)&&(this.targetColumn=this.getColumn(i),this.moveColumn(this.targetColumn,e)),this.isDragToBack(i,n)&&this.isMoved(i)&&(this.targetColumn=this.getColumn(i),this.moveColumn(this.targetColumn,0)))}),this)},_onDragEnd:function(){[].forEach.call(this.dragColumn,(function(t,e){BX.Grid.Utils.collectionSort(t,this.targetColumn[e])}),this),this.rowsList.forEach((function(t){BX.Grid.Utils.styleForEach(t.cells,{transition:"",transform:""})})),this.reinit();var t=this.colsList.map((function(t){return BX.data(t,"name")}));this.parent.getUserOptions().setColumns(t),BX.onCustomEvent(this.parent.getContainer(),"Grid::columnMoved",[this.parent]),setTimeout(function(){this.parent.preventSortableClick=!1}.bind(this),10)}},function(){BX.namespace("BX.Grid");var t=window.parent.BX.ajax.UpdatePageData;BX.Grid.Data=function(t){this.parent=t,this.reset()},BX.Grid.Data.prototype.reset=function(){this.response=null,this.xhr=null,this.headRows=null,this.bodyRows=null,this.footRows=null,this.moreButton=null,this.pagination=null,this.counterDisplayed=null,this.counterSelected=null,this.counterTotal=null,this.limit=null,this.actionPanel=null,this.rowsByParentId={},this.rowById={},this.isValidResponse=null},BX.Grid.Data.prototype.getParent=function(){return this.parent},BX.Grid.Data.prototype.validateResponse=function(){return BX.type.isBoolean(this.isValidResponse)||(this.isValidResponse=!!this.getResponse()&&!!BX.Grid.Utils.getByClass(this.getResponse(),this.getParent().settings.get("classContainer"),!0)),this.isValidResponse},BX.Grid.Data.prototype.request=function(e,i,n,s,o,a){BX.type.isString(e)||(e=""),BX.type.isNotEmptyString(i)||(i="GET"),BX.type.isPlainObject(n)||(n={});var r={gridId:this.parent.getId(),url:e,method:i,data:n};if(this.parent.disableCheckAllCheckboxes(),BX.onCustomEvent(window,"Grid::beforeRequest",[this,r]),!r.hasOwnProperty("cancelRequest")||!0!==r.cancelRequest){e=r.url,BX.type.isNotEmptyString(e)||(e=this.parent.baseUrl),e=BX.Grid.Utils.addUrlParams(e,{sessid:BX.bitrix_sessid(),internal:"true",grid_id:this.parent.getId()}),e="apply_filter"in n&&"Y"===n.apply_filter?BX.Grid.Utils.addUrlParams(e,{apply_filter:"Y"}):BX.util.remove_url_param(e,"apply_filter"),e="clear_nav"in n&&"Y"===n.clear_nav?BX.Grid.Utils.addUrlParams(e,{clear_nav:"Y"}):BX.util.remove_url_param(e,"clear_nav"),e=BX.Grid.Utils.addUrlParams(e,{grid_action:s||"showpage"}),i=r.method,n=r.data,this.reset();var l=this;setTimeout((function(){var r=BX.Http.Data.convertObjectToFormData(n);window.parent.BX.ajax.UpdatePageData=function(){};var d=BX.ajax({url:BX.Grid.Utils.ajaxUrl(e,l.getParent().getAjaxId()),data:r,method:i,dataType:"html",headers:[{name:"X-Ajax-Grid-UID",value:l.getParent().getAjaxId()},{name:"X-Ajax-Grid-Req",value:JSON.stringify({action:s||"showpage"})}],processData:!0,scriptsRunFirst:!1,start:!1,preparePost:!1,onsuccess:function(e){if(l.response=BX.create("div",{html:e}),l.response=l.response.querySelector("#"+l.parent.getContainerId()),l.xhr=d,l.parent.getParam("HANDLE_RESPONSE_ERRORS")){var i;try{i=JSON.parse(e)}catch(t){i={messages:[]}}if(i.messages.length)return l.parent.arParams.MESSAGES=i.messages,l.parent.messages.show(),l.parent.tableUnfade(),void(BX.type.isFunction(a)&&BX.delegate(a,l)(d))}BX.type.isFunction(o)&&(l.parent.enableCheckAllCheckboxes(),BX.delegate(o,l)(e,d)),window.parent.BX.ajax.UpdatePageData=t},onerror:function(t){l.error=a,l.xhr=d,BX.type.isFunction(a)&&(l.parent.enableCheckAllCheckboxes(),BX.delegate(a,l)(d,t))}});d.send(r)}),0)}},BX.Grid.Data.prototype.getResponse=function(){return this.response},BX.Grid.Data.prototype.getContainer=function(){var t=this.getParent().settings.get("classContainer");return BX.Dom.hasClass(this.getResponse(),t)?this.getResponse():BX.Grid.Utils.getByClass(this.getResponse(),t,!0)},BX.Grid.Data.prototype.getHeadRows=function(){return this.headRows||(this.headRows=BX.Grid.Utils.getByClass(this.getResponse(),this.getParent().settings.get("classHeadRow"))),this.headRows},BX.Grid.Data.prototype.getBodyRows=function(){return this.bodyRows||(this.bodyRows=BX.Grid.Utils.getByClass(this.getResponse(),this.getParent().settings.get("classBodyRow"))),this.bodyRows},BX.Grid.Data.prototype.getRowsByParentId=function(t){return t in this.rowsByParentId||(this.rowsByParentId[t]=BX.Grid.Utils.getBySelector(this.getResponse(),"."+this.getParent().settings.get("classBodyRow")+'[data-parent-id="'+t+'"]')),this.rowsByParentId[t]},BX.Grid.Data.prototype.getRowById=function(t){return t in this.rowById||(this.rowById[t]=BX.Grid.Utils.getBySelector(this.getResponse(),"."+this.getParent().settings.get("classBodyRow")+'[data-id="'+t+'"]',!0)),this.rowById[t]},BX.Grid.Data.prototype.getFootRows=function(){return this.footRows||(this.footRows=BX.Grid.Utils.getByClass(this.getResponse(),this.getParent().settings.get("classFootRow"))),this.footRows},BX.Grid.Data.prototype.getMoreButton=function(){return this.moreButton||(this.moreButton=BX.Grid.Utils.getByClass(this.getResponse(),this.getParent().settings.get("classMoreButton"),!0)),this.moreButton},BX.Grid.Data.prototype.getPagination=function(){return this.pagination||(this.pagination=BX.Grid.Utils.getByClass(this.getResponse(),this.getParent().settings.get("classPagination"),!0),BX.type.isDomNode(this.pagination)&&(this.pagination=BX.firstChild(this.pagination))),this.pagination},BX.Grid.Data.prototype.getCounterDisplayed=function(){return this.counterDisplayed||(this.counterDisplayed=BX.Grid.Utils.getByClass(this.getResponse(),this.getParent().settings.get("classCounterDisplayed"),!0)),this.counterDisplayed},BX.Grid.Data.prototype.getCounterSelected=function(){return this.counterSelected||(this.counterSelected=BX.Grid.Utils.getByClass(this.getResponse(),this.getParent().settings.get("classCounterSelected"),!0)),this.counterSelected},BX.Grid.Data.prototype.getCounterTotal=function(){if(!BX.type.isDomNode(this.counterTotal)){var t="."+this.getParent().settings.get("classCounterTotal")+" ."+this.getParent().settings.get("classPanelCellContent");this.counterTotal=BX.Grid.Utils.getBySelector(this.getResponse(),t,!0)}return this.counterTotal},BX.Grid.Data.prototype.getLimit=function(){return this.limit||(this.limit=BX.Grid.Utils.getByClass(this.getResponse(),this.getParent().settings.get("classPageSize"),!0)),this.limit},BX.Grid.Data.prototype.getPageSize=function(){return this.getLimit()},BX.Grid.Data.prototype.getActionPanel=function(){return this.actionPanel||(this.actionPanel=BX.Grid.Utils.getByClass(this.getResponse(),this.getParent().settings.get("classActionPanel"),!0)),this.actionPanel}}(),function(){BX.namespace("BX.Main"),BX.Main.dropdown=function(t){this.id=null,this.dropdown=null,this.items=null,this.value=null,this.menuId=null,this.menu=null,this.menuItems=null,this.multiple=null,this.emptyText=null,this.dataItems="items",this.dataValue="value",this.dataPseudo="pseudo",this.dropdownItemClass="main-dropdown-item",this.activeClass="main-dropdown-active",this.selectedClass="main-dropdown-item-selected",this.notSelectedClass="main-dropdown-item-not-selected",this.lockedClass="main-dropdown-item-locked",this.menuItemClass="menu-popup-item",this.init(t)},BX.Main.dropdown.prototype={init:function(t){this.id=t.id,this.dropdown=t,this.items=this.getItems(),this.value=this.getValue(),this.menuId=this.getMenuId(),this.multiple=this.getMultiple(),this.emptyText=this.getEmptyText(),this.menu=this.createMenu(),this.menu.popupWindow.show(),this.adjustPosition(),BX.bind(this.dropdown,"click",BX.delegate(this.showMenu,this))},getMenuId:function(){return this.id+"_menu"},getItems:function getItems(){var result;try{var str=BX.data(this.dropdown,this.dataItems);result=eval(str)}catch(t){result=[]}return result},getValue:function(){return BX.data(this.dropdown,this.dataValue)},getValueItem:function(){var t=this.getValue();return this.getItems().find((function(e){return e.VALUE===t}))},getValueAsArray:function(){var t=this.getValue();return void 0===t&&(t=""),t.toString().split(",").filter((function(t){return""!==t}))},getValueItems:function(){var t=this.getValueAsArray();return this.getItems().filter((function(e){return t.includes(e.VALUE)}))},toggleValue:function(t){if(this.multiple)if(t||0===t||"0"===t){var e=this.getValueAsArray(),i=e.indexOf(t);i<0?e.push(t):e.splice(i,1),this.dropdown.dataset[this.dataValue]=e.join(",")}else this.dropdown.dataset[this.dataValue]=null;else this.dropdown.dataset[this.dataValue]=t},getValueText:function(){if(this.multiple)return this.getValueItems().map((function(t){return t.NAME})).filter((function(t){return!!t})).join(", ")||this.emptyText;var t=this.getValueItem();return t?t.NAME:this.emptyText},getMultiple:function(){return"Y"===this.dropdown.dataset.multiple},getEmptyText:function(){return this.dropdown.dataset.emptyText||null},prepareMenuItems:function(){var t,e,i=this,n=this.multiple?this.getValueAsArray():this.getValue();var s=function s(o){var a="true"===i.dropdown.dataset.htmlEntity;return o.map((function(o){(t={})["data-"+i.dataValue]=o.VALUE,t["data-"+i.dataPseudo]="PSEUDO"in o&&o.PSEUDO?"true":"false",e=BX.create("div",{children:[BX.create("span",{props:{className:i.dropdownItemClass},attrs:t,html:a?o.NAME:null,text:a?null:o.NAME})]});var r=i.multiple?n.includes(o.VALUE):n===o.VALUE;return{html:e.innerHTML,className:r?i.selectedClass:i.notSelectedClass,delimiter:o.DELIMITER,items:"ITEMS"in o?s(o.ITEMS):null}}))}(this.getItems());return BX.onCustomEvent(window,"Dropdown::onPrepareItems",[this.id,this.menuId,s]),s},createMenu:function(){var t=this;return BX.PopupMenu.create(this.getMenuId(),this.dropdown,this.prepareMenuItems(),{autoHide:!0,offsetTop:-8,offsetLeft:+(this.dropdown.dataset.menuOffsetLeft||40),maxHeight:+(this.dropdown.dataset.menuMaxHeight||170),angle:{position:"bottom",offset:0},events:{onPopupClose:BX.delegate(this._onCloseMenu,this),onPopupShow:function(){t._onShowMenu()}}})},showMenu:function(){this.menu=BX.PopupMenu.getMenuById(this.menuId),this.menu||(this.menu=this.createMenu(),this.menu.popupWindow.show()),this.adjustPosition()},adjustPosition:function(){if("fixed"===this.dropdown.dataset.popupPosition){var t=this.menu.popupWindow.popupContainer;t.style.setProperty("top","auto"),t.style.setProperty("bottom","45px"),t.style.setProperty("left","0px"),this.dropdown.appendChild(t)}},getSubItem:function(t){return BX.Grid.Utils.getByClass(t,this.dropdownItemClass,!0)},refresh:function(t){var e=this.getSubItem(t),i=BX.data(e,this.dataValue);BX.Type.isUndefined(i)&&(i=""),this.toggleValue(i),"true"===this.dropdown.dataset.htmlEntity?BX.firstChild(this.dropdown).innerHTML=this.getValueText():BX.firstChild(this.dropdown).innerText=this.getValueText()},selectItem:function(t){var e=this;(this.menu.menuItems||[]).forEach((function(i){e.multiple?t===i.layout.item&&(BX.hasClass(t,e.selectedClass)?(BX.addClass(i.layout.item,e.notSelectedClass),BX.removeClass(i.layout.item,e.selectedClass)):(BX.removeClass(i.layout.item,e.notSelectedClass),BX.addClass(i.layout.item,e.selectedClass))):(BX.removeClass(i.layout.item,e.selectedClass),t!==i.layout.item?BX.addClass(i.layout.item,e.notSelectedClass):(BX.removeClass(i.layout.item,e.notSelectedClass),BX.addClass(i.layout.item,e.selectedClass)))}))},lockedItem:function(t){BX.addClass(t,this.lockedClass)},getDataItemIndexByValue:function(t,e){return BX.type.isArray(t)&&t.map((function(t,i){if(t.VALUE===e)return!1})),!1},getDataItemByValue:function(t){var e=this.getItems().filter((function(e){return e.VALUE===t}));return e.length>0?e[0]:null},_onShowMenu:function(){var t=this;BX.addClass(this.dropdown,this.activeClass),(this.menu.menuItems||[]).forEach((function(e){BX.bind(e.layout.item,"click",BX.delegate(t._onItemClick,t))}))},_onCloseMenu:function(){BX.removeClass(this.dropdown,this.activeClass),BX.PopupMenu.destroy(this.menuId)},_onItemClick:function(t){var e,i,n=this.getMenuItem(t.target),s=this.getSubItem(n);"true"!==BX.data(s,"pseudo")?(this.refresh(n),this.selectItem(n),this.multiple||this.menu.popupWindow.close(),e=this.getValue(),i=this.getDataItemByValue(e)):(e=BX.data(s,"value"),i=this.getDataItemByValue(e)),t.stopPropagation(),BX.onCustomEvent(window,"Dropdown::change",[this.dropdown.id,t,n,i,e])},getMenuItem:function(t){var e=t;return BX.hasClass(e,this.menuItemClass)||(e=BX.findParent(e,{class:this.menuItemClass})),e}}}(),function(){BX.namespace("BX.Main"),BX.Main.dropdownManager={dropdownClass:"main-dropdown",data:{},init:function init(){var self=this,result,onLoadItems,items;BX.bind(document,"click",BX.delegate((function(t){BX.hasClass(t.target,this.dropdownClass)&&(t.preventDefault(),(result=this.getById(t.target.id))&&result.dropdown===t.target?self.push(t.target.id,this.getById(t.target.id)):self.push(t.target.id,new BX.Main.dropdown(t.target)))}),this)),onLoadItems=BX.Grid.Utils.getByClass(document.body,this.dropdownClass),BX.type.isArray(onLoadItems)&&onLoadItems.forEach((function(current){result=self.getById(current.id);try{items=eval(BX.data(current,"items"))}catch(t){}BX.onCustomEvent(window,"Dropdown::load",[current.id,{},null,BX.type.isArray(items)&&items.length?items[0]:[],BX.data(current,"value")])}))},push:function(t,e){this.data[t]=e},getById:function(t){return t in this.data?this.data[t]:null}}}(),BX.namespace("BX.Grid"),BX.Grid.Element=function(t,e){this.node=null,this.href=null,this.parent=null,this.init(t,e)},BX.Grid.Element.prototype={init:function(t,e){this.node=t,this.parent=e,this.resetOnclickAttr()},getParent:function(){return this.parent},load:function(){BX.addClass(this.getNode(),this.getParent().settings.get("classLoad"))},unload:function(){BX.removeClass(this.getNode(),this.getParent().settings.get("classLoad"))},isLoad:function(){return BX.hasClass(this.getNode(),this.getParent().settings.get("classLoad"))},resetOnclickAttr:function(){BX.type.isDomNode(this.getNode())&&(this.getNode().onclick=null)},getObserver:function(){return BX.Grid.observer},getNode:function(){return this.node},getLink:function(){var t;try{t=this.getNode().href}catch(e){t=null}return t}},BX.namespace("BX.Grid"),BX.Grid.Fader=function(t){this.parent=null,this.table=null,this.container=null,this.init(t)},BX.Grid.Fader.prototype={init:function(t){this.parent=t,this.table=this.parent.getTable(),this.container=this.table.parentNode,this.scrollStartEventName=this.parent.isTouch()?"touchstart":"mouseenter",this.scrollEndEventName=this.parent.isTouch()?"touchend":"mouseleave",this.parent.getParam("ALLOW_PIN_HEADER")&&(this.fixedTable=this.parent.getPinHeader().getFixedTable()),this.debounceScrollHandler=BX.debounce(this._onWindowScroll,400,this),BX.bind(window,"resize",BX.proxy(this.toggle,this)),document.addEventListener("scroll",this.debounceScrollHandler,BX.Grid.Utils.listenerParams({passive:!0})),this.container.addEventListener("scroll",BX.proxy(this.toggle,this),BX.Grid.Utils.listenerParams({passive:!0})),BX.addCustomEvent(window,"Grid::updated",BX.proxy(this.toggle,this)),BX.addCustomEvent(window,"Grid::resize",BX.proxy(this.toggle,this)),BX.addCustomEvent(window,"Grid::headerUpdated",BX.proxy(this._onHeaderUpdated,this)),BX.addCustomEvent(window,"Grid::columnResize",BX.proxy(this.toggle,this)),BX.bind(this.getEarLeft(),this.scrollStartEventName,BX.proxy(this._onMouseoverLeft,this)),BX.bind(this.getEarRight(),this.scrollStartEventName,BX.proxy(this._onMouseoverRight,this)),BX.bind(this.getEarLeft(),this.scrollEndEventName,BX.proxy(this.stopScroll,this)),BX.bind(this.getEarRight(),this.scrollEndEventName,BX.proxy(this.stopScroll,this)),this.toggle(),this.adjustEarOffset(!0)},destroy:function(){BX.unbind(window,"resize",BX.proxy(this.toggle,this)),document.removeEventListener("scroll",this.debounceScrollHandler,BX.Grid.Utils.listenerParams({passive:!0})),this.container.removeEventListener("scroll",BX.proxy(this.toggle,this),BX.Grid.Utils.listenerParams({passive:!0})),BX.removeCustomEvent(window,"Grid::updated",BX.proxy(this.toggle,this)),BX.removeCustomEvent(window,"Grid::headerUpdated",BX.proxy(this._onHeaderUpdated,this)),BX.removeCustomEvent(window,"Grid::columnResize",BX.proxy(this.toggle,this)),BX.unbind(this.getEarLeft(),this.scrollStartEventName,BX.proxy(this._onMouseoverLeft,this)),BX.unbind(this.getEarRight(),this.scrollStartEventName,BX.proxy(this._onMouseoverRight,this)),BX.unbind(this.getEarLeft(),this.scrollEndEventName,BX.proxy(this.stopScroll,this)),BX.unbind(this.getEarRight(),this.scrollEndEventName,BX.proxy(this.stopScroll,this)),this.hideLeftEar(),this.hideRightEar(),this.stopScroll()},_onHeaderUpdated:function(){this.parent.getParam("ALLOW_PIN_HEADER")&&(this.fixedTable=this.parent.getPinHeader().getFixedTable())},_onMouseoverLeft:function(t){this.parent.isTouch()&&t.preventDefault(),this.startScrollByDirection("left")},_onMouseoverRight:function(t){this.parent.isTouch()&&t.preventDefault(),this.startScrollByDirection("right")},stopScroll:function(){clearTimeout(this.scrollTimer),clearInterval(this.scrollInterval)},startScrollByDirection:function(t){var e=this.container,i=e.scrollLeft,n=this;this.scrollTimer=setTimeout((function(){n.scrollInterval=setInterval((function(){e.scrollLeft="right"==t?i+=8:i-=8}),8.333333333333334)}),100)},getEarLeft:function(){return this.earLeft||(this.earLeft=BX.Grid.Utils.getByClass(this.parent.getContainer(),this.parent.settings.get("classEarLeft"),!0)),this.earLeft},getEarRight:function(){return this.earRight||(this.earRight=BX.Grid.Utils.getByClass(this.parent.getContainer(),this.parent.settings.get("classEarRight"),!0)),this.earRight},getShadowLeft:function(){return this.parent.getContainer().querySelector(".main-grid-fade-shadow-left")},getShadowRight:function(){return this.parent.getContainer().querySelector(".main-grid-fade-shadow-right")},adjustEarOffset:function(t){t&&(this.windowHeight=BX.height(window),this.tbodyPos=BX.pos(this.table.tBodies[0]),this.headerPos=BX.pos(this.table.tHead));var e=window.scrollY;this.parent.isIE()&&(e=document.documentElement.scrollTop);var i=e+this.windowHeight-this.tbodyPos.top,n=e-this.tbodyPos.top;i>this.tbodyPos.bottom-this.tbodyPos.top&&(i=this.tbodyPos.bottom-this.tbodyPos.top),n<this.headerPos.height?n=this.headerPos.height:(i-=n,i+=this.headerPos.height),BX.Grid.Utils.requestAnimationFrame(BX.proxy((function(){if(n!==this.lastPosTop){var t="translate3d(0px, "+n+"px, 0)";this.getEarLeft().style.transform=t,this.getEarRight().style.transform=t}i!==this.lastBottomPos&&(this.getEarLeft().style.height=i+"px",this.getEarRight().style.height=i+"px"),this.lastPosTop=n,this.lastBottomPos=i}),this))},_onWindowScroll:function(){this.adjustEarOffset()},hasScroll:function(){return this.table.offsetWidth>this.container.clientWidth},hasScrollLeft:function(){return this.container.scrollLeft>0},hasScrollRight:function(){return this.table.offsetWidth>this.container.scrollLeft+this.container.clientWidth},showLeftEar:function(){BX.addClass(this.container.parentNode,this.parent.settings.get("classFadeContainerLeft")),BX.addClass(this.getEarLeft(),this.parent.settings.get("classShow"))},hideLeftEar:function(){BX.removeClass(this.container.parentNode,this.parent.settings.get("classFadeContainerLeft")),BX.removeClass(this.getEarLeft(),this.parent.settings.get("classShow"))},showRightEar:function(){BX.addClass(this.container.parentNode,this.parent.settings.get("classFadeContainerRight")),BX.addClass(this.getEarRight(),this.parent.settings.get("classShow"))},hideRightEar:function(){BX.removeClass(this.container.parentNode,this.parent.settings.get("classFadeContainerRight")),BX.removeClass(this.getEarRight(),this.parent.settings.get("classShow"))},adjustFixedTablePosition:function(){var t=this.container.scrollLeft;BX.Grid.Utils.requestAnimationFrame(BX.delegate((function(){this.fixedTable.style.marginLeft=-t+"px"}),this))},toggle:function(){this.adjustEarOffset(!0),this.fixedTable&&this.adjustFixedTablePosition(),this.hasScroll()?(this.hasScrollLeft()?this.showLeftEar():this.hideLeftEar(),this.hasScrollRight()?this.showRightEar():this.hideRightEar()):(this.hideLeftEar(),this.hideRightEar())}},BX.namespace("BX.Grid"),BX.Grid.Updater=function(t){this.parent=t},BX.Grid.Updater.prototype.getParent=function(){return this.parent},BX.Grid.Updater.prototype.updateHeadRows=function(t){BX.type.isArray(t)&&t.length&&this.getParent().getHeaders().forEach((function(e){e=BX.cleanNode(e),t.forEach((function(t){BX.type.isDomNode(t)&&e.appendChild(BX.clone(t))}))}))},BX.Grid.Updater.prototype.appendHeadRows=function(t){BX.type.isArray(t)&&t.length&&this.getParent().getHeaders().forEach((function(e){t.forEach((function(t){BX.type.isDomNode(t)&&e.appendChild(BX.clone(t))}))}))},BX.Grid.Updater.prototype.prependHeadRows=function(t){BX.type.isArray(t)&&t.length&&this.getParent().getHeaders().forEach((function(e){e=BX.cleanNode(e),t.forEach((function(t){BX.type.isDomNode(t)&&e.prepend(BX.clone(t))}))}))},BX.Grid.Updater.prototype.updateBodyRowById=function(t,e){if((BX.type.isNumber(t)||BX.type.isNotEmptyString(t))&&BX.type.isDomNode(e)){var i=this.getParent().getRows().getById(t);if(i){var n=i.getNode();BX.insertAfter(e,n),BX.remove(n)}}},BX.Grid.Updater.prototype.updateBodyRows=function(t){if(BX.type.isArray(t)){var e=this.getParent().getBody();e.innerHTML="",t.forEach((function(t){t&&e.appendChild(t)}))}},BX.Grid.Updater.prototype.appendBodyRows=function(t){var e;BX.type.isArray(t)&&(e=this.getParent().getBody(),t.forEach((function(t){BX.type.isDomNode(t)&&e.appendChild(t)})))},BX.Grid.Updater.prototype.prependBodyRows=function(t){var e;BX.type.isArray(t)&&(e=this.getParent().getBody(),t.forEach((function(t){BX.type.isDomNode(t)&&BX.prepend(e,t)})))},BX.Grid.Updater.prototype.updateFootRows=function(t){var e;BX.type.isArray(t)&&(e=BX.cleanNode(this.getParent().getFoot()),t.forEach((function(t){BX.type.isDomNode(t)&&e.appendChild(t)})))},BX.Grid.Updater.prototype.updateCounterTotal=function(t){BX.type.isDomNode(t)&&BX.cleanNode(this.getParent().getCounterTotal()).appendChild(t)},BX.Grid.Updater.prototype.updatePagination=function(t){var e=this.getParent().getPagination().getContainer();e&&(e.innerHTML="",BX.type.isDomNode(t)&&e.appendChild(t))},BX.Grid.Updater.prototype.updateMoreButton=function(t){if(BX.type.isDomNode(t)){var e=BX.Grid.Utils.closestParent(this.getParent().getMoreButton().getNode());e.innerHTML="",e.appendChild(t)}},BX.Grid.Updater.prototype.updateGroupActions=function(t){var e=this.parent.getActionsPanel();if(e&&BX.type.isDomNode(t)){var i=e.getPanel();if(BX.type.isDomNode(i)){i.innerHTML="";var n=BX.firstChild(t);BX.type.isDomNode(n)&&i.appendChild(n)}}},BX.Grid.Updater.prototype.updateContainer=function(t){BX.Type.isDomNode(t)&&(this.getParent().getContainer().className=t.className)},BX.Reflection.namespace("BX.Grid"),BX.Grid.ImageField=function(t,e){this.parent=t,this.options=e,this.cache=new BX.Cache.MemoryCache},BX.Grid.ImageField.prototype={getPreview:function(){return this.cache.remember("preview",function(){return BX.create("img",{props:{className:"main-grid-image-editor-preview"},attrs:{src:this.options.VALUE}})}.bind(this))},getFileInput:function(){return this.cache.remember("fileInput",function(){return BX.create("input",{props:{className:"main-grid-image-editor-file-input"},attrs:{type:"file",accept:"image/*",name:this.options.NAME},events:{change:function(t){var e=new FileReader;e.onload=function(t){this.getPreview().src=t.currentTarget.result}.bind(this),e.readAsDataURL(t.target.files[0]),BX.Dom.remove(this.getFakeField()),BX.Dom.append(this.getFileInput(),this.getLayout()),BX.Dom.removeClass(this.getRemoveButton(),"ui-btn-disabled"),BX.Dom.style(this.getPreview(),null)}.bind(this)}})}.bind(this))},getUploadButton:function(){return this.cache.remember("uploadButton",function(){return BX.create("button",{props:{className:"ui-btn ui-btn-xs"},text:this.parent.getParam("MAIN_UI_GRID_IMAGE_EDITOR_BUTTON_EDIT"),events:{click:function(t){t.preventDefault(),this.getFileInput().click()}.bind(this)}})}.bind(this))},getRemoveButton:function(){return this.cache.remember("removeButton",function(){return BX.create("button",{props:{className:"ui-btn ui-btn-xs ui-btn-danger"},events:{click:function(t){t.preventDefault(),BX.Dom.append(this.getFakeField(),this.getLayout()),BX.Dom.remove(this.getFileInput()),BX.Dom.addClass(this.getRemoveButton(),"ui-btn-disabled"),BX.Dom.style(this.getPreview(),{opacity:.4})}.bind(this)},text:this.parent.getParam("MAIN_UI_GRID_IMAGE_EDITOR_BUTTON_REMOVE")})}.bind(this))},getFakeField:function(){return this.cache.remember("deleted",function(){return BX.create("input",{props:{className:"main-grid-image-editor-fake-file-input"},attrs:{type:"hidden",name:this.options.NAME,value:"null"}})}.bind(this))},getLayout:function(){return this.cache.remember("layout",function(){return BX.create("div",{props:{className:"main-grid-image-editor main-grid-editor"},attrs:{name:this.options.NAME},children:[BX.create("div",{props:{className:"main-grid-image-editor-left"},children:[this.getPreview()]}),BX.create("div",{props:{className:"main-grid-image-editor-right"},children:[this.getUploadButton(),this.getRemoveButton()]}),this.getFileInput()]})}.bind(this))}},function(){BX.namespace("BX.Grid"),BX.Grid.InlineEditor=function(t,e){this.parent=null,this.types=null,this.isDropdownChangeEventSubscribed=!1,this.init(t,e)},BX.Grid.InlineEditor.prototype={init:function init(parent,types){this.parent=parent;try{this.types=eval(types)}catch(t){this.types=null}},createContainer:function(){return BX.create("div",{props:{className:this.parent.settings.get("classEditorContainer")}})},createTextarea:function(t,e){return BX.create("textarea",{props:{className:[this.parent.settings.get("classEditor"),this.parent.settings.get("classEditorTextarea")].join(" ")},attrs:{name:t.NAME,style:"height:"+e+"px"},html:t.VALUE})},createInput:function(t){var e=this.parent.settings.get("classEditorText"),i={value:void 0!==t.VALUE&&null!==t.VALUE?BX.util.htmlspecialcharsback(t.VALUE):"",name:void 0!==t.NAME&&null!==t.NAME?t.NAME:""};return t.TYPE===this.types.CHECKBOX&&(e=this.parent.settings.get("classEditorCheckbox"),i.type="checkbox",i.checked="Y"==i.value),t.TYPE===this.types.DATE&&(e=[e,this.parent.settings.get("classEditorDate")].join(" ")),t.TYPE===this.types.NUMBER&&(e=[e,this.parent.settings.get("classEditorNumber")].join(" "),i.type="number"),t.TYPE===this.types.RANGE&&(e=[e,this.parent.settings.get("classEditorRange")].join(" "),i.type="range",BX.type.isPlainObject(t.DATA)&&(i.min=t.DATA.MIN||"0",i.max=t.DATA.MAX||99999,i.step=t.DATA.STEP||"")),BX.type.isNotEmptyString(t.PLACEHOLDER)&&(i.placeholder=BX.util.htmlspecialchars(t.PLACEHOLDER)),t.DISABLED&&(i.disabled=!0),e=[this.parent.settings.get("classEditor"),e].join(" "),BX.create("input",{props:{className:e,id:t.NAME+"_control"},attrs:i})},createCustom:function(t){var e=this.parent.settings.get("classEditorCustom");return e=[this.parent.settings.get("classEditor"),e].join(" "),BX.create("div",{props:{className:e},attrs:{"data-name":t.NAME},html:t.VALUE||""})},createMoney:function(t){var e=t.VALUE,i=[],n=e.PRICE||{};if(n.PLACEHOLDER=t.PLACEHOLDER||"",i.push(this.createMoneyPrice(n)),BX.type.isArray(t.CURRENCY_LIST)&&t.CURRENCY_LIST.length>0){var s=e.CURRENCY||{};s.DATA={ITEMS:t.CURRENCY_LIST},s.HTML_ENTITY=t.HTML_ENTITY||!1,i.push(this.createMoneyCurrency(s))}if(BX.type.isNotEmptyObject(e.HIDDEN))for(var o in e.HIDDEN)if(e.HIDDEN.hasOwnProperty(o)&&BX.type.isNotEmptyString(o)){var a=this.createInput({NAME:o,VALUE:e.HIDDEN[o],TYPE:this.types.TEXT});a.type="hidden",i.push(a)}var r=this.parent.settings.get("classEditorMoney");r=[this.parent.settings.get("classEditor"),r].join(" ");var l=e.ATTRIBUTES||{};return l["data-name"]=t.NAME,BX.create("div",{props:{className:r},attrs:l,children:i})},createMoneyPrice:function(t){t.TYPE=this.types.NUMBER;var e=this.createInput(t);return e.classList.add("main-grid-editor-money-price"),main_core.Event.bind(e,"change",(function(t){var e=t.target.parentNode,i=e.querySelector(".main-grid-editor-money-currency"),n={field:e,values:{price:t.target.value||"",currency:i.dataset.value||""}};main_core_events.EventEmitter.emit("Grid.MoneyField::change",n)})),e},createMoneyCurrency:function(t){var e=this.createDropdown(t);return e.dataset.menuOffsetLeft=15,e.dataset.menuMaxHeight=200,e.classList.add("main-grid-editor-money-currency"),!0===t.DISABLED&&(e.classList.remove("main-dropdown"),e.dataset.disabled=!0),this.isDropdownChangeEventSubscribed||(this.isDropdownChangeEventSubscribed=!0,main_core_events.EventEmitter.subscribe("Dropdown::change",(function(t){var e=t.getData(),i=babelHelpers.slicedToArray(e,1)[0];if(BX.type.isNotEmptyString(i)){var n=BX.Main.dropdownManager.getById(i);if(n.dropdown&&n.dropdown.classList.contains("main-grid-editor-money-currency")){var s=n.dropdown.parentNode,o=s.querySelector(".main-grid-editor-money-price"),a={field:s,values:{price:o.value||"",currency:n.dropdown.dataset.value||""}};main_core_events.EventEmitter.emit("Grid.MoneyField::change",a)}}}))),e},createOutput:function(t){return BX.create("output",{props:{className:this.parent.settings.get("classEditorOutput")||""},attrs:{for:t.NAME+"_control"},text:t.VALUE||""})},getDropdownValueItemByValue:function(t,e){var i=t.filter((function(t){return t.VALUE===e}));return i.length>0?i[0]:t[0]},createDropdown:function(t){var e=this.getDropdownValueItemByValue(t.DATA.ITEMS,t.VALUE),i="HTML_ENTITY"in t&&!0===t.HTML_ENTITY;return BX.create("div",{props:{className:[this.parent.settings.get("classEditor"),"main-dropdown main-grid-editor-dropdown"].join(" "),id:t.NAME+"_control"},attrs:{name:t.NAME,tabindex:"0","data-items":JSON.stringify(t.DATA.ITEMS),"data-value":e.VALUE,"data-html-entity":t.HTML_ENTITY},children:[BX.create("span",{props:{className:"main-dropdown-inner"},html:i?e.NAME:null,text:i?null:e.NAME})]})},createMultiselect:function(t){var e=this,i=[],n=BX.Type.isArrayFilled(t.VALUE)?t.VALUE.map((function(n){var s,o=e.getDropdownValueItemByValue(t.DATA.ITEMS,n);i.push(o);var a=null!==(s=o.HTML)&&void 0!==s?s:BX.util.htmlspecialchars(o.NAME),r=BX.Tag.render(_templateObject||(_templateObject=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t\t\t<span class="main-ui-square">\n\t\t\t\t\t\t\t\t<span class="main-ui-square-item">','</span>\n\t\t\t\t\t\t\t\t<span class="main-ui-item-icon main-ui-square-delete"></span>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t'])),a);return BX.Dom.attr(r,"data-item",o),r})):[],s=BX.Tag.render(_templateObject2||(_templateObject2=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div \n\t\t\t\t\tclass="main-grid-editor main-ui-control main-ui-multi-select"\n\t\t\t\t\tname="','"\n\t\t\t\t\tid="','"\n\t\t\t\t>\n\t\t\t\t\t<span class="main-ui-square-container">','</span>\n\t\t\t\t\t<span class="main-ui-hide main-ui-control-value-delete">\n\t\t\t\t\t\t<span class="main-ui-control-value-delete-item"></span>\n\t\t\t\t\t</span>\n\t\t\t\t\t<span class="main-ui-square-search">\n\t\t\t\t\t\t<input type="text" class="main-ui-square-search-item">\n\t\t\t\t\t</span>\t\n\t\t\t\t</div>\n\t\t\t'])),BX.Text.encode(t.NAME),"".concat(BX.Text.encode(t.NAME),"_control"),n);return BX.Dom.attr(s,{"data-params":{isMulti:!0},"data-items":t.DATA.ITEMS,"data-value":i}),s},validateEditObject:function(t){return BX.type.isPlainObject(t)&&"TYPE"in t&&"NAME"in t&&"VALUE"in t&&(!("items"in t)||BX.type.isArray(t.items)&&t.items.length)},initCalendar:function(t){BX.calendar({node:t.target,field:t.target})},bindOnRangeChange:function(t,e){function i(t,e){BX.html(e,t.value);var i=parseFloat(t.value),n=parseFloat(t.getAttribute("max")),s=parseFloat(t.getAttribute("min")),o=(i-s)/(n-s)*100,a=Math.round(16*o/100)-8;e.style.left=o+"%",e.style.marginLeft=-a+"px"}setTimeout((function(){i(t,e)}),0),BX.bind(t,"input",(function(){i(t,e)}))},createImageEditor:function(t){return new BX.Grid.ImageField(this.parent,t).getLayout()},getEditor:function(t,e){var i,n,s=this.createContainer();if(this.validateEditObject(t))switch(t.VALUE=null===t.VALUE?"":t.VALUE,t.TYPE){case this.types.TEXT:i=this.createInput(t),BX.bind(i,"click",(function(t){t.stopPropagation()})),BX.bind(i,"keydown",BX.delegate(this._onControlKeydown,this));break;case this.types.DATE:i=this.createInput(t),BX.bind(i,"click",this.initCalendar),BX.bind(i,"click",(function(t){t.stopPropagation()})),BX.bind(i,"keydown",BX.delegate(this._onControlKeydown,this));break;case this.types.NUMBER:i=this.createInput(t),BX.bind(i,"click",(function(t){t.stopPropagation()})),BX.bind(i,"keydown",BX.delegate(this._onControlKeydown,this));break;case this.types.RANGE:i=this.createInput(t),n=this.createOutput(t),this.bindOnRangeChange(i,n),BX.bind(i,"click",(function(t){t.stopPropagation()})),BX.bind(i,"keydown",BX.delegate(this._onControlKeydown,this));break;case this.types.CHECKBOX:i=this.createInput(t),BX.bind(i,"click",(function(t){t.stopPropagation()})),BX.bind(i,"keydown",BX.delegate(this._onControlKeydown,this));break;case this.types.TEXTAREA:i=this.createTextarea(t,e),BX.bind(i,"click",(function(t){t.stopPropagation()})),BX.bind(i,"keydown",BX.delegate(this._onControlKeydown,this));break;case this.types.DROPDOWN:i=this.createDropdown(t);break;case this.types.MULTISELECT:i=this.createMultiselect(t);break;case this.types.IMAGE:i=this.createImageEditor(t);break;case this.types.MONEY:i=this.createMoney(t),BX.bind(i,"keydown",BX.delegate(this._onControlKeydown,this));break;case this.types.CUSTOM:i=this.createCustom(t),requestAnimationFrame((function(){var e=t.HTML||t.VALUE||null;e&&BX.processHTML(e).SCRIPT.forEach((function(t){t.isInternal&&t.JS&&BX.evalGlobal(t.JS)}))})),BX.bind(i,"click",(function(t){t.stopPropagation()})),BX.bind(i,"keydown",BX.delegate(this._onControlKeydown,this));break;default:break}return BX.type.isDomNode(n)&&s.appendChild(n),BX.type.isDomNode(i)&&s.appendChild(i),s},_onControlKeydown:function(t){if("Enter"===t.code){t.preventDefault();var e=BX.Grid.Utils.getBySelector(this.parent.getContainer(),"#grid_save_button > button",!0);e&&BX.fireEvent(e,"click")}}}}(),BX.namespace("BX.Grid"),BX.Grid.Loader=function(t){this.parent=null,this.container=null,this.windowHeight=null,this.tbodyPos=null,this.headerPos=null,this.lastPosTop=null,this.lastBottomPos=null,this.table=null,this.loader=null,this.adjustLoaderOffset=this.adjustLoaderOffset.bind(this),this.init(t)},BX.Grid.Loader.prototype={init:function(t){this.parent=t,this.table=this.parent.getTable(),this.loader=new BX.Loader({target:this.getContainer()})},adjustLoaderOffset:function(){this.windowHeight=BX.height(window),this.tbodyPos=BX.pos(this.table.tBodies[0]),this.headerPos=BX.pos(this.table.tHead);var t=window.scrollY;this.parent.isIE()&&(t=document.documentElement.scrollTop);var e=t+this.windowHeight-this.tbodyPos.top,i=t-this.tbodyPos.top;e>this.tbodyPos.bottom-this.tbodyPos.top&&(e=this.tbodyPos.bottom-this.tbodyPos.top),i<this.headerPos.height?i=this.headerPos.height:(e-=i,e+=this.headerPos.height),requestAnimationFrame(function(){i!==this.lastPosTop&&(this.getContainer().style.transform="translate3d(0px, "+i+"px, 0)"),e!==this.lastBottomPos&&(this.getContainer().style.height=e+"px"),this.lastPosTop=i,this.lastBottomPos=e}.bind(this))},getContainer:function(){return this.container||(this.container=BX.Grid.Utils.getByClass(this.parent.getContainer(),this.parent.settings.get("classLoader"),!0)),this.container},show:function(){if(!this.loader.isShown()){this.adjustLoaderOffset(),this.getContainer().style.display="block",this.getContainer().style.opacity="1",this.getContainer().style.visibility="visible";var t=this.parent.getRows().getCountDisplayed();t>0&&t<=2?(this.loader.setOptions({size:60}),this.loader.show()):(this.loader.setOptions({size:110}),this.loader.show())}},hide:function(){this.loader.isShown()&&(this.adjustLoaderOffset(),this.loader.hide().then(function(){this.getContainer().style.display="none"}.bind(this)))}},BX.namespace("BX.Main"),BX.Main.gridManager||(BX.Main.gridManager={data:[],push:function(t,e){if(BX.type.isNotEmptyString(t)&&e){var i={id:t,instance:e,old:null};null===this.getById(t)?this.data.push(i):this.data[0]=i}},getById:function(t){var e=this.data.filter((function(e){return e.id===t||e.id.replace("main_grid_","")===t}));return 1===e.length?e[0]:null},getInstanceById:function(t){var e=this.getById(t);return BX.type.isPlainObject(e)?e.instance:null},reload:function(t,e){var i=this.getInstanceById(t);i&&i.reload(e)},getDataIndex:function(t){var e=null;return this.data.forEach((function(i,n){i.id===t&&(e=n)})),e},destroy:function(t){if(BX.type.isNotEmptyString(t)){var e=this.getInstanceById(t);if(e instanceof BX.Main.grid){e.destroy();var i=this.getDataIndex(t);null!==i&&delete this.data[i]}}}}),BX.namespace("BX.Grid"),BX.Grid.Message=function(t,e){this.parent=null,this.types=null,this.messages=null,this.popup=null,this.init(t,e)},BX.Grid.Message.prototype={init:function(t,e){this.parent=t,this.types=e,this.show(),BX.addCustomEvent("BX.Main.grid:paramsUpdated",BX.proxy(this.onUpdated,this))},onUpdated:function(){this.show()},getData:function(){return this.parent.arParams.MESSAGES},isNeedShow:function(){return this.getData().length>0},show:function(){this.isNeedShow()&&(this.getPopup().setContent(this.getContent()),this.getPopup().show())},getContent:function(){var t=this.getData(),e=null;if(BX.type.isArray(t)&&t.length){var i={block:"main-grid-messages",content:[]};t.forEach((function(t){var e={block:"main-grid-message",mix:"main-grid-message-"+t.TYPE.toLowerCase(),content:[]};BX.type.isNotEmptyString(t.TITLE)&&e.content.push({block:"main-grid-message-title",content:BX.create("div",{html:t.TITLE}).innerText}),BX.type.isNotEmptyString(t.TEXT)&&e.content.push({block:"main-grid-message-text",content:BX.create("div",{html:t.TEXT}).innerText}),i.content.push(e)})),e=BX.decl(i)}return e},getPopup:function(){return null===this.popup&&(this.popup=new BX.PopupWindow(this.getPopupId(),null,{autoHide:!0,overlay:.3,minWidth:400,maxWidth:800,contentNoPaddings:!0,closeByEsc:!0,buttons:[new BX.PopupWindowButton({text:this.parent.getParam("CLOSE"),className:"webform-small-button-blue webform-small-button",events:{click:function(){this.popupWindow.close()}}})]})),this.popup},getPopupId:function(){return this.parent.getContainerId()+"-main-grid-message"}},BX.namespace("BX.Grid"),BX.Grid.observer={handlers:[],add:function(t,e,i,n){BX.bind(t,e,n?BX.proxy(i,n):i)}},BX.namespace("BX.Grid"),BX.Grid.Pagesize=function(t){this.parent=null,this.init(t)},BX.Grid.Pagesize.prototype={init:function(t){this.parent=t,BX.addCustomEvent("Dropdown::change",BX.proxy(this.onChange,this))},destroy:function(){BX.removeCustomEvent("Dropdown::change",BX.proxy(this.onChange,this))},onChange:function(t,e,i,n,s){var o=this;t===this.parent.getContainerId()+"_"+this.parent.settings.get("pageSizeId")&&s>=0&&(this.parent.tableFade(),this.parent.getUserOptions().setPageSize(s,(function(){o.parent.reloadTable(),BX.onCustomEvent(o.parent.getContainer(),"Grid::pageSizeChanged",[o.parent])})))}},BX.namespace("BX.Grid"),BX.Grid.Pagination=function(t){this.parent=null,this.container=null,this.links=null,this.init(t)},BX.Grid.Pagination.prototype={init:function(t){this.parent=t},getParent:function(){return this.parent},getContainer:function(){return this.container||(this.container=BX.Grid.Utils.getByClass(this.getParent().getContainer(),this.getParent().settings.get("classPagination"),!0)),this.container},getLinks:function(){var t=this,e=BX.Grid.Utils.getByTag(this.getContainer(),"a");return this.links=[],e&&(this.links=e.map((function(e){return new BX.Grid.Element(e,t.getParent())}))),this.links},getLink:function(t){var e,i=null;return BX.type.isDomNode(t)&&(e=this.getLinks().filter((function(e){return t===e.getNode()}))).length&&(i=e[0]),i}},BX.namespace("BX.Grid"),BX.Grid.PinHeader=function(t){this.parent=null,this.table=null,this.header=null,this.container=null,this.parentNodeResizeObserver=null,this.getAdminPanel()&&(this.mo=new MutationObserver(this.onAdminPanelMutation.bind(this)),this.mo.observe(document.documentElement,{attributes:!0})),this.init(t)},BX.Grid.PinHeader.prototype={init:function(t){this.parent=t,this.rect=BX.pos(this.parent.getHead()),this.gridRect=BX.pos(this.parent.getTable());var e=BX.Grid.Utils.getBySelector(document,"#workarea-content",!0);e||(e=(e=this.parent.getContainer().parentNode)?e.parentNode:e),e&&(this.parentNodeResizeObserver=new BX.ResizeObserver(BX.proxy(this.refreshRect,this)),this.parentNodeResizeObserver.observe(e)),this.create(!0),document.addEventListener("scroll",BX.proxy(this._onScroll,this),BX.Grid.Utils.listenerParams({passive:!0})),document.addEventListener("resize",BX.proxy(this._onResize,this),BX.Grid.Utils.listenerParams({passive:!0})),BX.addCustomEvent("Grid::updated",BX.proxy(this._onGridUpdate,this)),BX.addCustomEvent("Grid::resize",BX.proxy(this._onGridUpdate,this)),BX.bind(window,"resize",BX.proxy(this._onGridUpdate,this))},refreshRect:function(){this.gridRect=BX.pos(this.parent.getTable()),this.rect=BX.pos(this.parent.getHead())},_onGridUpdate:function(){var t=this.isPinned();BX.remove(this.getContainer()),this.create(),t&&this.pin(),this.table=null,this.refreshRect(),this._onScroll(),BX.onCustomEvent(window,"Grid::headerUpdated",[])},create:function(t){var e=BX.Grid.Utils.getByTag(this.parent.getHead(),"th"),i=BX.clone(this.parent.getHead()),n=BX.Grid.Utils.getByTag(i,"th"),s=function(){e.forEach((function(t,i){var s=BX.width(t);i>0&&(s-=parseInt(BX.style(t,"border-left-width")),s-=parseInt(BX.style(t,"border-right-width"))),n[i].firstElementChild&&(n[i].firstElementChild.style.width=s+"px"),e.length-1>i&&(n[i].style.width=s+"px")}))};t?setTimeout(s,0):s(),this.container=BX.decl({block:"main-grid-fixed-bar",mix:"main-grid-fixed-top",attrs:{style:"width: "+BX.width(this.parent.getContainer())+"px"},content:{block:"main-grid-table",tag:"table",content:i}}),this.container.hidden=!0,this.parent.getWrapper().appendChild(this.container)},getContainer:function(){return this.container},getFixedTable:function(){return this.table||(this.table=BX.Grid.Utils.getByTag(this.getContainer(),"table",!0))},getAdminPanel:function(){return this.adminPanel||(this.adminPanel=document.querySelector(".adm-header")),this.adminPanel},isAdminPanelPinned:function(){return BX.hasClass(document.documentElement,"adm-header-fixed")},getPinOffset:function(){var t=this.getAdminPanel();return t&&this.isAdminPanelPinned()?BX.Text.toNumber(BX.style(t,"height")):0},pin:function(){var t=this.getContainer();t&&(t.hidden=!1),BX.onCustomEvent(window,"Grid::headerPinned",[])},unpin:function(){var t=this.getContainer();t&&(t.hidden=!0),BX.onCustomEvent(window,"Grid::headerUnpinned",[])},stopPin:function(){BX.Grid.Utils.styleForEach([this.getContainer()],{position:"absolute",top:this.gridRect.bottom-this.rect.height-this.gridRect.top+"px","box-shadow":"none"})},startPin:function(){BX.Grid.Utils.styleForEach([this.getContainer()],{position:"fixed",top:this.getPinOffset()+"px","box-shadow":""})},isPinned:function(){return!this.getContainer().hidden},_onScroll:function(){var t=0;if(this.scrollRect?t=this.scrollRect.scrollTop:document.scrollingElement?this.scrollRect=document.scrollingElement:document.documentElement.scrollTop>0?this.scrollRect=document.documentElement:document.body.scrollTop>0&&(this.scrollRect=document.body),this.gridRect.bottom>t+this.rect.height){this.startPin();var e=this.getPinOffset();this.rect.top-e<=t?!this.isPinned()&&this.pin():this.isPinned()&&this.unpin()}else this.stopPin()},onAdminPanelMutation:function(){this._onScroll()},_onResize:function(){this.rect=BX.pos(this.parent.getHead())}},BX.namespace("BX.Grid"),BX.Grid.PinPanel=function(t){this.parent=null,this.panel=null,this.isSelected=null,this.offset=null,this.animationDuration=null,this.pinned=!1,this.init(t)},BX.Grid.PinPanel.prototype={init:function(t){this.parent=t,this.offset=10,this.animationDuration=200,this.panel=this.getPanel(),this.bindOnRowsEvents()},destroy:function(){this.unbindOnRowsEvents()},bindOnRowsEvents:function(){BX.addCustomEvent("Grid::thereSelectedRows",BX.proxy(this._onThereSelectedRows,this)),BX.addCustomEvent("Grid::allRowsSelected",BX.proxy(this._onThereSelectedRows,this)),BX.addCustomEvent("Grid::noSelectedRows",BX.proxy(this._onNoSelectedRows,this)),BX.addCustomEvent("Grid::allRowsUnselected",BX.proxy(this._onNoSelectedRows,this)),BX.addCustomEvent("Grid::updated",BX.proxy(this._onNoSelectedRows,this))},unbindOnRowsEvents:function(){BX.removeCustomEvent("Grid::thereSelectedRows",BX.proxy(this._onThereSelectedRows,this)),BX.removeCustomEvent("Grid::allRowsSelected",BX.proxy(this._onThereSelectedRows,this)),BX.removeCustomEvent("Grid::noSelectedRows",BX.proxy(this._onNoSelectedRows,this)),BX.removeCustomEvent("Grid::allRowsUnselected",BX.proxy(this._onNoSelectedRows,this)),BX.removeCustomEvent("Grid::updated",BX.proxy(this._onNoSelectedRows,this))},bindOnWindowEvents:function(){BX.bind(window,"resize",BX.proxy(this._onResize,this)),document.addEventListener("scroll",BX.proxy(this._onScroll,this),BX.Grid.Utils.listenerParams({passive:!0}))},unbindOnWindowEvents:function(){BX.unbind(window,"resize",BX.proxy(this._onResize,this)),document.removeEventListener("scroll",BX.proxy(this._onScroll,this),BX.Grid.Utils.listenerParams({passive:!0}))},getPanel:function(){return this.panel=this.panel||this.parent.getActionsPanel().getPanel(),this.panel},getScrollBottom:function(){return BX.scrollTop(window)+this.getWindowHeight()},getPanelRect:function(){return BX.type.isPlainObject(this.panelRect)||(this.panelRect=BX.pos(this.getPanel())),this.panelRect},getPanelPrevBottom:function(){var t=BX.previousSibling(this.getPanel());return BX.pos(t).bottom+parseFloat(BX.style(t,"margin-bottom"))},getWindowHeight:function(){return this.windowHeight=this.windowHeight||BX.height(window),this.windowHeight},pinPanel:function(t){var e=this.getPanel(),i=BX.width(this.getPanel().parentNode),n=BX.height(this.getPanel().parentNode),s=BX.pos(this.parent.getBody()),o=this.getStartDiffPanelPosition();e.parentNode.style.setProperty("height",n+"px"),e.style.setProperty("transform","translateY("+o+"px)"),e.classList.add("main-grid-fixed-bottom"),e.style.setProperty("width",i+"px"),e.style.removeProperty("position"),e.style.removeProperty("top"),requestAnimationFrame((function(){!1!==t&&e.style.setProperty("transition","transform 200ms ease"),e.style.setProperty("transform","translateY(0)")})),this.isNeedPinAbsolute()&&!this.absolutePin&&(this.absolutePin=!0,e.style.removeProperty("transition"),e.style.setProperty("position","absolute"),e.style.setProperty("top",s.top+"px")),!this.isNeedPinAbsolute()&&this.absolutePin&&(this.absolutePin=!1),this.adjustPanelPosition(),this.pinned=!0},unpinPanel:function(t){var e=this.getPanel(),i=BX.pos(e),n=BX.pos(e.parentNode),s=Math.abs(i.bottom-n.bottom);!1!==t&&e.style.setProperty("transition","transform 200ms ease");var o=s<i.height?s+"px":"100%";e.style.setProperty("transform","translateY("+o+")"),function(e,i){if(!1!==t)return setTimeout(e,i);e()}((function(){e.parentNode.style.removeProperty("height"),e.classList.remove("main-grid-fixed-bottom"),e.style.removeProperty("transition"),e.style.removeProperty("transform"),e.style.removeProperty("width"),e.style.removeProperty("position"),e.style.removeProperty("top")}),!1!==t?200:0),this.pinned=!1},isSelectedRows:function(){return this.isSelected},isNeedPinAbsolute:function(){return BX.pos(this.parent.getBody()).top+this.getPanelRect().height>=this.getScrollBottom()},isNeedPin:function(){return this.getScrollBottom()-this.getPanelRect().height<=this.getPanelPrevBottom()},adjustPanelPosition:function(){var t=window.pageXOffset;this.lastScrollX=null!==this.lastScrollX?this.lastScrollX:t,BX.Grid.Utils.requestAnimationFrame(BX.proxy((function(){if(t!==this.lastScrollX){var e=this.getPanelRect();BX.style(this.getPanel(),"left",e.left-t+"px")}}),this)),this.lastScrollX=t},pinController:function(t){if(this.getPanel()){if(!this.isPinned()&&this.isNeedPin()&&this.isSelectedRows())return this.pinPanel(t);(this.isPinned()&&!this.isNeedPin()||!this.isSelectedRows())&&this.unpinPanel(t)}},getEndDiffPanelPosition:function(){var t=BX.pos(this.getPanel()),e=BX.pos(BX.previousSibling(this.getPanel())),i=BX.scrollTop(window)+BX.height(window),n=t.height+this.offset,s=e.bottom+parseFloat(BX.style(this.getPanel(),"margin-top"));return s<i&&s+t.height>i&&(n=Math.abs(i-(s+t.height))),n},getStartDiffPanelPosition:function(){var t=BX.pos(this.getPanel()),e=BX.scrollTop(window)+BX.height(window),i=t.height;return t.bottom>e&&t.top<e&&(i=t.bottom-e),i},isPinned:function(){return this.pinned},_onThereSelectedRows:function(){this.bindOnWindowEvents(),this.isSelected=!0,this.lastIsSelected||(this.lastIsSelected=!0),this.pinController()},_onNoSelectedRows:function(){this.unbindOnWindowEvents(),this.isSelected=!1,this.pinController(),this.lastIsSelected=!1},_onScroll:function(){this.pinController(!1)},_onResize:function(){this.windowHeight=BX.height(window),this.panel=this.parent.getActionsPanel().getPanel(),this.panelRect=this.getPanel().getBoundingClientRect(),this.pinController(!1)}},BX.namespace("BX.Grid"),BX.Grid.Resize=function(t){this.parent=null,this.lastRegisterButtons=null,this.init(t)},BX.Grid.Resize.prototype={init:function(t){this.parent=t,BX.addCustomEvent(window,"Grid::updated",BX.proxy(this.registerTableButtons,this)),BX.addCustomEvent(window,"Grid::headerUpdated",BX.proxy(this.registerPinnedTableButtons,this)),this.registerTableButtons(),this.registerPinnedTableButtons()},destroy:function(){BX.removeCustomEvent(window,"Grid::updated",BX.proxy(this.registerTableButtons,this)),BX.removeCustomEvent(window,"Grid::headerUpdated",BX.proxy(this.registerPinnedTableButtons,this)),BX.type.isArray(this.lastRegisterButtons)&&this.lastRegisterButtons.forEach(jsDD.unregisterObject),(this.getButtons()||[]).forEach(jsDD.unregisterObject)},registerTableButtons:function(){(this.getButtons()||[]).forEach(this.register,this),this.registerPinnedTableButtons()},register:function(t){BX.type.isDomNode(t)&&(t.onbxdragstart=BX.delegate(this._onDragStart,this),t.onbxdragstop=BX.delegate(this._onDragEnd,this),t.onbxdrag=BX.delegate(this._onDrag,this),jsDD.registerObject(t))},registerPinnedTableButtons:function(){if(this.parent.getParam("ALLOW_PIN_HEADER")){var t=this.getPinnedTableButtons();BX.type.isArray(this.lastRegisterButtons)&&this.lastRegisterButtons.length&&this.lastRegisterButtons.forEach(jsDD.unregisterObject),this.lastRegisterButtons=t,(this.getPinnedTableButtons()||[]).forEach(this.register,this)}},getButtons:function(){return BX.Grid.Utils.getByClass(this.parent.getRows().getHeadFirstChild().getNode(),this.parent.settings.get("classResizeButton"))},getPinnedTableButtons:function(){return BX.Grid.Utils.getByClass(this.parent.getPinHeader().getFixedTable(),this.parent.settings.get("classResizeButton"))},_onDragStart:function(){var t,e=BX.findParent(jsDD.current_node,{className:this.parent.settings.get("classHeadCell")}),i=this.parent.getRows().getHeadFirstChild().getCells(),n=Object.keys(i);this.__overlay=BX.create("div",{props:{className:"main-grid-cell-overlay"}}),BX.append(this.__overlay,e),this.__resizeCell=e.cellIndex,n.forEach((function(e){if(!BX.hasClass(i[e],"main-grid-special-empty")){var n=BX.width(i[e]);e>0&&(n-=parseInt(BX.style(i[e],"border-left-width")),n-=parseInt(BX.style(i[e],"border-right-width"))),BX.width(i[e],n),t=BX.firstChild(i[e]),BX.width(t,n)}}))},_onDrag:function(t){var e,i,n,s=this.parent.getTable(),o=this.parent.getParam("ALLOW_PIN_HEADER")?this.parent.getPinHeader().getFixedTable():null,a=s.rows[0].cells[this.__resizeCell],r=BX.pos(a),l=parseFloat(a.style.width);if(n=t-=r.left,r.width>l&&(t=r.width),t=n>t?n:t,(t=Math.max(t,80))!==r.width){var d=this.parent.getAllRows()[0].querySelectorAll(".main-grid-fixed-column").length,h=this.parent.getColumnByIndex(this.__resizeCell-d);h.forEach((function(e){e.style.width=t+"px",e.style.minWidth=t+"px",e.style.maxWidth=t+"px",BX.Dom.style(e.firstElementChild,"width",t+"px")})),h[0].classList.contains("main-grid-fixed-column")&&(h=this.parent.getColumnByIndex(this.__resizeCell-d+1)).forEach((function(e){e.style.width=t+"px",e.style.minWidth=t+"px",e.style.maxWidth=t+"px"})),this.parent.adjustFixedColumnsPosition(),this.parent.adjustFadePosition(this.parent.getFadeOffset()),BX.type.isDomNode(o)&&BX.type.isDomNode(o.rows[0])&&(e=o.rows[0].cells[this.__resizeCell],(i=BX.firstChild(e)).style.width=t+"px",i.style.minWidth=t+"px",e.style.width=t+"px",e.style.minWidth=t+"px")}BX.onCustomEvent(window,"Grid::columnResize",[])},_onDragEnd:function(){this.saveSizes();var t=BX.findParent(jsDD.current_node,{className:this.parent.settings.get("classHeadCell")}).querySelector(".main-grid-cell-overlay");t&&BX.Dom.remove(t)},getColumnSizes:function(){var t,e=this.parent.getRows().getHeadFirstChild().getCells(),i={};return[].forEach.call(e,(function(e){t=BX.data(e,"name"),BX.type.isNotEmptyString(t)&&(i[t]=BX.width(e))}),this),i},saveSizes:function(){this.parent.getUserOptions().setColumnSizes(this.getColumnSizes(),1)}},function(){BX.namespace("BX.Grid"),BX.Grid.Row=function(t,e){this.node=null,this.checkbox=null,this.sort=null,this.actions=null,this.settings=null,this.index=null,this.actionsButton=null,this.parent=null,this.depth=null,this.parentId=null,this.editData=null,this.custom=null,this.onElementClick=this.onElementClick.bind(this),this.init(t,e),this.initElementsEvents()},BX.Grid.Row.prototype={init:function(t,e){BX.type.isDomNode(e)&&(this.node=e,this.parent=t,this.settings=new BX.Grid.Settings,this.bindNodes=[],this.isBodyChild()&&(this.bindNodes=[].slice.call(this.node.parentNode.querySelectorAll('tr[data-bind="'+this.getId()+'"]')),this.bindNodes.length&&(this.node.addEventListener("mouseover",this.onMouseOver.bind(this)),this.node.addEventListener("mouseleave",this.onMouseLeave.bind(this)),this.bindNodes.forEach((function(t){t.addEventListener("mouseover",this.onMouseOver.bind(this)),t.addEventListener("mouseleave",this.onMouseLeave.bind(this)),t.addEventListener("click",function(){this.isSelected()?this.unselect():this.select()}.bind(this))}),this))),this.parent.getParam("ALLOW_CONTEXT_MENU")&&BX.bind(this.getNode(),"contextmenu",BX.delegate(this._onRightClick,this)))},onMouseOver:function(){this.node.classList.add("main-grid-row-over"),this.bindNodes.forEach((function(t){t.classList.add("main-grid-row-over")}))},onMouseLeave:function(){this.node.classList.remove("main-grid-row-over"),this.bindNodes.forEach((function(t){t.classList.remove("main-grid-row-over")}))},isCustom:function(){return null===this.custom&&(this.custom=BX.hasClass(this.getNode(),this.parent.settings.get("classRowCustom"))),this.custom},_onRightClick:function(t){t.preventDefault(),this.isHeadChild()||this.showActionsMenu(t)},getDefaultAction:function(){return BX.data(this.getNode(),"default-action")},getEditorValue:function(){var t,e=this,i=this.getCells(),n={};return[].forEach.call(i,(function(i){t=e.getCellEditorValue(i),BX.type.isArray(t)?t.forEach((function(t){n[t.NAME]=void 0!==t.VALUE?t.VALUE:"",t.hasOwnProperty("RAW_NAME")&&t.hasOwnProperty("RAW_VALUE")&&(n[t.NAME+"_custom"]=n[t.NAME+"_custom"]||{},n[t.NAME+"_custom"][t.RAW_NAME]=n[t.NAME+"_custom"][t.RAW_NAME]||t.RAW_VALUE)})):t&&(n[t.NAME]=void 0!==t.VALUE?t.VALUE:"")})),n},editGetValues:function(){return this.getEditorValue()},getCellEditorValue:function(t){var e=BX.Grid.Utils.getByClass(t,this.parent.settings.get("classEditor"),!0),i=null;return BX.type.isDomNode(e)&&(i=BX.hasClass(e,"main-grid-editor-checkbox")?{NAME:e.getAttribute("name"),VALUE:e.checked?"Y":"N"}:BX.hasClass(e,"main-grid-editor-custom")?this.getCustomValue(e):BX.hasClass(e,"main-grid-editor-money")?this.getMoneyValue(e):BX.hasClass(e,"main-ui-multi-select")?this.getMultiSelectValues(e):this.getImageValue(e)),i},isEdit:function(){return BX.hasClass(this.getNode(),"main-grid-row-edit")},hide:function(){BX.addClass(this.getNode(),this.parent.settings.get("classHide"))},show:function(){BX.Dom.attr(this.getNode(),"hidden",null),BX.removeClass(this.getNode(),this.parent.settings.get("classHide"))},isShown:function(){return!BX.hasClass(this.getNode(),this.parent.settings.get("classHide"))},isNotCount:function(){return BX.hasClass(this.getNode(),this.parent.settings.get("classNotCount"))},getContentContainer:function(t){if(BX.Type.isDomNode(t)){var e=t.closest(".main-grid-cell");if(BX.Type.isDomNode(e))return e.querySelector(".main-grid-cell-content")}return t},getContent:function(t){var e,i=this.getContentContainer(t);return BX.type.isDomNode(i)&&(e=BX.html(i)),e},getMoneyValue:function(t){var e=[],i={PRICE:{},CURRENCY:{},HIDDEN:{}},n=t.getAttribute("data-name");[].slice.call(t.querySelectorAll("input")).forEach((function(t){e.push({NAME:n,RAW_NAME:t.name,RAW_VALUE:t.value||"",VALUE:t.value||""}),t.classList.contains("main-grid-editor-money-price")?i.PRICE={NAME:t.name,VALUE:t.value}:" hidden"===t.type&&(i.HIDDEN[t.name]=t.value)}));var s=t.querySelector(".main-grid-editor-dropdown");if(s){var o=s.getAttribute("name");BX.type.isNotEmptyString(o)&&(e.push({NAME:n,RAW_NAME:o,RAW_VALUE:s.dataset.value||"",VALUE:s.dataset.value||""}),i.CURRENCY={NAME:o,VALUE:s.dataset.value})}return e.push({NAME:n,VALUE:i}),e},getCustomValue:function(t){var e=new Map,i=t.getAttribute("data-name");[].slice.call(t.querySelectorAll("input, select, checkbox, textarea")).forEach((function(t){var n={NAME:i,RAW_NAME:t.name,RAW_VALUE:t.value,VALUE:t.value};switch(t.tagName){case"SELECT":if(t.multiple){var s=[];t.querySelectorAll("option").forEach((function(t){t.selected&&s.push(t.value)})),n.RAW_VALUE=s,n.VALUE=s,e.set(t.name,n)}else e.set(t.name,n);break;case"INPUT":switch(t.type.toUpperCase()){case"RADIO":t.checked&&(n.RAW_VALUE=t.value,n.VALUE=t.value,e.set(t.name,n));break;case"CHECKBOX":n.RAW_VALUE=t.checked?t.value:"",n.VALUE=t.checked?t.value:"",e.set(t.name,n);break;case"FILE":n.RAW_VALUE=t.files[0],n.VALUE=t.files[0],e.set(t.name,n);break;default:e.set(t.name,n)}break;default:e.set(t.name,n)}}));var n=[];return e.forEach((function(t){n.push(t)})),n},getImageValue:function(t){var e=null;if(BX.hasClass(t,"main-grid-image-editor")){var i=t.querySelector(".main-grid-image-editor-file-input");if(i)e={NAME:i.name,VALUE:i.files[0]};else{var n=t.querySelector(".main-grid-image-editor-fake-file-input");n&&(e={NAME:n.name,VALUE:n.value})}}else e=t.value?{NAME:t.getAttribute("name"),VALUE:t.value}:{NAME:t.getAttribute("name"),VALUE:BX.data(t,"value")};return e},getMultiSelectValues:function(t){var e=JSON.parse(BX.data(t,"value"));return{NAME:t.getAttribute("name"),VALUE:main_core.Type.isArrayFilled(e)?e:""}},getEditorContainer:function(t){return BX.Grid.Utils.getByClass(t,this.parent.settings.get("classEditorContainer"),!0)},getCollapseButton:function(){return this.collapseButton||(this.collapseButton=BX.Grid.Utils.getByClass(this.getNode(),this.parent.settings.get("classCollapseButton"),!0)),this.collapseButton},stateLoad:function(){BX.addClass(this.getNode(),this.parent.settings.get("classRowStateLoad"))},stateUnload:function(){BX.removeClass(this.getNode(),this.parent.settings.get("classRowStateLoad"))},stateExpand:function(){BX.addClass(this.getNode(),this.parent.settings.get("classRowStateExpand"))},stateCollapse:function(){BX.removeClass(this.getNode(),this.parent.settings.get("classRowStateExpand"))},getParentId:function(){return null===this.parentId&&(this.parentId=BX.data(this.getNode(),"parent-id"),void 0!==this.parentId&&null!==this.parentId&&(this.parentId=this.parentId.toString())),this.parentId},getDataset:function(){return this.getNode().dataset},getDepth:function(){return null===this.depth&&(this.depth=BX.data(this.getNode(),"depth")),this.depth},setDepth:function(t){if(t=parseInt(t),BX.type.isNumber(t)){var e=t-parseInt(this.getDepth()),i=this.parent.getRows();this.getDataset().depth=t,this.getShiftCells().forEach((function(e){BX.data(e,"depth",t),BX.style(e,"padding-left",20*t+"px")}),this),i.getRowsByParentId(this.getId(),!0).forEach((function(t){var i=parseInt(e)+parseInt(t.getDepth());t.getDataset().depth=i,t.getShiftCells().forEach((function(t){BX.data(t,"depth",i),BX.style(t,"padding-left",20*i+"px")}))}))}},setParentId:function(t){this.getDataset().parentId=t},getShiftCells:function(){return BX.Grid.Utils.getBySelector(this.getNode(),'td[data-shift="true"]')},showChildRows:function(){var t=this.getChildren(),e=this.isCustom();t.forEach((function(t){t.show(),!e&&t.isExpand()&&t.showChildRows()})),this.parent.updateCounterDisplayed(),this.parent.updateCounterSelected(),this.parent.adjustCheckAllCheckboxes(),this.parent.adjustRows()},getChildren:function(){var t=this.isCustom()?"getRowsByGroupId":"getRowsByParentId",e=this.isCustom()?this.getGroupId():this.getId();return this.parent.getRows()[t](e,!0)},hideChildRows:function(){this.getChildren().forEach((function(t){t.hide()})),this.parent.updateCounterDisplayed(),this.parent.updateCounterSelected(),this.parent.adjustCheckAllCheckboxes(),this.parent.adjustRows()},isChildsLoaded:function(){return BX.type.isBoolean(this.childsLoaded)||(this.childsLoaded=this.isCustom()||"true"===BX.data(this.getNode(),"child-loaded")),this.childsLoaded},expand:function(){var t=this;this.stateExpand(),this.isChildsLoaded()?this.showChildRows():(this.stateLoad(),this.loadChildRows((function(e){e.reverse().forEach((function(e){BX.insertAfter(e,t.getNode())})),t.parent.getRows().reset(),t.parent.bindOnRowEvents(),t.parent.getParam("ALLOW_ROWS_SORT")&&t.parent.getRowsSortable().reinit(),t.parent.getParam("ALLOW_COLUMNS_SORT")&&t.parent.getColsSortable().reinit(),t.stateUnload(),BX.data(t.getNode(),"child-loaded","true"),t.parent.updateCounterDisplayed(),t.parent.updateCounterSelected(),t.parent.adjustCheckAllCheckboxes()})))},collapse:function(){this.stateCollapse(),this.hideChildRows()},isExpand:function(){return BX.hasClass(this.getNode(),this.parent.settings.get("classRowStateExpand"))},toggleChildRows:function(){this.isExpand()?this.collapse():this.expand()},loadChildRows:function(t){if(BX.type.isFunction(t)){var e=this,i=parseInt(this.getDepth()),n=this.parent.getUserOptions().getAction("GRID_GET_CHILD_ROWS");i=BX.type.isNumber(i)?i+1:1,this.parent.getData().request("","POST",{action:n,parent_id:this.getId(),depth:i},null,(function(){var i=this.getRowsByParentId(e.getId());t.apply(null,[i])}))}},update:function(t,e,i){t=t||"";var n=this.parent.getUserOptions().getAction("GRID_UPDATE_ROW"),s=this.getDepth(),o=this.getId(),a=this.getParentId(),r={id:o,parentId:a,action:n,depth:s,data:t},l=this;this.stateLoad(),this.parent.getData().request(e,"POST",r,null,(function(){var e=this.getBodyRows();l.parent.getUpdater().updateBodyRows(e),l.stateUnload(),l.parent.getRows().reset(),l.parent.getUpdater().updateFootRows(this.getFootRows()),l.parent.getUpdater().updatePagination(this.getPagination()),l.parent.getUpdater().updateMoreButton(this.getMoreButton()),l.parent.getUpdater().updateCounterTotal(this.getCounterTotal()),l.parent.bindOnRowEvents(),l.parent.adjustEmptyTable(e),l.parent.bindOnMoreButtonEvents(),l.parent.bindOnClickPaginationLinks(),l.parent.updateCounterDisplayed(),l.parent.updateCounterSelected(),l.parent.getParam("ALLOW_COLUMNS_SORT")&&l.parent.colsSortable.reinit(),l.parent.getParam("ALLOW_ROWS_SORT")&&l.parent.rowsSortable.reinit(),BX.onCustomEvent(window,"Grid::rowUpdated",[{id:o,data:t,grid:l.parent,response:this}]),BX.onCustomEvent(window,"Grid::updated",[l.parent]),BX.type.isFunction(i)&&i({id:o,data:t,grid:l.parent,response:this})}))},remove:function(t,e,i){t=t||"";var n=this.parent.getUserOptions().getAction("GRID_DELETE_ROW"),s=this.getDepth(),o=this.getId(),a=this.getParentId(),r={id:o,parentId:a,action:n,depth:s,data:t},l=this;this.stateLoad(),this.parent.getData().request(e,"POST",r,null,(function(){var e=this.getBodyRows();l.parent.getUpdater().updateBodyRows(e),l.stateUnload(),l.parent.getRows().reset(),l.parent.getUpdater().updateFootRows(this.getFootRows()),l.parent.getUpdater().updatePagination(this.getPagination()),l.parent.getUpdater().updateMoreButton(this.getMoreButton()),l.parent.getUpdater().updateCounterTotal(this.getCounterTotal()),l.parent.bindOnRowEvents(),l.parent.adjustEmptyTable(e),l.parent.bindOnMoreButtonEvents(),l.parent.bindOnClickPaginationLinks(),l.parent.updateCounterDisplayed(),l.parent.updateCounterSelected(),l.parent.getParam("ALLOW_COLUMNS_SORT")&&l.parent.colsSortable.reinit(),l.parent.getParam("ALLOW_ROWS_SORT")&&l.parent.rowsSortable.reinit(),BX.onCustomEvent(window,"Grid::rowRemoved",[{id:o,data:t,grid:l.parent,response:this}]),BX.onCustomEvent(window,"Grid::updated",[l.parent]),BX.type.isFunction(i)&&i({id:o,data:t,grid:l.parent,response:this})}))},editCancel:function(){var t,e=this.getCells(),i=this;[].forEach.call(e,(function(e){t=i.getEditorContainer(e),BX.type.isDomNode(t)&&(BX.remove(i.getEditorContainer(e)),BX.show(i.getContentContainer(e)))})),BX.removeClass(this.getNode(),"main-grid-row-edit")},getCellByIndex:function(t){return this.getCells()[t]},getEditDataByCellIndex:function getEditDataByCellIndex(index){return eval(BX.data(this.getCellByIndex(index),"edit"))},getCellNameByCellIndex:function(t){return BX.data(this.getCellByIndex(t),"name")},resetEditData:function(){this.editData=null},setEditData:function(t){this.editData=t},getEditData:function(){if(null===this.editData){var t=this.parent.getParam("EDITABLE_DATA"),e=this.getId();BX.type.isPlainObject(t)&&e in t?this.editData=t[e]:this.editData={}}return this.editData},getCellEditDataByCellIndex:function(t){var e=this.getEditData(),i=null;if(t=parseInt(t),BX.type.isNumber(t)&&BX.type.isPlainObject(e)){var n=this.parent.getRows().getHeadFirstChild().getEditDataByCellIndex(t);BX.type.isPlainObject(n)&&((i=n).VALUE=e[n.NAME])}return i},edit:function(){var t,e,i,n,s=this.getCells(),o=this;[].forEach.call(s,(function(s,a){if("true"===s.dataset.editable){try{t=o.getCellEditDataByCellIndex(a)}catch(t){throw new Error(t)}o.parent.getEditor().validateEditObject(t)&&(n=o.getContentContainer(s),i=BX.height(n),e=o.parent.getEditor().getEditor(t,i),!o.getEditorContainer(s)&&BX.type.isDomNode(e)&&(s.appendChild(e),BX.hide(n)))}})),BX.addClass(this.getNode(),"main-grid-row-edit")},setDraggable:function(t){t?(BX.removeClass(this.getNode(),this.parent.settings.get("classDisableDrag")),this.parent.getRowsSortable().register(this.getNode())):(BX.addClass(this.getNode(),this.parent.settings.get("classDisableDrag")),this.parent.getRowsSortable().unregister(this.getNode()))},isDraggable:function(){return!BX.hasClass(this.getNode(),this.parent.settings.get("classDisableDrag"))},getNode:function(){return this.node},getIndex:function(){return this.getNode().rowIndex},getId:function(){return String(BX.data(this.getNode(),"id"))},getGroupId:function(){return BX.data(this.getNode(),"group-id").toString()},getObserver:function(){return BX.Grid.observer},getCheckbox:function(){return this.checkbox||(this.checkbox=BX.Grid.Utils.getByClass(this.getNode(),this.settings.get("classRowCheckbox"),!0)),this.checkbox},getActionsMenu:function(){if(!this.actionsMenu){var t=this.getActionsButton().getBoundingClientRect();this.actionsMenu=BX.PopupMenu.create("main-grid-actions-menu-"+this.getId(),this.getActionsButton(),this.getMenuItems(),{autoHide:!0,offsetTop:-(t.height/2+26),offsetLeft:30,angle:{position:"left",offset:t.height/2-8},events:{onPopupClose:BX.delegate(this._onCloseMenu,this),onPopupShow:BX.delegate(this._onPopupShow,this)}}),BX.addCustomEvent("Grid::updated",function(){this.actionsMenu&&(this.actionsMenu.destroy(),this.actionsMenu=null)}.bind(this)),BX.bind(this.actionsMenu.popupWindow.popupContainer,"click",BX.delegate((function(t){var e=this.getActionsMenu();if(e){var i=BX.getEventTarget(t),n=BX.findParent(i,{className:"menu-popup-item"},10);n&&n.dataset.preventCloseContextMenu||e.close()}}),this))}return this.actionsMenu},_onCloseMenu:function(){},_onPopupShow:function(t){t.setBindElement(this.getActionsButton())},actionsMenuIsShown:function(){return this.getActionsMenu().popupWindow.isShown()},showActionsMenu:function(t){BX.fireEvent(document.body,"click"),this.getActionsMenu().popupWindow.show(),t&&(this.getActionsMenu().popupWindow.popupContainer.style.top=t.pageY-25+BX.PopupWindow.getOption("offsetTop")+"px",this.getActionsMenu().popupWindow.popupContainer.style.left=t.pageX+20+BX.PopupWindow.getOption("offsetLeft")+"px")},closeActionsMenu:function(){this.actionsMenu&&this.actionsMenu.popupWindow&&this.actionsMenu.popupWindow.close()},getMenuItems:function(){return this.getActions()||[]},getActions:function getActions(){try{this.actions=this.actions||eval(BX.data(this.getActionsButton(),this.settings.get("dataActionsKey")))}catch(t){this.actions=null}return this.actions},getActionsButton:function(){return this.actionsButton||(this.actionsButton=BX.Grid.Utils.getByClass(this.getNode(),this.settings.get("classRowActionButton"),!0)),this.actionsButton},initSelect:function(){this.isSelected()&&!BX.hasClass(this.getNode(),this.settings.get("classCheckedRow"))&&BX.addClass(this.getNode(),this.settings.get("classCheckedRow"))},getParentNode:function(){var t;try{t=this.getNode().parentNode}catch(e){t=null}return t},getParentNodeName:function(){var t;try{t=this.getParentNode().nodeName}catch(e){t=null}return t},isSelectable:function(){return!this.isEdit()||this.parent.getParam("ALLOW_EDIT_SELECTION")},select:function(){var t;!this.isSelectable()||!this.parent.getParam("ADVANCED_EDIT_MODE")&&this.parent.getRows().hasEditable()||(t=this.getCheckbox())&&(BX.data(t,"disabled")||(BX.addClass(this.getNode(),this.settings.get("classCheckedRow")),this.bindNodes.forEach((function(t){BX.addClass(t,this.settings.get("classCheckedRow"))}),this),t.checked=!0))},unselect:function(){this.isSelectable()&&(BX.removeClass(this.getNode(),this.settings.get("classCheckedRow")),this.bindNodes.forEach((function(t){BX.removeClass(t,this.settings.get("classCheckedRow"))}),this),this.getCheckbox()&&(this.getCheckbox().checked=!1))},getCells:function(){return this.getNode().cells},isSelected:function(){return this.getCheckbox()&&this.getCheckbox().checked||BX.hasClass(this.getNode(),this.settings.get("classCheckedRow"))},isHeadChild:function(){return"THEAD"===this.getParentNodeName()&&BX.hasClass(this.getNode(),this.settings.get("classHeadRow"))},isBodyChild:function(){return BX.hasClass(this.getNode(),this.settings.get("classBodyRow"))&&!BX.hasClass(this.getNode(),this.settings.get("classEmptyRows"))},isFootChild:function(){return"TFOOT"===this.getParentNodeName()&&BX.hasClass(this.getNode(),this.settings.get("classFootRow"))},prependTo:function(t){BX.Dom.prepend(this.getNode(),t)},appendTo:function(t){BX.Dom.append(this.getNode(),t)},setId:function(t){BX.Dom.attr(this.getNode(),"data-id",t)},setActions:function(t){var e=this.getNode().querySelector(".main-grid-cell-action");if(e){var i=e.querySelector(".main-grid-row-action-button");if(!i){i=BX.Dom.create({tag:"div",props:{className:"main-grid-row-action-button"}});var n=this.getContentContainer(e);BX.Dom.append(i,n)}BX.Dom.attr(i,{href:"#","data-actions":t}),this.actions=t,this.actionsMenu&&(this.actionsMenu.destroy(),this.actionsMenu=null)}},makeCountable:function(){BX.Dom.removeClass(this.getNode(),"main-grid-not-count")},makeNotCountable:function(){BX.Dom.addClass(this.getNode(),"main-grid-not-count")},getColumnOptions:function(t){var e=this.parent.getParam("COLUMNS_ALL");return BX.Type.isPlainObject(e)&&Reflect.has(e,t)?e[t]:null},setCellsContent:function(t){var e=this,i=this.parent.getRows().getHeadFirstChild();babelHelpers.toConsumableArray(this.getCells()).forEach((function(n,s){var o=i.getCellNameByCellIndex(s);if(Reflect.has(t,o)){var a=e.getColumnOptions(o),r=e.getContentContainer(n),l=t[o];if("labels"===a.type&&BX.Type.isArray(l)){var d=l.map((function(t){var i=BX.Tag.render(_templateObject$1||(_templateObject$1=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t\t\t\t<span class="ui-label ','"></span>\n\t\t\t\t\t\t\t'])),t.color);!0!==t.light&&BX.Dom.addClass(i,"ui-label-fill"),BX.Type.isPlainObject(t.events)&&(Reflect.has(t.events,"click")&&BX.Dom.addClass(i,"ui-label-link"),e.bindOnEvents(i,t.events));var n=BX.Type.isStringFilled(t.html)?t.html:t.text,s=BX.Tag.render(_templateObject2$1||(_templateObject2$1=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t\t\t\t<span class="ui-label-inner">',"</span>\n\t\t\t\t\t\t\t"])),n);if(BX.Dom.append(s,i),BX.Type.isPlainObject(t.removeButton)){var o=t.removeButton.type===BX.Grid.Label.RemoveButtonType.INSIDE?BX.Tag.render(_templateObject3||(_templateObject3=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t\t\t\t\t\t\t<span class="ui-label-icon"></span>\t\n\t\t\t\t\t\t\t\t\t\t']))):BX.Tag.render(_templateObject4||(_templateObject4=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t\t\t\t\t\t<span class="main-grid-label-remove-button ','"></span>\t\n\t\t\t\t\t\t\t\t\t'])),t.removeButton.type);BX.Type.isPlainObject(t.removeButton.events)&&e.bindOnEvents(o,t.removeButton.events),BX.Dom.append(o,i)}return i})),h=BX.Tag.render(_templateObject5||(_templateObject5=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t\t\t<div class="main-grid-labels">',"</div>\n\t\t\t\t\t\t"])),d);BX.Dom.clean(r);var c=r.querySelector(".main-grid-labels");BX.Type.isDomNode(c)?BX.Dom.replace(c,h):BX.Dom.append(h,r)}else if("tags"===a.type&&BX.Type.isPlainObject(l)){var u=l.items.map((function(t){var i=BX.Tag.render(_templateObject6||(_templateObject6=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t\t\t\t<span class="main-grid-tag"></span>\n\t\t\t\t\t\t\t'])));e.bindOnEvents(i,t.events),!0===t.active&&BX.Dom.addClass(i,"main-grid-tag-active");var n=BX.Type.isStringFilled(t.html)?t.html:BX.Text.encode(t.text),s=BX.Tag.render(_templateObject7||(_templateObject7=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t\t\t\t<span class="main-grid-tag-inner">',"</span>\n\t\t\t\t\t\t\t"])),n);if(BX.Dom.append(s,i),!0===t.active){var o=BX.Tag.render(_templateObject8||(_templateObject8=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t\t\t\t\t<span class="main-grid-tag-remove"></span>\n\t\t\t\t\t\t\t\t'])));BX.Dom.append(o,i),BX.Type.isPlainObject(t.removeButton)&&e.bindOnEvents(o,t.removeButton.events)}return i})),g=BX.Tag.render(_templateObject9||(_templateObject9=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t\t\t<span class="main-grid-tags">',"</span>\n\t\t\t\t\t\t"])),u),p=BX.Tag.render(_templateObject10||(_templateObject10=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t\t\t<span class="main-grid-tag-add"></span>\n\t\t\t\t\t\t'])));BX.Type.isPlainObject(l.addButton)&&e.bindOnEvents(p,l.addButton.events),BX.Dom.append(p,g);var m=r.querySelector(".main-grid-tags");BX.Type.isDomNode(m)?BX.Dom.replace(m,g):BX.Dom.append(g,r)}else BX.Runtime.html(r,l)}}))},getCellById:function(t){var e=this.parent.getRows().getHeadFirstChild();return babelHelpers.toConsumableArray(this.getCells()).find((function(i,n){return e.getCellNameByCellIndex(n)===t}))},isTemplate:function(){return this.isBodyChild()&&/^template_[0-9]$/.test(this.getId())},enableAbsolutePosition:function(){var t=babelHelpers.toConsumableArray(this.parent.getRows().getHeadFirstChild().getCells()).map((function(t){return BX.Dom.style(t,"width")})),e=this.getCells();t.forEach((function(t,i){BX.Dom.style(e[i],"width",t)})),BX.Dom.style(this.getNode(),"position","absolute")},disableAbsolutePosition:function(){BX.Dom.style(this.getNode(),"position",null)},getHeight:function(){return BX.Text.toNumber(BX.Dom.style(this.getNode(),"height"))},setCellActions:function(t){var e=this;Object.entries(t).forEach((function(t){var i=babelHelpers.slicedToArray(t,2),n=i[0],s=i[1],o=e.getCellById(n);if(o){var a=o.querySelector(".main-grid-cell-inner");if(a){var r=function(){var t=a.querySelector(".main-grid-cell-content-actions");if(t)return BX.Dom.clean(t),t;var e=BX.Tag.render(_templateObject11||(_templateObject11=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t\t\t\t<div class="main-grid-cell-content-actions"></div>\n\t\t\t\t\t\t\t'])));return BX.Dom.append(e,a),e}();BX.Type.isArrayFilled(s)&&s.forEach((function(t){var i=BX.Type.isArrayFilled(t.class)?t.class.join(" "):t.class,n=BX.Tag.render(_templateObject12||(_templateObject12=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t\t\t\t\t<span class="main-grid-cell-content-action ','"></span>\n\t\t\t\t\t\t\t\t'])),i);BX.Type.isPlainObject(t.events)&&e.bindOnEvents(n,t.events),BX.Type.isPlainObject(t.attributes)&&BX.Dom.attr(n,t.attributes),BX.Dom.append(n,r)}))}}}))},initElementsEvents:function initElementsEvents(){var _this3=this,buttons=babelHelpers.toConsumableArray(this.getNode().querySelectorAll(".main-grid-cell [data-events]"));BX.Type.isArrayFilled(buttons)&&buttons.forEach((function(button){var events=eval(BX.Dom.attr(button,"data-events"));BX.Type.isPlainObject(events)&&(BX.Dom.attr(button,"data-events",null),_this3.bindOnEvents(button,events))}))},onElementClick:function(t){t.stopPropagation()},bindOnEvents:function bindOnEvents(button,events){if(BX.Type.isDomNode(button)&&BX.Type.isPlainObject(events)){BX.Event.bind(button,"click",this.onElementClick.bind(this));var target=(selector=BX.Dom.attr(button,"data-target"),selector?button.closest(selector):button),event=new BX.Event.BaseEvent({data:{button:button,target:target,row:this}});event.setTarget(target),Object.entries(events).forEach((function(_ref3){var _ref4=babelHelpers.slicedToArray(_ref3,2),eventName=_ref4[0],handler=_ref4[1],preparedHandler=eval(handler);BX.Event.bind(button,eventName,preparedHandler.bind(null,event))}))}var selector},setCounters:function(t){var e=this;BX.Type.isPlainObject(t)&&Object.entries(t).forEach((function(t){var i,n=babelHelpers.slicedToArray(t,2),s=n[0],o=n[1],a=e.getCellById(s);if(BX.Type.isDomNode(a)){var r=a.querySelector(".main-grid-cell-inner"),l=(i=a.querySelector(".main-grid-cell-counter"),BX.Type.isDomNode(i)?i:BX.Tag.render(_templateObject13||(_templateObject13=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t\t\t\t<span class="main-grid-cell-counter"></span>\n\t\t\t\t\t\t\t'])))),d=function(){var t=l.querySelector(".ui-counter");if(BX.Type.isDomNode(t))return t;var e=BX.Tag.render(_templateObject14||(_templateObject14=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t\t\t\t<span class="ui-counter"></span>\n\t\t\t\t\t\t\t'])));return BX.Dom.append(e,l),e}();BX.Type.isPlainObject(o.events)&&e.bindOnEvents(d,o.events);var h=function(){var t=d.querySelector(".ui-counter-inner");if(BX.Type.isDomNode(t))return t;var e=BX.Tag.render(_templateObject15||(_templateObject15=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t\t\t\t<span class="ui-counter-inner"></span>\n\t\t\t\t\t\t\t'])));return BX.Dom.append(e,d),e}();if(BX.Type.isStringFilled(o.type)&&(Object.values(BX.Grid.Counters.Type).forEach((function(t){BX.Dom.removeClass(l,"main-grid-cell-counter-".concat(t))})),BX.Dom.addClass(l,"main-grid-cell-counter-".concat(o.type))),BX.Type.isStringFilled(o.color)&&(Object.values(BX.Grid.Counters.Color).forEach((function(t){BX.Dom.removeClass(d,t)})),BX.Dom.addClass(d,o.color)),BX.Type.isStringFilled(o.size)&&(Object.values(BX.Grid.Counters.Size).forEach((function(t){BX.Dom.removeClass(d,t)})),BX.Dom.addClass(d,o.size)),BX.Type.isStringFilled(o.class)&&BX.Dom.addClass(d,o.class),BX.Type.isStringFilled(o.value)||BX.Type.isNumber(o.value)){var c=BX.Text.toNumber(h.innerText),u=BX.Text.toNumber(o.value);u>0&&(h.innerText=u<100?o.value:"99+",!1!==o.animation&&(u!==c&&(u>c?BX.Dom.addClass(h,"ui-counter-plus"):BX.Dom.addClass(h,"ui-counter-minus")),BX.Event.bindOnce(h,"animationend",(function(t){"uiCounterPlus"!==t.animationName&&"uiCounterMinus"!==t.animationName||BX.Dom.removeClass(h,["ui-counter-plus","ui-counter-minus"])}))))}if(BX.Text.toNumber(o.value)>0){var g=o.type===BX.Grid.Counters.Type.RIGHT?"right":"left";"left"===g?BX.Dom.prepend(l,r):"right"===g&&BX.Dom.append(l,r)}else{var p="main-grid-cell-counter-".concat(BX.Grid.Counters.Type.LEFT_ALIGNED);BX.Dom.hasClass(l,p)?BX.remove(d):BX.remove(l)}}}))}}}(),BX.namespace("BX.Grid"),BX.Grid.Rows=function(t){this.parent=null,this.rows=null,this.headChild=null,this.bodyChild=null,this.footChild=null,this.init(t)},BX.Grid.Rows.prototype={init:function(t){this.parent=t},reset:function(){this.rows=null,this.headChild=null,this.bodyChild=null,this.footChild=null},enableDragAndDrop:function(){this.parent.arParams.ALLOW_ROWS_SORT=!0,this.parent.getRowsSortable()instanceof BX.Grid.RowsSortable||(this.parent.rowsSortable=new BX.Grid.RowsSortable(this.parent))},disableDragAndDrop:function(){this.parent.arParams.ALLOW_ROWS_SORT=!1,this.parent.getRowsSortable()instanceof BX.Grid.RowsSortable&&(this.parent.getRowsSortable().destroy(),this.parent.rowsSortable=null)},getFootLastChild:function(){return this.getLast(this.getFootChild())},getFootFirstChild:function(){return this.getFirst(this.getFootChild())},getBodyLastChild:function(){return this.getLast(this.getBodyChild())},getBodyFirstChild:function(){return this.getFirst(this.getBodyChild())},getHeadLastChild:function(){return this.getLast(this.getHeadChild())},getHeadFirstChild:function(){return this.getFirst(this.getHeadChild())},getEditSelectedValues:function(t){var e=this.getSelected(t),i={};return e.forEach((function(t){i[t.getId()]=t.editGetValues()})),i},getSelectedIds:function(t){return this.getSelected(t).map((function(t){return t.getId()}))},initSelected:function(){var t=this.getSelected();BX.type.isArray(t)&&t.length&&(t.forEach((function(t){t.initSelect()})),this.parent.enableActionsPanel())},editSelected:function(){this.getSelected().forEach((function(t){t.edit()})),BX.onCustomEvent(window,"Grid::thereEditedRows",[])},editSelectedCancel:function(t){this.getSelected(t).forEach((function(t){t.editCancel()})),BX.onCustomEvent(window,"Grid::noEditedRows",[])},isSelected:function(){return this.getBodyChild().some((function(t){return t.isShown()&&t.isSelected()}))},isAllSelected:function(){return!this.getBodyChild().filter((function(t){return!!t.getCheckbox()})).some((function(t){return!t.isSelected()}))},getParent:function(){return this.parent},getCountSelected:function(){var t;try{t=this.getSelected().filter((function(t){return!t.isNotCount()&&t.isShown()})).length}catch(e){t=0}return t},getCountDisplayed:function(){var t;try{t=this.getBodyChild().filter((function(t){return t.isShown()&&!t.isNotCount()})).length}catch(e){t=0}return t},addRows:function(t){var e=BX.findChild(this.getParent().getTable(),{tag:"TBODY"},!0,!1);t.forEach((function(t){e.appendChild(t)}))},getRows:function(){var t,e=this;return this.rows||(t=[].slice.call(this.getParent().getTable().querySelectorAll("tr[data-id], thead > tr")),this.rows=t.map((function(t){return new BX.Grid.Row(e.parent,t)}))),this.rows},getSelected:function(t){return this.getBodyChild(t).filter((function(t){return t.isShown()&&t.isSelected()}))},normalizeNode:function(t){return BX.hasClass(t,this.getParent().settings.get("classBodyRow"))||(t=BX.findParent(t,{className:this.getParent().settings.get("classBodyRow")},!0,!1)),t},getById:function(t){return this.getBodyChild().find((function(e){return String(e.getId())===String(t)}))||null},get:function(t){if(BX.Type.isDomNode(t)){var e=t.closest(".main-grid-row");if(BX.Type.isDomNode(e)){var i=this.getRows().find((function(t){return t.getNode()===e}));if(i)return i}}return null},getLast:function(t){var e;try{e=t[t.length-1]}catch(t){e=null}return e},getFirst:function(t){var e;try{e=t[0]}catch(t){e=null}return e},getHeadChild:function(){return this.headChild=this.headChild||this.getRows().filter((function(t){return t.isHeadChild()})),this.headChild},getBodyChild:function(t){return this.getRows().filter((function(e){return e.isBodyChild()&&(!e.isTemplate()||t)}))},getFootChild:function(){return this.footChild=this.footChild||this.getRows().filter((function(t){return t.isFootChild()})),this.footChild},selectAll:function(){this.getRows().map((function(t){t.isShown()&&t.select()}))},unselectAll:function(){this.getRows().map((function(t){t.unselect()}))},getByIndex:function(t){var e=this.getBodyChild().filter((function(t){return t})).filter((function(e){return e.getNode().rowIndex===t}));return e.length?e[0]:null},getRowsByParentId:function(t,e){var i=[],n=this;return t?(function t(s){n.getBodyChild().forEach((function(n){n.getParentId()===s&&(i.push(n),e&&t(n.getId()))}),n)}(t=t.toString()),i):i},getRowsByGroupId:function(t){var e=[],i=this;return t?(function(t){i.getBodyChild().forEach((function(i){i.getGroupId()!==t||i.isCustom()||e.push(i)}),i)}(t=t.toString()),e):e},getExpandedRows:function(){return this.getRows().filter((function(t){return t.isShown()&&t.isExpand()}))},getIdsExpandedRows:function(){return this.getExpandedRows().map((function(t){return t.getId()}))},getIdsCollapsedGroups:function(){return this.getRows().filter((function(t){return t.isCustom()&&!t.isExpand()})).map((function(t){return t.getId()}))},getSourceRows:function(){return BX.Grid.Utils.getBySelector(this.getParent().getTable(),[".main-grid-header > tr",".main-grid-header + tbody > tr"].join(", "))},getSourceBodyChild:function(){return this.getSourceRows().filter((function(t){return"TBODY"===BX.Grid.Utils.closestParent(t).nodeName}))},getSourceHeadChild:function(){return this.getSourceRows().filter((function(t){return"THEAD"===BX.Grid.Utils.closestParent(t).nodeName}))},getSourceFootChild:function(){return this.getSourceRows().filter((function(t){return"TFOOT"===BX.Grid.Utils.closestParent(t).nodeName}))},hasEditable:function(){return this.getBodyChild().some((function(t){return t.isEdit()}))},insertAfter:function(t,e){var i=this.getById(t),n=this.getById(e);i&&n&&(BX.Dom.insertAfter(i.getNode(),n.getNode()),this.reset())},insertBefore:function(t,e){var i=this.getById(t),n=this.getById(e);i&&n&&(BX.Dom.insertBefore(i.getNode(),n.getNode()),this.reset())}},BX.namespace("BX.Grid"),BX.Grid.RowDragEvent=function(t){this.allowMoveRow=!0,this.allowInsertBeforeTarget=!0,this.dragItem=null,this.targetItem=null,this.eventName=t||"",this.errorMessage=""},BX.Grid.RowDragEvent.prototype={allowMove:function(){this.allowMoveRow=!0,this.errorMessage=""},allowInsertBefore:function(){this.allowInsertBeforeTarget=!0},disallowMove:function(t){this.allowMoveRow=!1,this.errorMessage=t||""},disallowInsertBefore:function(){this.allowInsertBeforeTarget=!1},getDragItem:function(){return this.dragItem},getTargetItem:function(){return this.targetItem},getEventName:function(){return this.eventName},setDragItem:function(t){return this.dragItem=t},setTargetItem:function(t){return this.targetItem=t},setEventName:function(t){return this.eventName=t},isAllowedMove:function(){return this.allowMoveRow},isAllowedInsertBefore:function(){return this.allowInsertBeforeTarget},getErrorMessage:function(){return this.errorMessage}},BX.Grid.RowsSortable=function(t){this.parent=null,this.list=null,this.setDefaultProps(),this.init(t)},BX.Grid.RowsSortable.prototype={init:function(t){this.parent=t,this.list=this.getList(),this.prepareListItems(),jsDD.Enable(),this.inited||(this.inited=!0,this.onscrollDebounceHandler=BX.debounce(this._onWindowScroll,300,this),this.parent.getParam("ALLOW_ROWS_SORT_IN_EDIT_MODE",!1)||(BX.addCustomEvent("Grid::thereEditedRows",BX.proxy(this.disable,this)),BX.addCustomEvent("Grid::noEditedRows",BX.proxy(this.enable,this))),document.addEventListener("scroll",this.onscrollDebounceHandler,BX.Grid.Utils.listenerParams({passive:!0})))},destroy:function(){this.parent.getParam("ALLOW_ROWS_SORT_IN_EDIT_MODE",!1)||(BX.removeCustomEvent("Grid::thereEditedRows",BX.proxy(this.disable,this)),BX.removeCustomEvent("Grid::noEditedRows",BX.proxy(this.enable,this))),document.removeEventListener("scroll",this.onscrollDebounceHandler,BX.Grid.Utils.listenerParams({passive:!0})),this.unregisterObjects()},_onWindowScroll:function(){this.windowScrollTop=BX.scrollTop(window),this.rowsRectList=null},disable:function(){this.unregisterObjects()},enable:function(){this.reinit()},reinit:function(){this.unregisterObjects(),this.setDefaultProps(),this.init(this.parent)},getList:function(){return this.parent.getRows().getSourceBodyChild()},unregisterObjects:function(){this.list.forEach(this.unregister,this)},prepareListItems:function(){this.list.forEach(this.register,this)},register:function(t){var e=this.parent.getRows().get(t);e&&e.isDraggable()&&(t.onbxdragstart=BX.delegate(this._onDragStart,this),t.onbxdrag=BX.delegate(this._onDrag,this),t.onbxdragstop=BX.delegate(this._onDragEnd,this),jsDD.registerObject(t))},unregister:function(t){jsDD.unregisterObject(t)},getIndex:function(t){return BX.Grid.Utils.getIndex(this.list,t)},calcOffset:function(){var t=this.dragRect.height;return this.additionalDragItems.length&&this.additionalDragItems.forEach((function(e){t+=e.clientHeight})),t},getTheadCells:function(t){return[].map.call(t,(function(e,i){return{block:"",tag:"th",attrs:{style:"width: "+BX.width(t[i])+"px;"}}}))},createFake:function(){var t=[];this.cloneDragItem=BX.clone(this.dragItem),this.cloneDragAdditionalDragItems=[],this.cloneDragAdditionalDragItemRows=[];var e=this.getTheadCells(this.dragItem.cells);t.push(this.cloneDragItem),this.additionalDragItems.forEach((function(e){var i=BX.clone(e);t.push(i),this.cloneDragAdditionalDragItems.push(i),this.cloneDragAdditionalDragItemRows.push(new BX.Grid.Row(this.parent,i))}),this);var i=BX.width(this.parent.getTable());return this.fake=BX.decl({block:"main-grid-fake-container",attrs:{style:"position: absolute; top: "+this.getDragStartRect().top+"px; width: "+i+"px"},content:{block:"main-grid-table",mix:"main-grid-table-fake",tag:"table",attrs:{style:"width: "+i+"px"},content:[{block:"main-grid-header",tag:"thead",content:{block:"main-grid-row-head",tag:"tr",content:e}},{block:"",tag:"tbody",content:t}]}}),BX.insertAfter(this.fake,this.parent.getTable()),this.cloneDragItem=new BX.Grid.Row(this.parent,this.cloneDragItem),this.fake},getDragStartRect:function(){return BX.pos(this.dragItem,this.parent.getTable())},_onDragStart:function(){this.moved=!1,this.dragItem=jsDD.current_node,this.targetItem=this.dragItem,this.additionalDragItems=this.getAdditionalDragItems(this.dragItem),this.dragIndex=this.getIndex(this.dragItem),this.dragRect=this.getRowRect(this.dragItem,this.dragIndex),this.offset=this.calcOffset(),this.dragStartOffset=jsDD.start_y-this.dragRect.top,this.dragEvent=new BX.Grid.RowDragEvent,this.dragEvent.setEventName("BX.Main.grid:rowDragStart"),this.dragEvent.setDragItem(this.dragItem),this.dragEvent.setTargetItem(this.targetItem),this.dragEvent.allowInsertBefore();var t=this.parent.getRows().get(this.dragItem);this.startDragDepth=t.getDepth(),this.startDragParentId=t.getParentId(),this.createFake(),BX.addClass(this.parent.getContainer(),this.parent.settings.get("classOnDrag")),BX.addClass(this.dragItem,this.parent.settings.get("classDragActive")),BX.onCustomEvent(window,"BX.Main.grid:rowDragStart",[this.dragEvent,this.parent])},getAdditionalDragItems:function(t){var e=this.parent.getRows();return e.getRowsByParentId(e.get(t).getId(),!0).map((function(t){return t.getNode()}))},moveRow:function(t,e,i){if(t){var n=BX.type.isNumber(i)?i:300;t.style.transition=n+"ms",t.style.transform="translate3d(0px, "+e+"px, 0px)"}},getDragOffset:function(){return jsDD.y-this.dragRect.top-this.dragStartOffset},getWindowScrollTop:function(){return null===this.windowScrollTop&&(this.windowScrollTop=BX.scrollTop(window)),this.windowScrollTop},getSortOffset:function(){return jsDD.y},getRowRect:function(t,e){return this.rowsRectList||(this.rowsRectList={},this.list.forEach((function(t,e){this.rowsRectList[e]=t.getBoundingClientRect()}),this)),this.rowsRectList[e]},getRowCenter:function(t,e){var i=this.getRowRect(t,e);return i.top+this.getWindowScrollTop()+i.height/2},isDragToBottom:function(t,e){var i=this.getRowCenter(t,e),n=this.getSortOffset();return e>this.dragIndex&&i<n},isMovedToBottom:function(t){return t.style.transform==="translate3d(0px, "+-this.offset+"px, 0px)"},isDragToTop:function(t,e){var i=this.getRowCenter(t,e),n=this.getSortOffset();return e<this.dragIndex&&i>n},isMovedToTop:function(t){return t.style.transform==="translate3d(0px, "+this.offset+"px, 0px)"},isDragToBack:function(t,e){var i=this.getRowCenter(t,e),n=this.dragIndex,s=jsDD.y;return e>n&&s<i||e<n&&s>i},isMoved:function(t){return"translate3d(0px, 0px, 0px)"!==t.style.transform&&""!==t.style.transform},_onDrag:function(){this.moveRow(this.dragItem,this.getDragOffset(),0),this.moveRow(this.fake,this.getDragOffset(),0),BX.Grid.Utils.styleForEach(this.additionalDragItems,{transition:"0ms",transform:"translate3d(0px, "+this.getDragOffset()+"px, 0px)"}),this.list.forEach((function(t,e){t&&t!==this.dragItem&&-1===this.additionalDragItems.indexOf(t)&&(this.isDragToTop(t,e)&&!this.isMovedToTop(t)&&(this.targetItem=t,this.moveRow(t,this.offset),this.dragEvent.setEventName("BX.Main.grid:rowDragMove"),this.dragEvent.setTargetItem(this.targetItem),BX.onCustomEvent(window,"BX.Main.grid:rowDragMove",[this.dragEvent,this.parent]),this.checkError(this.dragEvent),this.updateProperties(this.dragItem,this.targetItem),this.isDragetToTop=!0,this.moved=!0),this.isDragToBottom(t,e)&&!this.isMovedToBottom(t)&&(this.targetItem=this.findNextVisible(this.list,e),this.moveRow(t,-this.offset),this.dragEvent.setEventName("BX.Main.grid:rowDragMove"),this.dragEvent.setTargetItem(this.targetItem),BX.onCustomEvent(window,"BX.Main.grid:rowDragMove",[this.dragEvent,this.parent]),this.checkError(this.dragEvent),this.updateProperties(this.dragItem,this.targetItem),this.isDragetToTop=!1,this.targetItem&&(this.moved=!0)),this.isDragToBack(t,e)&&this.isMoved(t)&&(this.moveRow(t,0),this.targetItem=t,this.isDragetToTop&&(this.targetItem=this.findNextVisible(this.list,e)),this.moved=!0,this.dragEvent.setEventName("BX.Main.grid:rowDragMove"),this.dragEvent.setTargetItem(this.targetItem),BX.onCustomEvent(window,"BX.Main.grid:rowDragMove",[this.dragEvent,this.parent]),this.checkError(this.dragEvent),this.updateProperties(this.dragItem,this.targetItem)))}),this)},createError:function(t,e){var i=BX.decl({block:"main-grid-error",content:e||""});return t&&t.appendChild(i),setTimeout((function(){BX.addClass(i,"main-grid-error-show")}),0),i},checkError:function(t){t.isAllowedMove()||this.error||(this.error=this.createError(this.fake,t.getErrorMessage())),t.isAllowedMove()&&this.error&&(BX.remove(this.error),this.error=null)},findNextVisible:function(t,e){var i=null,n=this.parent.getRows();return t.forEach((function(t,s){if(!i&&s>e){var o=n.get(t);o&&o.isShown()&&(i=t)}})),i},updateProperties:function(t,e){var i=this.parent.getRows(),n=i.get(t),s=0,o=0;if(e){var a=i.get(e);s=a.getDepth(),o=a.getParentId()}n.setDepth(s),n.setParentId(o),this.cloneDragItem.setDepth(s),this.cloneDragAdditionalDragItemRows.forEach((function(t,e){t.setDepth(BX.data(this.additionalDragItems[e],"depth"))}),this)},resetDragProperties:function(){var t=this.parent.getRows().get(this.dragItem);t.setDepth(this.startDragDepth),t.setParentId(this.startDragParentId)},_onDragOver:function(){},_onDragLeave:function(){},_onDragEnd:function(){if(BX.onCustomEvent(window,"BX.Main.grid:rowDragEnd",[this.dragEvent,this.parent]),BX.removeClass(this.parent.getContainer(),this.parent.settings.get("classOnDrag")),BX.removeClass(this.dragItem,this.parent.settings.get("classDragActive")),BX.Grid.Utils.styleForEach(this.list,{transition:"",transform:""}),this.dragEvent.isAllowedMove()){this.sortRows(this.dragItem,this.targetItem),this.sortAdditionalDragItems(this.dragItem,this.additionalDragItems),this.list=this.getList(),this.parent.getRows().reset();var t=this.parent.getRows().get(this.dragItem),e=this.parent.getRows().getBodyChild().map((function(t){return t.getId()}));this.parent.getParam("ALLOW_ROWS_SORT_INSTANT_SAVE",!0)&&this.saveRowsSort(e),BX.onCustomEvent(window,"Grid::rowMoved",[e,t,this.parent])}else this.resetDragProperties();BX.remove(this.fake),this.setDefaultProps()},sortAdditionalDragItems:function(t,e){e.reduce((function(t,e){return e&&BX.insertAfter(e,t),e}),t)},sortRows:function(t,e){e?e.parentNode.insertBefore(t,e):this.moved&&t.parentNode.appendChild(t)},saveRowsSort:function(t){var e={ids:t,action:this.parent.getUserOptions().getAction("GRID_SAVE_ROWS_SORT")};this.parent.getData().request(null,"POST",e)},setDefaultProps:function(){this.moved=!1,this.dragItem=null,this.targetItem=null,this.dragRect=null,this.dragIndex=null,this.offset=null,this.realX=null,this.realY=null,this.dragStartOffset=null,this.windowScrollTop=null,this.rowsRectList=null,this.error=!1}},BX.namespace("BX.Grid"),BX.Grid.Settings=function(){this.settings={},this.defaultSettings={classContainer:"main-grid",classWrapper:"main-grid-wrapper",classTable:"main-grid-table",classScrollContainer:"main-grid-container",classFadeContainer:"main-grid-fade",classFadeContainerRight:"main-grid-fade-right",classFadeContainerLeft:"main-grid-fade-left",classNavPanel:"main-grid-nav-panel",classActionPanel:"main-grid-action-panel",classCursor:"main-grid-cursor",classRowCustom:"main-grid-row-custom",classMoreButton:"main-grid-more-btn",classRow:"main-grid-row",classHeadRow:"main-grid-row-head",classBodyRow:"main-grid-row-body",classFootRow:"main-grid-row-foot",classDataRows:"main-grid-row-data",classPanels:"main-grid-bottom-panels",classCellHeadContainer:"main-grid-cell-head-container",classCellHeadOndrag:"main-grid-cell-head-ondrag",classEmptyRows:"main-grid-row-empty",classEmptyBlock:"main-grid-empty-block",classCheckAllCheckboxes:"main-grid-check-all",classCheckedRow:"main-grid-row-checked",classRowCheckbox:"main-grid-row-checkbox",classPagination:"main-grid-panel-cell-pagination",classActionCol:"main-grid-cell-action",classCounterDisplayed:"main-grid-counter-displayed",classCounterSelected:"main-grid-counter-selected",classCounterTotal:"main-grid-panel-total",classTableFade:"main-grid-table-fade",classDragActive:"main-grid-on-row-drag",classResizeButton:"main-grid-resize-button",classOnDrag:"main-grid-ondrag",classDisableDrag:"main-grid-row-drag-disabled",classPanelCellContent:"main-grid-panel-content",classCollapseButton:"main-grid-plus-button",classRowStateLoad:"main-grid-load-row",classRowStateExpand:"main-grid-row-expand",classHeaderSortable:"main-grid-col-sortable",classHeaderNoSortable:"main-grid-col-no-sortable",classCellStatic:"main-grid-cell-static",classHeadCell:"main-grid-cell-head",classPageSize:"main-grid-panel-select-pagesize",classGroupEditButton:"main-grid-control-panel-action-edit",classGroupDeleteButton:"main-grid-control-panel-action-remove",classGroupActionsDisabled:"main-grid-control-panel-action-icon-disable",classPanelButton:"main-grid-buttons",classPanelApplyButton:"main-grid-control-panel-apply-button",classPanelCheckbox:"main-grid-panel-checkbox",classEditor:"main-grid-editor",classEditorContainer:"main-grid-editor-container",classEditorText:"main-grid-editor-text",classEditorDate:"main-grid-editor-date",classEditorNumber:"main-grid-editor-number",classEditorRange:"main-grid-editor-range",classEditorCheckbox:"main-grid-editor-checkbox",classEditorTextarea:"main-grid-editor-textarea",classEditorCustom:"main-grid-editor-custom",classEditorMoney:"main-grid-editor-money",classCellContainer:"main-grid-cell-content",classEditorOutput:"main-grid-editor-output",classSettingsWindow:"main-grid-settings-window",classSettingsWindowColumn:"main-grid-settings-window-list-item",classSettingsWindowColumnLabel:"main-grid-settings-window-list-item-label",classSettingsWindowColumnEditState:"main-grid-settings-window-list-item-edit",classSettingsWindowColumnEditInput:"main-grid-settings-window-list-item-edit-input",classSettingsWindowColumnEditButton:"main-grid-settings-window-list-item-edit-button",classSettingsWindowColumnCheckbox:"main-grid-settings-window-list-item-checkbox",classSettingsWindowShow:"main-grid-settings-window-show",classSettingsWindowSelectAll:"main-grid-settings-window-select-all",classSettingsWindowUnselectAll:"main-grid-settings-window-unselect-all",classSettingsWindowSearchSectionsWrapper:"main-grid-settings-window-search-section-wrapper",classSettingsWindowSearchActiveSectionIcon:"main-grid-settings-window-search-section-item-icon-active",classSettingsWindowSearchSectionInput:"main-grid-settings-window-search-section-input",classSettingsWindowSearchSectionItemHidden:"main-grid-settings-window-list-item-hidden",classSettingsWindowSearchSectionItemVisible:"main-grid-settings-window-list-item-visible",classSettingsButton:"main-grid-interface-settings-icon",classSettingsButtonActive:"main-grid-interface-settings-icon-active",classSettingsWindowClose:"main-grid-settings-window-actions-item-close",classSettingsWindowReset:"main-grid-settings-window-actions-item-reset",classSettingsWindowColumnChecked:"main-grid-settings-window-list-item-checked",classShowAnimation:"main-grid-show-popup-animation",classCloseAnimation:"main-grid-close-popup-animation",classLoader:"main-grid-loader-container",classLoaderShow:"main-grid-show-loader",classLoaderHide:"main-grid-hide-loader",classRowError:"main-grid-error",loaderHideAnimationName:"hideLoader",classHide:"main-grid-hide",classEar:"main-grid-ear",classEarLeft:"main-grid-ear-left",classEarRight:"main-grid-ear-right",classNotCount:"main-grid-not-count",classCounter:"main-grid-panel-counter",classForAllCounterEnabled:"main-grid-panel-counter-for-all-enable",classLoad:"load",classRowActionButton:"main-grid-row-action-button",classDropdown:"main-dropdown",classPanelControl:"main-grid-panel-control",classPanelControlContainer:"main-grid-panel-control-container",classForAllCheckbox:"main-grid-for-all-checkbox",classDisable:"main-grid-disable",dataActionsKey:"actions",updateActionMore:"more",classShow:"show",classGridShow:"main-grid-show",updateActionPagination:"pagination",updateActionSort:"sort",ajaxIdDataProp:"ajaxid",pageSizeId:"grid_page_size",sortableRows:!0,sortableColumns:!0,animationDuration:300},this.prepare()},BX.Grid.Settings.prototype={prepare:function(){this.settings=this.defaultSettings},getDefault:function(){return this.defaultSettings},get:function(t){var e;try{e=this.getDefault()[t]}catch(t){e=null}return e},getList:function(){return this.getDefault()}},BX.namespace("BX.Grid"),BX.Grid.SettingsWindow=function(t){this.parent=null,this.popupItems=null,this.items=null,this.popup=null,this.sourceContent=null,this.applyButton=null,this.resetButton=null,this.cancelButton=null,this.filterSections=null,this.filterSectionsSearchInput=null,this.init(t),BX.onCustomEvent(window,"BX.Grid.SettingsWindow:init",[this])},BX.Grid.SettingsWindow.prototype={init:function(t){this.parent=t,BX.bind(this.parent.getContainer(),"click",BX.proxy(this._onContainerClick,this)),BX.addCustomEvent(window,"Grid::columnMoved",BX.proxy(this._onColumnMoved,this))},destroy:function(){BX.unbind(this.parent.getContainer(),"click",BX.proxy(this._onContainerClick,this)),BX.removeCustomEvent(window,"Grid::columnMoved",BX.proxy(this._onColumnMoved,this)),this.getPopup().close()},getSelectAllButton:function(){return this.selectAllButton||(this.selectAllButton=BX.Grid.Utils.getByClass(this.getPopup().contentContainer,this.parent.settings.get("classSettingsWindowSelectAll"),!0)),this.selectAllButton},getUnselectAllButton:function(){return this.unselectAllButton||(this.unselectAllButton=BX.Grid.Utils.getByClass(this.getPopup().contentContainer,this.parent.settings.get("classSettingsWindowUnselectAll"),!0)),this.unselectAllButton},reset:function(){this.popupItems=null,this.allColumns=null,this.items=null},_onContainerClick:function(t){BX.hasClass(t.target,this.parent.settings.get("classSettingsButton"))&&this._onSettingsButtonClick(t)},_onSettingsButtonClick:function(){BX.onCustomEvent(window,"BX.Grid.SettingsWindow:show",[this]),this.getPopup().show()},fetchColumns:function(){var t=new BX.Promise;return BX.ajax({url:this.parent.getParam("LAZY_LOAD").GET_LIST,method:"GET",dataType:"json",onsuccess:t.fulfill.bind(t)}),t},prepareColumnOptions:function(t){var e=this.parent.getUserOptions().getCurrentOptions().custom_names;return BX.type.isPlainObject(t)&&(BX.type.isPlainObject(e)&&t.id in e&&(t.name=e[t.id]),this.parent.getColumnHeaderCellByName(t.id)&&(t.selected=!0)),t},createColumnElement:function(t){var e='<div data-name="'+t.id+'" class="main-grid-settings-window-list-item"><input id="'+t.id+'-checkbox" type="checkbox" class="main-grid-settings-window-list-item-checkbox"'+(t.selected?" checked":"")+'><label for="'+t.id+'-checkbox" class="main-grid-settings-window-list-item-label">'+t.name+'</label><span class="main-grid-settings-window-list-item-edit-button"></span></div>';return BX.create("div",{html:e}).firstElementChild},useLazyLoadColumns:function(){return!!this.parent.getParam("LAZY_LOAD")},getSourceContent:function(){if(!this.sourceContent&&(this.sourceContent=BX.Grid.Utils.getByClass(this.parent.getContainer(),this.parent.settings.get("classSettingsWindow"),!0),this.useLazyLoadColumns())){this.contentList=this.sourceContent.querySelector(".main-grid-settings-window-list"),this.contentList.innerHTML="";var t=new BX.Loader({target:this.contentList});t.show(),this.fetchColumns().then(function(e){e.forEach((function(t){t=this.prepareColumnOptions(t),this.contentList.appendChild(this.createColumnElement(t))}),this),t.hide().then((function(){t.destroy()})),this.reset(),this.getItems().forEach((function(t){BX.bind(t.getNode(),"click",BX.delegate(this.onItemClick,this))}),this),this.fixedFooter=BX.create("div",{props:{className:"main-grid-popup-window-buttons-wrapper"},children:[this.sourceContent.querySelector(".popup-window-buttons")]}),requestAnimationFrame(function(){this.popup.popupContainer.appendChild(this.fixedFooter),this.fixedFooter.style.width=this.popup.popupContainer.clientWidth+"px"}.bind(this))}.bind(this))}return this.sourceContent},getPopupItems:function(){var t;return this.popupItems||(t=this.getPopup().contentContainer,this.popupItems=BX.Grid.Utils.getByClass(t,this.parent.settings.get("classSettingsWindowColumn"))),this.popupItems},getSelectedColumns:function(){var t=[];return this.getItems().forEach((function(e){e.isSelected()&&t.push(e.getId())})),t},restoreColumns:function(){this.getItems().forEach((function(t){t.restore()})),this.sortItems(),this.reset()},restoreLastColumns:function(){this.getItems().forEach((function(t){t.restoreState()}))},updateColumnsState:function(){this.getItems().forEach((function(t){t.updateState()}))},getStickedColumns:function(){return this.getItems().reduce((function(t,e){return e.isSticked()&&t.push(e.getId()),t}),[])},saveColumns:function(t,e){var i=this.parent.getUserOptions(),n=this.getColumnNames(),s=this.getStickedColumns(),o=[];o.push({action:i.getAction("GRID_SET_COLUMNS"),columns:t.join(",")}),o.push({action:i.getAction("SET_CUSTOM_NAMES"),custom_names:n}),o.push({action:i.getAction("GRID_SET_STICKED_COLUMNS"),stickedColumns:s}),this.isForAll()&&o.push({action:i.getAction("GRID_SAVE_SETTINGS"),view_id:"default",set_default_settings:"Y",delete_user_settings:"Y"}),i.batch(o,BX.delegate((function(){this.parent.reloadTable(null,null,e)}),this)),this.updateColumnsState()},disableAllColumnslabelEdit:function(){this.getItems().forEach((function(t){t.disableEdit()}))},getAllColumns:function(){return this.allColumns||(this.allColumns=this.getItems().map((function(t){return t.getId()}))),this.allColumns},isShowedColumn:function(t){return this.getSelectedColumns().some((function(e){return e===t}))},getShowedColumns:function(){var t=[],e=this.parent.getRows().getHeadFirstChild().getCells();return[].slice.call(e).forEach((function(e){"name"in e.dataset&&t.push(e.dataset.name)})),t},sortItems:function(){var t=this.getShowedColumns(),e={};this.getAllColumns().forEach((function(t){e[t]=t}),this);var i=0;Object.keys(e).forEach((function(n){this.isShowedColumn(n)&&(e[n]=t[i],i++);var s=this.getColumnByName(e[n]);s&&s.parentNode.appendChild(s)}),this)},getColumnNames:function(){var t={};return this.getItems().map((function(e){e.isEdited()&&(t[e.getId()]=e.getTitle())})),t},getColumnByName:function(t){return BX.Grid.Utils.getBySelector(this.getPopup().popupContainer,"."+this.parent.settings.get("classSettingsWindowColumn")+'[data-name="'+t+'"]',!0)},_onColumnMoved:function(){this.sortItems(),this.reset()},onResetButtonClick:function(){this.parent.confirmDialog({CONFIRM:!0,CONFIRM_MESSAGE:this.parent.arParams.CONFIRM_RESET_MESSAGE},BX.delegate((function(){this.enableWait(this.getApplyButton()),this.parent.getUserOptions().reset(this.isForAll(),BX.delegate((function(){this.parent.reloadTable(null,null,BX.delegate((function(){this.restoreColumns(),this.disableWait(this.getApplyButton()),this.getPopup().close()}),this))}),this))}),this))},getResetButtonId:function(){return this.parent.getContainerId()+"-grid-settings-reset-button"},onApplyButtonClick:function(){this.parent.confirmDialog({CONFIRM:this.isForAll(),CONFIRM_MESSAGE:this.parent.getParam("SETTINGS_FOR_ALL_CONFIRM_MESSAGE")},BX.delegate((function(){this.enableWait(this.getApplyButton()),this.saveColumns(this.getSelectedColumns(),BX.delegate((function(){this.getPopup().close(),this.disableWait(this.getApplyButton()),this.unselectForAllCheckbox()}),this)),BX.onCustomEvent(window,"BX.Grid.SettingsWindow:save",[this])}),this),BX.delegate((function(){this.unselectForAllCheckbox()}),this))},getApplyButtonId:function(){return this.parent.getContainerId()+"-grid-settings-apply-button"},getApplyButton:function(){return null===this.applyButton&&(this.applyButton=BX(this.getApplyButtonId())),this.applyButton},getCancelButtonId:function(){return this.parent.getContainerId()+"-grid-settings-cancel-button"},getCancelButton:function(){return null===this.cancelButton&&(this.cancelButton=BX(this.getCancelButtonId())),this.cancelButton},unselectForAllCheckbox:function(){var t=this.getForAllCheckbox();t&&(t.checked=null)},enableWait:function(t){BX.addClass(t,"ui-btn-wait"),BX.removeClass(t,"popup-window-button")},disableWait:function(t){BX.removeClass(t,"ui-btn-wait"),BX.addClass(t,"popup-window-button")},createTitle:function(){var t=BX.create("div"),e=this.parent.getParam("SETTINGS_WINDOW_TITLE");if(""!==e)return e="&laquo;"+e+"&raquo;",t.innerHTML="<span>"+this.parent.getParam("SETTINGS_TITLE")+" "+e+"</span>",t.firstChild.innerText;if(1===BX.Main.gridManager.data.length){var i=BX("pagetitle"),n=BX.Type.isDomNode(i)&&BX.Type.isStringFilled(i.innerText)?"&laquo;"+BX.Text.encode(i.innerText)+"&raquo;":"";return t.innerHTML="<span>"+this.parent.getParam("SETTINGS_TITLE")+" "+n+"</span>",t.firstChild.innerText}return this.parent.getParam("SETTINGS_TITLE")},getPopupId:function(){return this.parent.getContainerId()+"-grid-settings-window"},createPopup:function(){return this.popup||(this.popup=new BX.PopupWindow(this.getPopupId(),null,{titleBar:this.createTitle(),autoHide:!1,overlay:.6,width:1e3,closeIcon:!0,closeByEsc:!0,contentNoPaddings:!0,content:this.getSourceContent(),events:{onPopupClose:BX.delegate(this.onPopupClose,this)}}),this.getItems().forEach((function(t){BX.bind(t.getNode(),"click",BX.delegate(this.onItemClick,this)),BX.bind(t.getNode(),"animationend",this.onAnimationEnd.bind(this,t.getNode()))}),this),BX.bind(this.getResetButton(),"click",BX.proxy(this.onResetButtonClick,this)),BX.bind(this.getApplyButton(),"click",BX.proxy(this.onApplyButtonClick,this)),BX.bind(this.getCancelButton(),"click",BX.proxy(this.popup.close,this.popup)),BX.bind(this.getSelectAllButton(),"click",BX.delegate(this.onSelectAll,this)),BX.bind(this.getUnselectAllButton(),"click",BX.delegate(this.onUnselectAll,this)),this.parent.arParams.COLUMNS_ALL_WITH_SECTIONS&&Object.keys(this.parent.arParams.COLUMNS_ALL_WITH_SECTIONS).length&&this.prepareFilterSections(),this.parent.arParams.ENABLE_FIELDS_SEARCH&&this.prepareFilterSectionsSearchInput()),this.popup},onItemClick:function(){this.adjustActionButtonsState()},onAnimationEnd:function(t){t.style.display=BX.Dom.hasClass(t,this.parent.settings.get("classSettingsWindowSearchSectionItemHidden"))?"none":"inline-block"},prepareFilterSections:function(){var t,e=_createForOfIteratorHelper(this.getFilterSections());try{for(e.s();!(t=e.n()).done;){var i=t.value;BX.bind(i,"click",this.onFilterSectionClick.bind(this,i))}}catch(t){e.e(t)}finally{e.f()}},getFilterSections:function(){if(!this.filterSections){var t,e=BX.Grid.Utils.getByClass(this.getPopup().contentContainer,this.parent.settings.get("classSettingsWindowSearchSectionsWrapper"),!0);this.filterSections=null!==(t=e.children)&&void 0!==t?t:new HTMLCollection}return this.filterSections},onFilterSectionClick:function(t){var e=this.parent.settings.get("classSettingsWindowSearchActiveSectionIcon"),i=t.dataset.uiGridFilterSectionButton,n=document.querySelectorAll("[data-ui-grid-filter-section='"+i+"']");BX.Dom.hasClass(t.firstChild,e)?(BX.Dom.removeClass(t.firstChild,e),BX.Dom.hide(n[0])):(BX.Dom.addClass(t.firstChild,e),BX.Dom.show(n[0]))},prepareFilterSectionsSearchInput:function(){var t=this.getFilterSectionsSearchInput();BX.bind(t,"input",this.onFilterSectionSearchInput.bind(this)),BX.bind(t.previousElementSibling,"click",this.onFilterSectionSearchInputClear.bind(this))},getFilterSectionsSearchInput:function(){return this.filterSectionsSearchInput||(this.filterSectionsSearchInput=BX.Grid.Utils.getByClass(this.getPopup().contentContainer,this.parent.settings.get("classSettingsWindowSearchSectionInput"),!0)),this.filterSectionsSearchInput},onFilterSectionSearchInput:function(){var t=this.filterSectionsSearchInput.value;t.length&&(t=t.toLowerCase()),this.items.forEach(function(e){var i=e.lastTitle.toLowerCase();t.length&&-1===i.indexOf(t)?(BX.Dom.removeClass(e.getNode(),this.parent.settings.get("classSettingsWindowSearchSectionItemVisible")),BX.Dom.addClass(e.getNode(),this.parent.settings.get("classSettingsWindowSearchSectionItemHidden"))):(BX.Dom.removeClass(e.getNode(),this.parent.settings.get("classSettingsWindowSearchSectionItemHidden")),BX.Dom.addClass(e.getNode(),this.parent.settings.get("classSettingsWindowSearchSectionItemVisible")),e.getNode().style.display="inline-block")}.bind(this))},onFilterSectionSearchInputClear:function(){this.filterSectionsSearchInput.value="",this.onFilterSectionSearchInput()},getItems:function(){return null===this.items&&(this.items=this.getPopupItems().map((function(t){return new BX.Grid.SettingsWindowColumn(this.parent,t)}),this)),this.items},onPopupClose:function(){BX.onCustomEvent(window,"BX.Grid.SettingsWindow:close",[this]),this.restoreLastColumns(),this.disableAllColumnslabelEdit(),this.adjustActionButtonsState()},getPopup:function(){return this.popup?this.popup:this.popup=this.createPopup()},onSelectAll:function(){this.selectAll(),this.enableActions()},onUnselectAll:function(){this.unselectAll(),this.disableActions()},selectAll:function(){this.getItems().forEach((function(t){t.select()}))},unselectAll:function(){this.getItems().forEach((function(t){t.unselect()}))},isForAll:function(){var t=this.getForAllCheckbox();return t&&!!t.checked},getForAllCheckbox:function(){return BX.Grid.Utils.getByClass(this.getPopup().popupContainer,"main-grid-settings-window-for-all-checkbox",!0)},getResetButton:function(){return null===this.resetButton&&(this.resetButton=BX(this.getResetButtonId())),this.resetButton},disableActions:function(){var t=this.getApplyButton();t&&BX.addClass(t,this.parent.settings.get("classDisable"))},enableActions:function(){var t=this.getApplyButton();t&&BX.removeClass(t,this.parent.settings.get("classDisable"))},adjustActionButtonsState:function(){this.getSelectedColumns().length?this.enableActions():this.disableActions()}},BX.namespace("BX.Grid"),BX.Grid.SettingsWindowColumn=function(t,e){this.node=null,this.label=null,this.checkbox=null,this.editButton=null,this.settings=null,this.parent=null,this.default=null,this.defaultTitle=null,this.state=null,this.lastTitle=null,this.init(t,e)},BX.Grid.SettingsWindowColumn.inited={},BX.Grid.SettingsWindowColumn.prototype={init:function(t,e){this.parent=t,this.node=e;try{this.lastTitle=e.querySelector("label").innerText.trim()}catch(t){}this.updateState(),BX.Grid.SettingsWindowColumn.inited[this.getId()]||(BX.Grid.SettingsWindowColumn.inited[this.getId()]=!0,BX.bind(this.getEditButton(),"click",BX.proxy(this.onEditButtonClick,this)),BX.bind(this.getStickyButton(),"click",BX.proxy(this.onStickyButtonClick,this)))},getStickyButton:function(){return this.node.querySelector(".main-grid-settings-window-list-item-sticky-button")},isSticked:function(){return this.node.classList.contains("main-grid-settings-window-list-item-sticked")},onStickyButtonClick:function(){this.isSticked()?this.unstick():this.stick()},stick:function(){this.node.classList.add("main-grid-settings-window-list-item-sticked")},unstick:function(){this.node.classList.remove("main-grid-settings-window-list-item-sticked")},onEditButtonClick:function(t){t.stopPropagation(),this.isEditEnabled()?this.disableEdit():this.enableEdit()},setState:function(t){this.state=t},getState:function(){return this.state},updateState:function(){this.setState({selected:this.isSelected(),sticked:this.isSticked(),title:this.getTitle()})},restoreState:function(){var t=this.getState();t.selected?this.select():this.unselect(),t.sticked?this.stick():this.unstick(),this.setTitle(t.title)},getId:function(){return this.getNode().dataset.name},getTitle:function(){return this.getLabel().innerText},setTitle:function(t){this.getLabel().innerText=t&&"undefined"!==t?t:this.getDefaultTitle()},isEdited:function(){return this.getTitle()!==this.getDefaultTitle()},getSettings:function(){if(null===this.settings){var t=this.parent.getParam("DEFAULT_COLUMNS");this.settings=this.getId()in t?t[this.getId()]:{}}return this.settings},isDefault:function(){if(null===this.default){var t=this.getSettings();this.default="default"in t&&t.default}return this.default},restore:function(){this.isDefault()?this.select():this.unselect(),this.setTitle(this.getDefaultTitle()),"true"===this.node.dataset.stickedDefault?this.stick():this.unstick(),this.disableEdit(),this.updateState()},getDefaultTitle:function(){if(null===this.defaultTitle){var t=this.getSettings();this.defaultTitle="name"in t?t.name:this.lastTitle}return this.defaultTitle},getNode:function(){return this.node},getLabel:function(){return null===this.label&&(this.label=BX.Grid.Utils.getByTag(this.getNode(),"label",!0),BX.Event.bind(this.label,"paste",this.onLabelPaste.bind(this)),BX.Event.bind(this.label,"keydown",this.onLabelKeydown.bind(this))),this.label},onLabelPaste:function(t){if(t.preventDefault(),t.clipboardData&&t.clipboardData.getData){var e=t.clipboardData.getData("text/plain"),i=BX.Text.encode(e).trim().replace(new RegExp("\t","g")," ").replace(new RegExp("\n","g")," ").replace(/ +(?= )/g,"");document.execCommand("insertHTML",!1,i)}},onLabelKeydown:function(t){13===t.keyCode&&t.preventDefault()},getCheckbox:function(){return null===this.checkbox&&(this.checkbox=BX.Grid.Utils.getBySelector(this.getNode(),'input[type="checkbox"]',!0)),this.checkbox},getEditButton:function(){return null===this.editButton&&(this.editButton=BX.Grid.Utils.getByClass(this.getNode(),this.parent.settings.get("classSettingsWindowColumnEditButton"),!0)),this.editButton},enableEdit:function(){this.getLabel().contentEditable=!0,this.getCheckbox().disabled=!0,this.adjustCaret()},disableEdit:function(){this.getLabel().contentEditable=!1,this.getCheckbox().disabled=!1},isEditEnabled:function(){return this.getLabel().isContentEditable},isSelected:function(){return this.getCheckbox().checked},select:function(){this.getCheckbox().checked=!0},unselect:function(){this.getCheckbox().checked=!1},adjustCaret:function(){var t=document.createRange(),e=window.getSelection(),i=this.getLabel().innerText.length,n=this.getLabel().childNodes,s=n[n.length-1];t.setStart(s,i),t.setEnd(s,i),t.collapse(!0),e.removeAllRanges(),e.addRange(t),BX.fireEvent(this.getNode(),"focus")}},function(){BX.namespace("BX.Grid"),BX.Grid.UserOptions=function(t,e,i,n){this.options=null,this.actions=null,this.parent=null,this.url=null,this.init(t,e,i,n)},BX.Grid.UserOptions.prototype={init:function init(parent,userOptions,userOptionsActions,url){this.url=url,this.parent=parent;try{this.options=eval(userOptions)}catch(t){}try{this.actions=eval(userOptionsActions)}catch(t){}},getCurrentViewName:function(){var t=this.getOptions();return"current_view"in t?t.current_view:null},getViewsList:function(){var t=this.getOptions();return"views"in t?t.views:{}},getCurrentOptions:function(){var t=this.getCurrentViewName(),e=this.getViewsList(),i=null;return t in e&&(i=e[t]),BX.type.isPlainObject(i)||(i={}),i},getUrl:function(t){return BX.util.add_url_param(this.url,{GRID_ID:this.parent.getContainerId(),bxajaxid:this.parent.getAjaxId(),action:t})},getOptions:function(){return this.options||{}},getActions:function(){return this.actions},getAction:function(t){var e=null;try{e=this.getActions()[t]}catch(t){e=null}return e},update:function(t){this.options=t},setColumns:function(t,e){var i=this.getCurrentOptions();return BX.type.isPlainObject(i)&&(i.columns=t.join(","),this.save(this.getAction("GRID_SET_COLUMNS"),{columns:i.columns},e)),this},setColumnsNames:function(t,e){var i={view_id:"default"};return BX.type.isPlainObject(i)&&(i.custom_names=t,this.save(this.getAction("SET_CUSTOM_NAMES"),i,e)),this},setColumnSizes:function(t,e){this.save(this.getAction("GRID_SET_COLUMN_SIZES"),{sizes:t,expand:e})},reset:function(t,e){var i={};t&&(i={view_id:"default",set_default_settings:"Y",delete_user_settings:"Y",view_settings:this.getCurrentOptions()}),this.save(this.getAction("GRID_RESET"),i,e)},setSort:function(t,e,i){return t&&e&&this.save(this.getAction("GRID_SET_SORT"),{by:t,order:e},i),this},setPageSize:function(t,e){BX.type.isNumber(parseInt(t))&&this.save(this.getAction("GRID_SET_PAGE_SIZE"),{pageSize:t},e)},setExpandedRows:function(t,e){BX.type.isArray(t)&&this.save(this.getAction("GRID_SET_EXPANDED_ROWS"),{ids:t},e)},setCollapsedGroups:function(t,e){BX.type.isArray(t)&&this.save(this.getAction("GRID_SET_COLLAPSED_GROUPS"),{ids:t},e)},resetExpandedRows:function(){this.save(this.getAction("GRID_RESET_EXPANDED_ROWS"),{})},saveForAll:function(t){this.save(this.getAction("GRID_SAVE_SETTINGS"),{view_id:"default",set_default_settings:"Y",delete_user_settings:"Y",view_settings:this.getCurrentOptions()},t)},batch:function(t,e){this.save(this.getAction("GRID_SAVE_BATH"),{bath:t},e)},save:function(t,e,i){var n=this;BX.ajax.post(this.getUrl(t),e,(function(t){try{(t=JSON.parse(t)).error||(n.update(t),BX.type.isFunction(i)&&i(t),BX.onCustomEvent(n.parent.getContainer(),"Grid::optionsChanged",[n.parent]))}catch(t){}}))}}}(),BX.namespace("BX.Grid"),BX.Grid.Utils={ajaxUrl:function(t,e){return this.addUrlParams(t,{bxajaxid:e})},addUrlParams:function(t,e){return BX.util.add_url_param(t,e)},arrayMove:function(t,e,i){if(i>=t.length)for(var n=i-t.length;1+n--;)t.push(void 0);return t.splice(i,0,t.splice(e,1)[0]),t},getIndex:function(t,e){return[].indexOf.call(t||[],e)},getNext:function(t){if(t)return t.nextElementSibling||null},getPrev:function(t){if(t)return t.previousElementSibling||null},closestParent:function(t,e){if(t)return e?BX.findParent(t,{className:e}):t.parentNode||null},closestChilds:function(t){if(t)return t.children||null},collectionSort:function(t,e){var i,n,s,o,a;t&&e&&t!==e&&t.parentNode===e.parentNode&&(i=this.closestParent(e),s=(n=this.closestChilds(i)).length,o=this.getIndex(n,t),s===(a=this.getIndex(n,e))&&i.appendChild(e),o>a&&i.insertBefore(t,e),o<a&&s!==a&&i.insertBefore(t,this.getNext(e)))},getColumn:function(t,e){var i=this.getIndex(this.closestChilds(this.closestParent(e)),e),n=[];return[].forEach.call(t.rows,(function(t){n.push(t.cells[i])})),n},styleForEach:function(t,e){e=BX.type.isPlainObject(e)?e:null;var i=Object.keys(e);[].forEach.call(t||[],(function(t){i.forEach((function(i){BX.style(t,i,e[i])}))}))},requestAnimationFrame:function(){var t=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)};t.apply(window,arguments)},getByClass:function(t,e,i){var n=[];return e&&(n=t?t.getElementsByClassName(e):[],n=i?n.length?n[0]:null:[].slice.call(n)),n},getByTag:function(t,e,i){var n=[];return e&&(n=t?t.getElementsByTagName(e):[],n=i?n.length?n[0]:null:[].slice.call(n)),n},getBySelector:function(t,e,i){var n=[];return e&&(i?n=t?t.querySelector(e):null:(n=t?t.querySelectorAll(e):[],n=[].slice.call(n))),n},listenerParams:function(t){try{window.addEventListener("test",null,t)}catch(e){t=!1}return t}};var Realtime=function(t){function e(t){var i;return babelHelpers.classCallCheck(this,e),(i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).call(this))).setEventNamespace("BX.Grid.Realtime"),i.options=_objectSpread({},t),i}return babelHelpers.inherits(e,t),babelHelpers.createClass(e,[{key:"addRow",value:function(t){var e=this.options.grid,i=e.getTemplateRow();if(i.makeCountable(),e.hideEmptyStub(),!main_core.Type.isNumber(t.id)&&!main_core.Type.isStringFilled(t.id))throw new ReferenceError("id is not number or string");if(i.setId(t.id),main_core.Type.isArrayFilled(t.actions)&&i.setActions(t.actions),main_core.Type.isPlainObject(t.columns)&&i.setCellsContent(t.columns),main_core.Type.isPlainObject(t.cellActions)&&i.setCellActions(t.cellActions),main_core.Type.isPlainObject(t.counters)){var n=Object.entries(t.counters).reduce((function(t,e){var i=babelHelpers.slicedToArray(e,2),n=i[0],s=i[1];return main_core.Type.isPlainObject(s)&&(t[n]=_objectSpread(_objectSpread({},s),{},{animation:main_core.Text.toBoolean(s.animation)})),t}),{});i.setCounters(n)}if(!0===t.prepend)i.prependTo(e.getBody());else if(!0===t.append)i.appendTo(e.getBody());else if(main_core.Type.isNumber(t.insertBefore)||main_core.Type.isStringFilled(t.insertBefore)){var s=e.getRows().getById(t.insertBefore);s&&BX.Dom.insertBefore(i.getNode(),s.getNode())}else{if(!main_core.Type.isNumber(t.insertAfter)&&!main_core.Type.isStringFilled(t.insertAfter))throw new ReferenceError("prepend, append, insertBefore or insertAfter not filled");var o=e.getRows().getById(t.insertAfter);o&&BX.Dom.insertAfter(i.getNode(),o.getNode())}if(i.show(),!1!==t.animation){i.enableAbsolutePosition();var a=e.getRows().getSourceBodyChild().filter((function(t){return t.rowIndex>i.getIndex()})),r=document.createElement("tr");main_core.Dom.style(r,{height:"0px",transition:"200ms height linear"}),main_core.Dom.append(r,e.getBody());var l=i.getHeight();main_core.Dom.style(r,"height","".concat(l,"px")),a.forEach((function(t){main_core.Dom.style(t,{transition:"200ms transform linear",transform:"translateY(".concat(l,"px) translateZ(0)")})})),main_core.Dom.addClass(i.getNode(),"main-ui-grid-show-new-row"),main_core.Event.bind(i.getNode(),"animationend",(function(t){"showNewRow"===t.animationName&&(a.forEach((function(t){main_core.Dom.style(t,{transition:null,transform:null})})),main_core.Dom.remove(r),i.disableAbsolutePosition(),main_core.Dom.removeClass(i.getNode(),"main-ui-grid-show-new-row"))}))}e.getRows().reset(),e.bindOnRowEvents(),e.updateCounterDisplayed(),e.updateCounterSelected(),e.getParam("ALLOW_ROWS_SORT")&&e.rowsSortable.reinit(),e.getParam("ALLOW_COLUMNS_SORT")&&e.colsSortable.reinit()}},{key:"showStub",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=document.createElement("tr");main_core.Dom.addClass(i,"main-grid-row main-grid-row-empty main-grid-row-body");var n=document.createElement("td");main_core.Dom.addClass(n,"main-grid-cell main-grid-cell-center");var s=this.options.grid.getRows().getHeadFirstChild().getCells().length;main_core.Dom.attr(n,"colspan",s);var o=function(){if(main_core.Type.isPlainObject(e.content)){var i=[];return main_core.Type.isStringFilled(e.content.title)&&i.push(main_core.Tag.render(_templateObject$2||(_templateObject$2=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t\t\t<div class="main-grid-empty-block-title">\n\t\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t"])),e.content.title)),main_core.Type.isStringFilled(e.content.description)&&i.push(main_core.Tag.render(_templateObject2$2||(_templateObject2$2=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t\t\t<div class="main-grid-empty-block-description">\n\t\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t"])),e.content.description)),i}return main_core.Type.isStringFilled(e.content)||main_core.Type.isDomNode(e.content)?e.content:[main_core.Tag.render(_templateObject3$1||(_templateObject3$1=babelHelpers.taggedTemplateLiteral(['<div class="main-grid-empty-image"></div>']))),main_core.Tag.render(_templateObject4$1||(_templateObject4$1=babelHelpers.taggedTemplateLiteral(['<div class="main-grid-empty-text">',"</div>"])),t.options.grid.getParam("EMPTY_STUB_TEXT"))]}(),a=main_core.Tag.render(_templateObject5$1||(_templateObject5$1=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="main-grid-empty-block">\n\t\t\t\t<div class="main-grid-empty-inner">\n\t\t\t\t\t',"\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"])),o);main_core.Dom.append(a,n),main_core.Dom.append(n,i);var r=this.options.grid.getBody().querySelector(".main-grid-row-empty");r&&main_core.Dom.remove(r),main_core.Dom.append(i,this.options.grid.getBody()),this.options.grid.getRows().getBodyChild().forEach((function(t){t.hide()})),this.options.grid.adjustEmptyTable(this.options.grid.getRows().getSourceBodyChild())}}]),e}(main_core_events.EventEmitter),namespace=main_core.Reflection.namespace("BX.Grid");namespace.Realtime=Realtime;var CellActions=function t(){babelHelpers.classCallCheck(this,t)};babelHelpers.defineProperty(CellActions,"PIN","main-grid-cell-content-action-pin"),babelHelpers.defineProperty(CellActions,"MUTE","main-grid-cell-content-action-mute");var namespace$1=main_core.Reflection.namespace("BX.Grid");namespace$1.CellActions=CellActions;var CellActionState=function t(){babelHelpers.classCallCheck(this,t)};babelHelpers.defineProperty(CellActionState,"SHOW_BY_HOVER","main-grid-cell-content-action-by-hover"),babelHelpers.defineProperty(CellActionState,"ACTIVE","main-grid-cell-content-action-active");var namespace$2=main_core.Reflection.namespace("BX.Grid");namespace$2.CellActionState=CellActionState;var Counters=function t(){babelHelpers.classCallCheck(this,t)};babelHelpers.defineProperty(Counters,"Type",{LEFT:"left",LEFT_ALIGNED:"left-aligned",RIGHT:"right"}),babelHelpers.defineProperty(Counters,"Color",{DANGER:"ui-counter-danger",SUCCESS:"ui-counter-success",PRIMARY:"ui-counter-primary",GRAY:"ui-counter-gray",LIGHT:"ui-counter-light",DARK:"ui-counter-dark"}),babelHelpers.defineProperty(Counters,"Size",{LARGE:"ui-counter-lg",MEDIUM:"ui-counter-md"});var namespace$3=main_core.Reflection.namespace("BX.Grid");namespace$3.Counters=Counters;var Label=function t(){babelHelpers.classCallCheck(this,t)};babelHelpers.defineProperty(Label,"Color",{DEFAULT:"ui-label-default",DANGER:"ui-label-danger",SUCCESS:"ui-label-success",WARNING:"ui-label-warning",PRIMARY:"ui-label-primary",SECONDARY:"ui-label-secondary",LIGHTGREEN:"ui-label-lightgreen",LIGHTBLUE:"ui-label-lightblue",LIGHT:"ui-label-light"}),babelHelpers.defineProperty(Label,"RemoveButtonType",{INSIDE:"main-grid-tag-remove-inside",OUTSIDE:"main-grid-tag-remove-outside"});var namespace$4=main_core.Reflection.namespace("BX.Grid");namespace$4.Label=Label,function(){BX.namespace("BX.Main"),BX.Main.grid=function(t,e,i,n,s,o,a,r,l){BX.Event.EventEmitter.makeObservable(this,"BX.Main.Grid"),this.settings=null,this.containerId="",this.container=null,this.wrapper=null,this.fadeContainer=null,this.scrollContainer=null,this.pagination=null,this.moreButton=null,this.table=null,this.rows=null,this.history=!1,this.userOptions=null,this.checkAll=null,this.sortable=null,this.updater=null,this.data=null,this.fader=null,this.editor=null,this.isEditMode=null,this.pinHeader=null,this.pinPanel=null,this.arParams=null,this.resize=null,this.editableRows=[],this.init(t,e,i,n,s,o,a,r,l)},BX.Main.grid.prototype={init:function(t,e,i,n,s,o,a,r,l){if(this.baseUrl=window.location.pathname+window.location.search,this.container=BX(t),!BX.type.isNotEmptyString(t))throw"BX.Main.grid.init: parameter containerId is empty";if(!BX.type.isPlainObject(e))throw new Error("BX.Main.grid.init: arParams isn't object");if(this.arParams=e,this.settings=new BX.Grid.Settings,this.containerId=t,this.userOptions=new BX.Grid.UserOptions(this,i,n,s),this.gridSettings=new BX.Grid.SettingsWindow(this),this.messages=new BX.Grid.Message(this,l),this.cache=new BX.Cache.MemoryCache,this.getParam("ALLOW_PIN_HEADER")&&(this.pinHeader=new BX.Grid.PinHeader(this),BX.addCustomEvent(window,"Grid::headerUpdated",BX.proxy(this.bindOnCheckAll,this))),this.bindOnCheckAll(),this.getParam("ALLOW_HORIZONTAL_SCROLL")&&(this.fader=new BX.Grid.Fader(this)),this.pageSize=new BX.Grid.Pagesize(this),this.editor=new BX.Grid.InlineEditor(this,r),this.getParam("SHOW_ACTION_PANEL")&&(this.actionPanel=new BX.Grid.ActionPanel(this,o,a),this.pinPanel=new BX.Grid.PinPanel(this)),this.isEditMode=!1,!BX.type.isDomNode(this.getContainer()))throw"BX.Main.grid.init: Failed to find container with id "+this.getContainerId();if(!BX.type.isDomNode(this.getTable()))throw"BX.Main.grid.init: Failed to find table";this.bindOnRowEvents(),this.getParam("ALLOW_COLUMNS_RESIZE")&&(this.resize=new BX.Grid.Resize(this)),this.bindOnMoreButtonEvents(),this.bindOnClickPaginationLinks(),this.bindOnClickHeader(),this.getParam("ALLOW_ROWS_SORT")&&this.initRowsDragAndDrop(),this.getParam("ALLOW_COLUMNS_SORT")&&this.initColsDragAndDrop(),this.getRows().initSelected(),this.adjustEmptyTable(this.getRows().getSourceBodyChild()),BX.onCustomEvent(this.getContainer(),"Grid::ready",[this]),BX.addCustomEvent(window,"Grid::unselectRow",BX.proxy(this._onUnselectRows,this)),BX.addCustomEvent(window,"Grid::unselectRows",BX.proxy(this._onUnselectRows,this)),BX.addCustomEvent(window,"Grid::allRowsUnselected",BX.proxy(this._onUnselectRows,this)),BX.addCustomEvent(window,"Grid::updated",BX.proxy(this._onGridUpdated,this)),window.frames[this.getFrameId()].onresize=BX.throttle(this._onFrameResize,20,this),this.getParam("ALLOW_STICKED_COLUMNS")&&this.initStickedColumns()},destroy:function(){BX.removeCustomEvent(window,"Grid::unselectRow",BX.proxy(this._onUnselectRows,this)),BX.removeCustomEvent(window,"Grid::unselectRows",BX.proxy(this._onUnselectRows,this)),BX.removeCustomEvent(window,"Grid::allRowsUnselected",BX.proxy(this._onUnselectRows,this)),BX.removeCustomEvent(window,"Grid::headerPinned",BX.proxy(this.bindOnCheckAll,this)),BX.removeCustomEvent(window,"Grid::updated",BX.proxy(this._onGridUpdated,this)),this.getPinHeader()&&this.getPinHeader().destroy(),this.getFader()&&this.getFader().destroy(),this.getResize()&&this.getResize().destroy(),this.getColsSortable()&&this.getColsSortable().destroy(),this.getRowsSortable()&&this.getRowsSortable().destroy(),this.getSettingsWindow()&&this.getSettingsWindow().destroy(),this.getActionsPanel()&&this.getActionsPanel().destroy(),this.getPinPanel()&&this.getPinPanel().destroy(),this.getPageSize()&&this.getPageSize().destroy()},_onFrameResize:function(){BX.onCustomEvent(window,"Grid::resize",[this])},_onGridUpdated:function(){this.initStickedColumns(),this.adjustFadePosition(this.getFadeOffset())},getFrameId:function(){return"main-grid-tmp-frame-"+this.getContainerId()},enableActionsPanel:function(){if(this.getParam("SHOW_ACTION_PANEL")){var t=this.getActionsPanel().getPanel();BX.type.isDomNode(t)&&BX.removeClass(t,this.settings.get("classDisable"))}},disableActionsPanel:function(){if(this.getParam("SHOW_ACTION_PANEL")){var t=this.getActionsPanel().getPanel();BX.type.isDomNode(t)&&BX.addClass(t,this.settings.get("classDisable"))}},getSettingsWindow:function(){return this.gridSettings},_onUnselectRows:function(){var t,e=this.getActionsPanel();e instanceof BX.Grid.ActionPanel&&(t=e.getForAllCheckbox(),BX.type.isDomNode(t)&&(t.checked=null,this.disableForAllCounter())),this.adjustCheckAllCheckboxes()},isIE:function(){return BX.type.isBoolean(this.ie)||(this.ie=BX.hasClass(document.documentElement,"bx-ie")),this.ie},isTouch:function(){return BX.type.isBoolean(this.touch)||(this.touch=BX.hasClass(document.documentElement,"bx-touch")),this.touch},getParam:function(t,e){return void 0===e&&(e=null),this.arParams.hasOwnProperty(t)?this.arParams[t]:e},getCounterTotal:function(){return BX.Grid.Utils.getByClass(this.getContainer(),this.settings.get("classCounterTotal"),!0)},getActionKey:function(){return"action_button_"+this.getId()},getPinHeader:function(){return this.getParam("ALLOW_PIN_HEADER")&&(this.pinHeader=this.pinHeader||new BX.Grid.PinHeader(this)),this.pinHeader},getResize:function(){return this.resize instanceof BX.Grid.Resize||!this.getParam("ALLOW_COLUMNS_RESIZE")||(this.resize=new BX.Grid.Resize(this)),this.resize},confirmForAll:function(t){var e,i=this;BX.type.isDomNode(t)&&(e=BX.Grid.Utils.getByTag(t,"input",!0)),e.checked?this.getActionsPanel().confirmDialog({CONFIRM:!0,CONFIRM_MESSAGE:this.arParams.CONFIRM_FOR_ALL_MESSAGE},(function(){BX.type.isDomNode(e)&&(e.checked=!0),i.selectAllCheckAllCheckboxes(),i.getRows().selectAll(),i.enableForAllCounter(),i.updateCounterDisplayed(),i.updateCounterSelected(),i.enableActionsPanel(),i.adjustCheckAllCheckboxes(),i.lastRowAction=null,BX.onCustomEvent(window,"Grid::allRowsSelected",[])}),(function(){BX.type.isDomNode(e)&&(e.checked=null,i.disableForAllCounter(),i.updateCounterDisplayed(),i.updateCounterSelected(),i.adjustCheckAllCheckboxes(),i.lastRowAction=null)})):(this.unselectAllCheckAllCheckboxes(),this.adjustCheckAllCheckboxes(),this.getRows().unselectAll(),this.disableForAllCounter(),this.updateCounterDisplayed(),this.updateCounterSelected(),this.disableActionsPanel(),BX.onCustomEvent(window,"Grid::allRowsUnselected",[]))},disableCheckAllCheckboxes:function(){this.getCheckAllCheckboxes().forEach((function(t){t.getNode().disabled=!0}))},enableCheckAllCheckboxes:function(){this.getCheckAllCheckboxes().forEach((function(t){t.getNode().disabled=!1}))},indeterminateCheckAllCheckboxes:function(){this.getCheckAllCheckboxes().forEach((function(t){t.getNode().indeterminate=!0}))},determinateCheckAllCheckboxes:function(){this.getCheckAllCheckboxes().forEach((function(t){t.getNode().indeterminate=!1}))},editSelected:function(){this.disableCheckAllCheckboxes(),this.getRows().editSelected(),this.getParam("ALLOW_PIN_HEADER")&&this.getPinHeader()._onGridUpdate(),BX.onCustomEvent(window,"Grid::resize",[this])},editSelectedSave:function(){var t={FIELDS:this.getRows().getEditSelectedValues(!0)};if(this.getParam("ALLOW_VALIDATE"))return this.tableFade(),t[this.getActionKey()]="validate",void this.getData().request("","POST",t,"validate",function(e){if((e=JSON.parse(e)).messages.length){this.arParams.MESSAGES=e.messages,this.messages.show();var i=this.getActionsPanel().getButtons().find((function(t){return"grid_edit_button_control"===t.id}));this.tableUnfade(),BX.fireEvent(i,"click")}else t[this.getActionKey()]="edit",this.reloadTable("POST",t)}.bind(this));if(this.getParam("HANDLE_RESPONSE_ERRORS")){t[this.getActionKey()]="edit";var e=this;return this.tableFade(),void this.getData().request("","POST",t,"",(function(t){try{t=JSON.parse(t)}catch(e){t={messages:[]}}if(t.messages.length){e.arParams.MESSAGES=t.messages,e.messages.show();var i=e.getActionsPanel().getButtons().find((function(t){return"grid_edit_button_control"===t.id}));return e.tableUnfade(),void BX.fireEvent(i,"click")}e.getRows().reset();var n=this.getBodyRows();e.getUpdater().updateContainer(this.getContainer()),e.getUpdater().updateHeadRows(this.getHeadRows()),e.getUpdater().updateBodyRows(n),e.getUpdater().updateFootRows(this.getFootRows()),e.getUpdater().updatePagination(this.getPagination()),e.getUpdater().updateMoreButton(this.getMoreButton()),e.getUpdater().updateCounterTotal(this.getCounterTotal()),e.adjustEmptyTable(n),e.bindOnRowEvents(),e.bindOnMoreButtonEvents(),e.bindOnClickPaginationLinks(),e.bindOnClickHeader(),e.bindOnCheckAll(),e.updateCounterDisplayed(),e.updateCounterSelected(),e.disableActionsPanel(),e.disableForAllCounter(),e.getParam("SHOW_ACTION_PANEL")&&e.getUpdater().updateGroupActions(this.getActionPanel()),e.getParam("ALLOW_COLUMNS_SORT")&&e.colsSortable.reinit(),e.getParam("ALLOW_ROWS_SORT")&&e.rowsSortable.reinit(),e.tableUnfade(),BX.onCustomEvent(window,"Grid::updated",[e])}),(function(t){var i=e.getActionsPanel().getButtons().find((function(t){return"grid_edit_button_control"===t.id}));e.tableUnfade(),BX.fireEvent(i,"click")}))}t[this.getActionKey()]="edit",this.reloadTable("POST",t)},getForAllKey:function(){return"action_all_rows_"+this.getId()},updateRow:function(t,e,i,n){var s=this.getRows().getById(t);s instanceof BX.Grid.Row&&s.update(e,i,n)},removeRow:function(t,e,i,n){var s=this.getRows().getById(t);s instanceof BX.Grid.Row&&s.remove(e,i,n)},addRow:function(t,e,i){var n={action:this.getUserOptions().getAction("GRID_ADD_ROW"),data:t},s=this;this.tableFade(),this.getData().request(e,"POST",n,null,(function(){var e=this.getBodyRows();s.getUpdater().updateBodyRows(e),s.tableUnfade(),s.getRows().reset(),s.getUpdater().updateFootRows(this.getFootRows()),s.getUpdater().updatePagination(this.getPagination()),s.getUpdater().updateMoreButton(this.getMoreButton()),s.getUpdater().updateCounterTotal(this.getCounterTotal()),s.bindOnRowEvents(),s.adjustEmptyTable(e),s.bindOnMoreButtonEvents(),s.bindOnClickPaginationLinks(),s.updateCounterDisplayed(),s.updateCounterSelected(),s.getParam("ALLOW_COLUMNS_SORT")&&s.colsSortable.reinit(),s.getParam("ALLOW_ROWS_SORT")&&s.rowsSortable.reinit(),BX.onCustomEvent(window,"Grid::rowAdded",[{data:t,grid:s,response:this}]),BX.onCustomEvent(window,"Grid::updated",[s]),BX.type.isFunction(i)&&i({data:t,grid:s,response:this})}))},editSelectedCancel:function(){this.getRows().editSelectedCancel(),this.getParam("ALLOW_PIN_HEADER")&&this.getPinHeader()._onGridUpdate()},removeSelected:function(){var t={ID:this.getRows().getSelectedIds()},e=this.getActionsPanel().getValues();t[this.getActionKey()]="delete",t[this.getForAllKey()]=this.getForAllKey()in e?e[this.getForAllKey()]:"N",this.reloadTable("POST",t)},sendSelected:function(){var t=this.getActionsPanel().getValues(),e={rows:this.getRows().getSelectedIds(),controls:t};this.reloadTable("POST",e)},getActionsPanel:function(){return this.actionPanel},getPinPanel:function(){return this.pinPanel},getApplyButton:function(){return BX.Grid.Utils.getByClass(this.getContainer(),this.settings.get("classPanelButton"),!0)},getEditor:function(){return this.editor},reload:function(t){this.reloadTable("GET",{},null,t)},getPanels:function(){return BX.Grid.Utils.getByClass(this.getContainer(),this.settings.get("classPanels"),!0)},getEmptyBlock:function(){return BX.Grid.Utils.getByClass(this.getContainer(),this.settings.get("classEmptyBlock"),!0)},adjustEmptyTable:function(t){function e(t){var e=t.currentTarget;BX.style(r,"transform","translate3d("+BX.scrollLeft(e)+"px, 0px, 0")}var i=t.filter((function(t){return"template_0"!==BX.Dom.attr(t,"data-id")&&!BX.Dom.hasClass(t,"main-grid-hide")}));if(!BX.hasClass(document.documentElement,"bx-ie")&&1===i.length&&BX.hasClass(i[0],this.settings.get("classEmptyRows"))){var n=BX.pos(this.getContainer()),s=BX.scrollTop(window)+BX.height(window),o=n.bottom-s,a=BX.height(this.getPanels()),r=this.getEmptyBlock(),l=BX.width(this.getContainer());l&&BX.width(r,l),BX.style(r,"transform","translate3d("+BX.scrollLeft(this.getScrollContainer())+"px, 0px, 0"),BX.unbind(this.getScrollContainer(),"scroll",e),BX.bind(this.getScrollContainer(),"scroll",e);for(var d=this.getContainer(),h=0;d=d.parentElement;){var c=parseFloat(BX.style(d,"padding-top")),u=parseFloat(BX.style(d,"padding-bottom"));isNaN(c)||(h+=c),isNaN(u)||(h+=u)}o>0?BX.style(this.getTable(),"min-height",n.height-o-a-h+"px"):BX.style(this.getTable(),"min-height",n.height+Math.abs(o)-a-h+"px"),BX.Dom.addClass(this.getContainer(),"main-grid-empty-stub"),this.getCurrentPage()<=1&&this.hidePanels()}else BX.style(this.getTable(),"min-height",""),BX.style(this.getTable(),"height","1px"),requestAnimationFrame(function(){BX.style(this.getTable(),"height","1px")}.bind(this)),this.showPanels(),BX.Dom.removeClass(this.getContainer(),"main-grid-empty-stub")},reloadTable:function(t,e,i,n){var s;BX.type.isNotEmptyString(t)||(t="GET"),BX.type.isPlainObject(e)||(e={});var o=this;this.tableFade(),BX.type.isString(n)||(n=""),this.getData().request(n,t,e,"",(function(){BX.onCustomEvent(window,"BX.Main.Grid:onBeforeReload",[o]),o.getRows().reset(),s=this.getBodyRows(),o.getUpdater().updateContainer(this.getContainer()),o.getUpdater().updateHeadRows(this.getHeadRows()),o.getUpdater().updateBodyRows(s),o.getUpdater().updateFootRows(this.getFootRows()),o.getUpdater().updatePagination(this.getPagination()),o.getUpdater().updateMoreButton(this.getMoreButton()),o.getUpdater().updateCounterTotal(this.getCounterTotal()),o.adjustEmptyTable(s),o.bindOnRowEvents(),o.bindOnMoreButtonEvents(),o.bindOnClickPaginationLinks(),o.bindOnClickHeader(),o.bindOnCheckAll(),o.updateCounterDisplayed(),o.updateCounterSelected(),o.disableActionsPanel(),o.disableForAllCounter(),o.getParam("SHOW_ACTION_PANEL")&&o.getUpdater().updateGroupActions(this.getActionPanel()),o.getParam("ALLOW_COLUMNS_SORT")&&o.colsSortable.reinit(),o.getParam("ALLOW_ROWS_SORT")&&o.rowsSortable.reinit(),o.tableUnfade(),BX.onCustomEvent(window,"Grid::updated",[o]),BX.type.isFunction(i)&&i(),o.getParam("ALLOW_PIN_HEADER")&&o.getPinHeader()._onGridUpdate()}))},getGroupEditButton:function(){return BX.Grid.Utils.getByClass(this.getContainer(),this.settings.get("classGroupEditButton"),!0)},getGroupDeleteButton:function(){return BX.Grid.Utils.getByClass(this.getContainer(),this.settings.get("classGroupDeleteButton"),!0)},enableGroupActions:function(){var t=this.getGroupEditButton(),e=this.getGroupDeleteButton();BX.type.isDomNode(t)&&BX.removeClass(t,this.settings.get("classGroupActionsDisabled")),BX.type.isDomNode(e)&&BX.removeClass(e,this.settings.get("classGroupActionsDisabled"))},disableGroupActions:function(){var t=this.getGroupEditButton(),e=this.getGroupDeleteButton();BX.type.isDomNode(t)&&BX.addClass(t,this.settings.get("classGroupActionsDisabled")),BX.type.isDomNode(e)&&BX.addClass(e,this.settings.get("classGroupActionsDisabled"))},closeActionsMenu:function(){for(var t=this.getRows().getRows(),e=0,i=t.length;e<i;e++)t[e].closeActionsMenu()},getPageSize:function(){return this.pageSize},getFader:function(){return this.fader},getData:function(){return this.data=this.data||new BX.Grid.Data(this),this.data},getUpdater:function(){return this.updater=this.updater||new BX.Grid.Updater(this),this.updater},isSortableHeader:function(t){return BX.hasClass(t,this.settings.get("classHeaderSortable"))},isNoSortableHeader:function(t){return BX.hasClass(t,this.settings.get("classHeaderNoSortable"))},bindOnClickHeader:function(){var t,e=this;BX.bind(this.getContainer(),"click",(function(i){if((t=BX.findParent(i.target,{tag:"th"},!0,!1))&&e.isSortableHeader(t)&&!e.preventSortableClick){var n=new BX.Event.BaseEvent({data:{grid:e,columnName:BX.data(t,"name")}});if(BX.Event.EventEmitter.emit("BX.Main.grid:onBeforeSort",n),n.isDefaultPrevented())return;e.preventSortableClick=!1,e._clickOnSortableHeader(t,i)}}))},enableEditMode:function(){this.isEditMode=!0},disableEditMode:function(){this.isEditMode=!1},isEditMode:function(){return this.isEditMode},getColumnHeaderCellByName:function(t){return BX.Grid.Utils.getBySelector(this.getContainer(),"#"+this.getId()+' th[data-name="'+t+'"]',!0)},getColumnByName:function(t){var e=this.getParam("DEFAULT_COLUMNS");return t&&t in e?e[t]:null},adjustIndex:function(t){return t+this.getAllRows()[0].querySelectorAll(".main-grid-fixed-column").length},getColumnByIndex:function(t){return t=this.adjustIndex(t),this.getAllRows().reduce((function(e,i){return i.classList.contains("main-grid-row-custom")||i.classList.contains("main-grid-row-empty")||e.push(i.children[t]),e}),[])},getAllRows:function(){var t=[].slice.call(this.getTable().rows),e=this.getContainer().parentElement.querySelector(".main-grid-fixed-bar table");return e&&t.push(e.rows[0]),t},initStickedColumns:function(){[].slice.call(this.getAllRows()[0].children).forEach((function(t,e){t.classList.contains("main-grid-sticked-column")&&this.stickyColumnByIndex(e)}),this),this.getParam("ALLOW_COLUMNS_RESIZE")&&(this.getResize().destroy(),this.getResize().init(this))},setStickedColumns:function(t){if(BX.type.isArray(t)){var e=this.getUserOptions(),i=[{action:e.getAction("GRID_SET_STICKED_COLUMNS"),stickedColumns:t}];e.batch(i,function(){this.reloadTable()}.bind(this))}},getStickedColumns:function(){return[].slice.call(this.getHead().querySelectorAll(".main-grid-cell-head")).reduce(function(t,e){return!BX.hasClass(e,"main-grid-fixed-column")||BX.hasClass(e,"main-grid-cell-checkbox")||BX.hasClass(e,"main-grid-cell-action")||t.push(e.dataset.name),t}.bind(this),[])},stickyColumnByIndex:function(t){var e=this.getColumnByIndex(t),i=e[0].clientWidth,n=e.map((function(t){return BX.height(t)}));e.forEach((function(t,e){t.style.minWidth=i+"px",t.style.width=i+"px",t.style.minHeight=n[e]+"px";var s=BX.clone(t),o=this.getLastStickyCellFromRowByIndex(e);if(o){var a=parseInt(BX.style(o,"left")),r=parseInt(BX.style(o,"width"));a=isNaN(a)?0:a,r=isNaN(r)?0:r,t.style.left=a+r+"px"}t.classList.add("main-grid-fixed-column"),t.classList.add("main-grid-cell-static"),s.classList.add("main-grid-cell-static"),this.getColsSortable()&&(this.getColsSortable().unregister(t),this.getColsSortable().unregister(s)),BX.insertAfter(s,t)}),this),this.adjustFadePosition(this.getFadeOffset())},adjustFixedColumnsPosition:function(){var t=this.getAllRows()[0].querySelectorAll(".main-grid-fixed-column").length,e=[].slice.call(this.getAllRows()[0].children).reduce((function(t,e,i,n){var s,o;return n[i-1]&&n[i-1].classList.contains("main-grid-fixed-column")&&(s=parseInt(BX.style(n[i-1],"left")),o=parseInt(BX.style(n[i-1],"width")),s=isNaN(s)?0:s,o=isNaN(o)?0:o,t.push({index:i+1,left:s+o})),t}),[]);e.forEach((function(i){this.getColumnByIndex(i.index-t).forEach((function(t){i.index!==e[e.length-1].index&&(t.style.left=i.left+"px")}))}),this),this.getAllRows().forEach((function(t){var e=BX.height(t);[].slice.call(t.children).forEach((function(t){t.style.minHeight=e+"px"}))}))},getLastStickyCellFromRowByIndex:function(t){return[].slice.call(this.getAllRows()[t].children).reduceRight((function(t,e){return!t&&e.classList.contains("main-grid-fixed-column")&&(t=e),t}),null)},getFadeOffset:function(){var t=0,e=this.getLastStickyCellFromRowByIndex(0);if(e){var i=parseInt(BX.style(e,"left")),n=e.offsetWidth;t=(i=isNaN(i)?0:i)+(n=isNaN(n)?0:n)}return t},adjustFadePosition:function(t){if(this.getFader()){var e=this.getFader().getEarLeft(),i=this.getFader().getShadowLeft();e.style.left=t+"px",i.style.left=t+"px"}},sortByColumn:function(t){var e=null,i=null;if(BX.type.isPlainObject(t)?(i=t).sort_url=this.prepareSortUrl(t):(e=this.getColumnHeaderCellByName(t),i=this.getColumnByName(t)),i&&(e&&!BX.hasClass(e,this.settings.get("classLoad"))||!e)){e&&BX.addClass(e,this.settings.get("classLoad")),this.tableFade();var n=this;this.getUserOptions().setSort(i.sort_by,i.sort_order,(function(){n.getData().request(i.sort_url,null,null,"sort",(function(){n.rows=null,n.getUpdater().updateHeadRows(this.getHeadRows()),n.getUpdater().updateBodyRows(this.getBodyRows()),n.getUpdater().updatePagination(this.getPagination()),n.getUpdater().updateMoreButton(this.getMoreButton()),n.bindOnRowEvents(),n.bindOnMoreButtonEvents(),n.bindOnClickPaginationLinks(),n.bindOnCheckAll(),n.updateCounterDisplayed(),n.updateCounterSelected(),n.disableActionsPanel(),n.disableForAllCounter(),n.getParam("SHOW_ACTION_PANEL")&&n.getActionsPanel().resetForAllCheckbox(),n.getParam("ALLOW_ROWS_SORT")&&n.rowsSortable.reinit(),n.getParam("ALLOW_COLUMNS_SORT")&&n.colsSortable.reinit(),BX.onCustomEvent(window,"BX.Main.grid:sort",[i,n]),BX.onCustomEvent(window,"Grid::updated",[n]),n.tableUnfade()}))}))}},prepareSortUrl:function(t){var e=window.location.toString();return"sort_by"in t&&(e=BX.util.add_url_param(e,{by:t.sort_by})),"sort_order"in t&&(e=BX.util.add_url_param(e,{order:t.sort_order})),e},_clickOnSortableHeader:function(t,e){e.preventDefault(),this.sortByColumn(BX.data(t,"name"))},getObserver:function(){return BX.Grid.observer},initRowsDragAndDrop:function(){this.rowsSortable=new BX.Grid.RowsSortable(this)},initColsDragAndDrop:function(){this.colsSortable=new BX.Grid.ColsSortable(this)},getRowsSortable:function(){return this.rowsSortable},getColsSortable:function(){return this.colsSortable},getUserOptionsHandlerUrl:function(){return this.userOptionsHandlerUrl||""},getUserOptions:function(){return this.userOptions},getCheckAllCheckboxes:function(){return BX.Grid.Utils.getByClass(this.getContainer(),this.settings.get("classCheckAllCheckboxes")).map((function(t){return new BX.Grid.Element(t)}))},selectAllCheckAllCheckboxes:function(){this.getCheckAllCheckboxes().forEach((function(t){t.getNode().checked=!0}))},unselectAllCheckAllCheckboxes:function(){this.getCheckAllCheckboxes().forEach((function(t){t.getNode().checked=!1}))},adjustCheckAllCheckboxes:function(){var t=this.getRows().getBodyChild().filter((function(t){return t.isShown()&&!!t.getCheckbox()})).length,e=this.getRows().getSelected().filter((function(t){return t.isShown()})).length;t>0&&e>0&&t===e?this.selectAllCheckAllCheckboxes():this.unselectAllCheckAllCheckboxes(),e>0&&e<t?this.indeterminateCheckAllCheckboxes():this.determinateCheckAllCheckboxes()},bindOnCheckAll:function(){var t=this;this.getCheckAllCheckboxes().forEach((function(e){e.getObserver().add(e.getNode(),"change",t._clickOnCheckAll,t)}))},_clickOnCheckAll:function(t){t.preventDefault(),this.toggleSelectionAll(),this.determinateCheckAllCheckboxes()},toggleSelectionAll:function(){this.getRows().isAllSelected()||"select"!==this.lastRowAction&&this.lastRowAction?(this.getRows().unselectAll(),this.unselectAllCheckAllCheckboxes(),this.disableActionsPanel(),BX.onCustomEvent(window,"Grid::allRowsUnselected",[this])):(this.getRows().selectAll(),this.selectAllCheckAllCheckboxes(),this.enableActionsPanel(),BX.onCustomEvent(window,"Grid::allRowsSelected",[this])),delete this.lastRowAction,this.updateCounterSelected()},bindOnClickPaginationLinks:function(){var t=this;this.getPagination().getLinks().forEach((function(e){e.getObserver().add(e.getNode(),"click",t._clickOnPaginationLink,t)}))},bindOnMoreButtonEvents:function(){this.getMoreButton().getObserver().add(this.getMoreButton().getNode(),"click",this._clickOnMoreButton,this)},bindOnRowEvents:function(){var t=this.getObserver(),e=this.getParam("SHOW_ROW_CHECKBOXES"),i=this.getParam("ENABLE_COLLAPSIBLE_ROWS");this.getRows().getBodyChild().forEach((function(n){e&&t.add(n.getNode(),"click",this._onClickOnRow,this),n.getDefaultAction()&&t.add(n.getNode(),"dblclick",this._onRowDblclick,this),n.getActionsButton()&&t.add(n.getActionsButton(),"click",this._clickOnRowActionsButton,this),i&&n.getCollapseButton()&&t.add(n.getCollapseButton(),"click",this._onCollapseButtonClick,this)}),this)},_onCollapseButtonClick:function(t){t.preventDefault(),t.stopPropagation();var e=this.getRows().get(t.currentTarget);e.toggleChildRows(),e.isCustom()?this.getUserOptions().setCollapsedGroups(this.getRows().getIdsCollapsedGroups()):this.getUserOptions().setExpandedRows(this.getRows().getIdsExpandedRows()),BX.fireEvent(document.body,"click")},_clickOnRowActionsButton:function(t){var e=this.getRows().get(t.target);t.preventDefault(),e.actionsMenuIsShown()?e.closeActionsMenu():e.showActionsMenu()},_onRowDblclick:function _onRowDblclick(event){event.preventDefault();var row=this.getRows().get(event.target),defaultJs="";if(!row.isEdit()){clearTimeout(this.clickTimer),this.clickPrevent=!0;try{defaultJs=row.getDefaultAction(),eval(defaultJs)}catch(t){}}},_onClickOnRow:function(t){var e=window.getSelection();function i(t){var e,i,n,s,o,a=!0;if("A"!==t.target.nodeName&&"INPUT"!==t.target.nodeName&&(i=this.getRows().get(t.target))&&(o=i.getContentContainer(t.target),BX.type.isDomNode(o)&&"TD"!==t.target.nodeName&&t.target!==o&&(a="true"===BX.data(o,"prevent-default")),a)){if(i.getCheckbox()){if(e=[],this.currentIndex=0,this.getRows().getRows().forEach((function(t,e){t===i&&(this.currentIndex=e)}),this),this.lastIndex=this.lastIndex||this.currentIndex,t.shiftKey){for(n=Math.min(this.currentIndex,this.lastIndex),s=Math.max(this.currentIndex,this.lastIndex);n<=s;)e.push(this.getRows().getRows()[n]),n++;e.some((function(t){return!t.isSelected()}))?(e.forEach((function(t){t.select()})),this.lastRowAction="select",BX.onCustomEvent(window,"Grid::selectRows",[e,this])):(e.forEach((function(t){t.unselect()})),this.lastRowAction="unselect",BX.onCustomEvent(window,"Grid::unselectRows",[e,this]))}else i.isSelected()?(this.lastRowAction="unselect",i.unselect(),BX.onCustomEvent(window,"Grid::unselectRow",[i,this])):(this.lastRowAction="select",i.select(),BX.onCustomEvent(window,"Grid::selectRow",[i,this]));this.updateCounterSelected(),this.lastIndex=this.currentIndex}this.adjustRows(),this.adjustCheckAllCheckboxes()}}"LABEL"===t.target.nodeName&&t.preventDefault(),(t.shiftKey||0===e.toString().length)&&(t.shiftKey&&e.removeAllRanges(),this.clickTimer=setTimeout(BX.delegate((function(){this.clickPrevent||i.apply(this,[t]),this.clickPrevent=!1}),this),50))},adjustRows:function(){this.getRows().isSelected()?(BX.onCustomEvent(window,"Grid::thereSelectedRows",[this]),this.enableActionsPanel()):(BX.onCustomEvent(window,"Grid::noSelectedRows",[]),this.disableActionsPanel())},getPagination:function(){return new BX.Grid.Pagination(this)},getState:function(){return window.history.state},tableFade:function(){BX.addClass(this.getTable(),this.settings.get("classTableFade")),this.getLoader().show(),BX.onCustomEvent("Grid::disabled",[this])},tableUnfade:function(){BX.removeClass(this.getTable(),this.settings.get("classTableFade")),this.getLoader().hide(),BX.onCustomEvent("Grid::enabled",[this])},_clickOnPaginationLink:function(t){t.preventDefault();var e=this,i=this.getPagination().getLink(t.target);i.isLoad()||(this.getUserOptions().resetExpandedRows(),i.load(),this.tableFade(),this.getData().request(i.getLink(),null,null,"pagination",(function(){e.rows=null,e.getUpdater().updateBodyRows(this.getBodyRows()),e.getUpdater().updateHeadRows(this.getHeadRows()),e.getUpdater().updateMoreButton(this.getMoreButton()),e.getUpdater().updatePagination(this.getPagination()),e.bindOnRowEvents(),e.bindOnMoreButtonEvents(),e.bindOnClickPaginationLinks(),e.bindOnCheckAll(),e.updateCounterDisplayed(),e.updateCounterSelected(),e.disableActionsPanel(),e.disableForAllCounter(),e.getParam("SHOW_ACTION_PANEL")&&e.getActionsPanel().resetForAllCheckbox(),e.getParam("ALLOW_ROWS_SORT")&&e.rowsSortable.reinit(),e.getParam("ALLOW_COLUMNS_SORT")&&e.colsSortable.reinit(),i.unload(),e.tableUnfade(),BX.onCustomEvent(window,"Grid::updated",[e])})))},_clickOnMoreButton:function(t){t.preventDefault();var e=this,i=this.getMoreButton();i.load(),this.getData().request(i.getLink(),null,null,"more",(function(){e.getUpdater().appendBodyRows(this.getBodyRows()),e.getUpdater().updateMoreButton(this.getMoreButton()),e.getUpdater().updatePagination(this.getPagination()),e.getRows().reset(),e.bindOnRowEvents(),e.bindOnMoreButtonEvents(),e.bindOnClickPaginationLinks(),e.bindOnCheckAll(),e.updateCounterDisplayed(),e.updateCounterSelected(),e.getParam("ALLOW_PIN_HEADER")&&e.getPinHeader()._onGridUpdate(),e.getParam("ALLOW_ROWS_SORT")&&e.rowsSortable.reinit(),e.getParam("ALLOW_COLUMNS_SORT")&&e.colsSortable.reinit(),e.unselectAllCheckAllCheckboxes()}))},getAjaxId:function(){return BX.data(this.getContainer(),this.settings.get("ajaxIdDataProp"))},update:function(t,e){var i,n,s,o,a,r;BX.type.isNotEmptyString(t)&&(o=BX.Grid.Utils.getByTag(this.getTable(),"tbody",!0),a=BX.Grid.Utils.getByTag(this.getTable(),"thead",!0),r=BX.Grid.Utils.getByClass(this.getContainer(),this.settings.get("classNavPanel"),!0),t=BX.create("div",{html:t}),n=BX.Grid.Utils.getByClass(t,this.settings.get("classHeadRow")),i=BX.Grid.Utils.getByClass(t,this.settings.get("classDataRows")),s=BX.Grid.Utils.getByClass(t,this.settings.get("classNavPanel"),!0),e===this.settings.get("updateActionMore")&&(this.getRows().addRows(i),this.unselectAllCheckAllCheckboxes()),e===this.settings.get("updateActionPagination")&&(BX.cleanNode(o),this.getRows().addRows(i),this.unselectAllCheckAllCheckboxes()),e===this.settings.get("updateActionSort")&&(BX.cleanNode(a),BX.cleanNode(o),a.appendChild(n[0]),this.getRows().addRows(i)),r.innerHTML=s.innerHTML,this.bindOnRowEvents(),this.bindOnMoreButtonEvents(),this.bindOnClickPaginationLinks(),this.bindOnClickHeader(),this.bindOnCheckAll(),this.updateCounterDisplayed(),this.updateCounterSelected(),this.sortable.reinit())},getCounterDisplayed:function(){return BX.Grid.Utils.getByClass(this.getContainer(),this.settings.get("classCounterDisplayed"))},getCounterSelected:function(){return BX.Grid.Utils.getByClass(this.getContainer(),this.settings.get("classCounterSelected"))},updateCounterDisplayed:function(){var t,e=this.getCounterDisplayed();BX.type.isArray(e)&&(t=this.getRows(),e.forEach((function(e){BX.type.isDomNode(e)&&(e.innerText=t.getCountDisplayed())}),this))},updateCounterSelected:function(){var t,e=this.getCounterSelected();BX.type.isArray(e)&&(t=this.getRows(),e.forEach((function(e){BX.type.isDomNode(e)&&(e.innerText=t.getCountSelected())}),this))},getContainerId:function(){return this.containerId},getId:function(){return this.containerId},getContainer:function(){return BX(this.getContainerId())},getCounter:function(){return this.counter||(this.counter=BX.Grid.Utils.getByClass(this.getContainer(),this.settings.get("classCounter"))),this.counter},enableForAllCounter:function(){var t=this.getCounter();BX.type.isArray(t)&&t.forEach((function(t){BX.addClass(t,this.settings.get("classForAllCounterEnabled"))}),this)},disableForAllCounter:function(){var t=this.getCounter();BX.type.isArray(t)&&t.forEach((function(t){BX.removeClass(t,this.settings.get("classForAllCounterEnabled"))}),this)},getScrollContainer:function(){return this.scrollContainer||(this.scrollContainer=BX.Grid.Utils.getByClass(this.getContainer(),this.settings.get("classScrollContainer"),!0)),this.scrollContainer},getWrapper:function(){return this.wrapper||(this.wrapper=BX.Grid.Utils.getByClass(this.getContainer(),this.settings.get("classWrapper"),!0)),this.wrapper},getFadeContainer:function(){return this.fadeContainer||(this.fadeContainer=BX.Grid.Utils.getByClass(this.getContainer(),this.settings.get("classFadeContainer"),!0)),this.fadeContainer},getTable:function(){return BX.Grid.Utils.getByClass(this.getContainer(),this.settings.get("classTable"),!0)},getHeaders:function(){return BX.Grid.Utils.getBySelector(this.getWrapper(),'.main-grid-header[data-relative="'+this.getContainerId()+'"]')},getHead:function(){return BX.Grid.Utils.getByTag(this.getContainer(),"thead",!0)},getBody:function(){return BX.Grid.Utils.getByTag(this.getContainer(),"tbody",!0)},getFoot:function(){return BX.Grid.Utils.getByTag(this.getContainer(),"tfoot",!0)},getRows:function(){return this.rows instanceof BX.Grid.Rows||(this.rows=new BX.Grid.Rows(this)),this.rows},getMoreButton:function(){var t=BX.Grid.Utils.getByClass(this.getContainer(),this.settings.get("classMoreButton"),!0);return new BX.Grid.Element(t,this)},getLoader:function(){return this.loader instanceof BX.Grid.Loader||(this.loader=new BX.Grid.Loader(this)),this.loader},blockSorting:function(){BX.Grid.Utils.getByClass(this.getContainer(),this.settings.get("classHeadCell")).forEach((function(t){this.isSortableHeader(t)&&(BX.removeClass(t,this.settings.get("classHeaderSortable")),BX.addClass(t,this.settings.get("classHeaderNoSortable")))}),this)},unblockSorting:function(){BX.Grid.Utils.getByClass(this.getContainer(),this.settings.get("classHeadCell")).forEach((function(t){this.isNoSortableHeader(t)&&t.dataset.sortBy&&(BX.addClass(t,this.settings.get("classHeaderSortable")),BX.removeClass(t,this.settings.get("classHeaderNoSortable")))}),this)},confirmDialog:function(t,e,i){var n,s,o,a;function r(t){"Enter"===t.code&&(t.preventDefault(),t.stopPropagation(),BX.fireEvent(o,"click")),"Escape"===t.code&&(t.preventDefault(),t.stopPropagation(),BX.fireEvent(a,"click"))}"CONFIRM"in t&&t.CONFIRM?(t.CONFIRM_MESSAGE=t.CONFIRM_MESSAGE||this.arParams.CONFIRM_MESSAGE,t.CONFIRM_APPLY_BUTTON=t.CONFIRM_APPLY_BUTTON||this.arParams.CONFIRM_APPLY,t.CONFIRM_CANCEL_BUTTON=t.CONFIRM_CANCEL_BUTTON||this.arParams.CONFIRM_CANCEL,(n=new BX.PopupWindow(this.getContainerId()+"-confirm-dialog",null,{content:'<div class="main-grid-confirm-content">'+t.CONFIRM_MESSAGE+"</div>",titleBar:"CONFIRM_TITLE"in t?t.CONFIRM_TITLE:"",autoHide:!1,zIndex:9999,overlay:.4,offsetTop:-100,closeIcon:!0,closeByEsc:!0,events:{onClose:function(){BX.unbind(window,"keydown",r)}},buttons:[new BX.PopupWindowButton({text:t.CONFIRM_APPLY_BUTTON,id:this.getContainerId()+"-confirm-dialog-apply-button",events:{click:function(){BX.type.isFunction(e)&&e(),this.popupWindow.close(),this.popupWindow.destroy(),BX.onCustomEvent(window,"Grid::confirmDialogApply",[this]),BX.unbind(window,"keydown",r)}}}),new BX.PopupWindowButtonLink({text:t.CONFIRM_CANCEL_BUTTON,id:this.getContainerId()+"-confirm-dialog-cancel-button",events:{click:function(){BX.type.isFunction(i)&&i(),this.popupWindow.close(),this.popupWindow.destroy(),BX.onCustomEvent(window,"Grid::confirmDialogCancel",[this]),BX.unbind(window,"keydown",r)}}})]})).isShown()||(n.show(),s=n.popupContainer,BX.removeClass(s,this.settings.get("classCloseAnimation")),BX.addClass(s,this.settings.get("classShowAnimation")),o=BX(this.getContainerId()+"-confirm-dialog-apply-button"),a=BX(this.getContainerId()+"-confirm-dialog-cancel-button"),BX.bind(window,"keydown",r))):BX.type.isFunction(e)&&e()},getCurrentPage:function(){var t=parseInt(this.arParams.CURRENT_PAGE);return BX.Type.isNumber(t)?t:0},getEmptyStub:function(){return this.getTable().querySelector(".main-grid-row-empty")},showEmptyStub:function(){var t=this.getEmptyStub();t&&(BX.Dom.attr(t,"hidden",null),BX.Dom.addClass(this.getContainer(),"main-grid-empty-stub"),this.getCurrentPage()<=1&&this.hidePanels())},hideEmptyStub:function(){var t=this.getEmptyStub();t&&(BX.Dom.attr(t,"hidden",!0),BX.Dom.removeClass(this.getContainer(),"main-grid-empty-stub"),BX.Dom.style(this.getTable(),"min-height",null),this.showPanels())},showPanels:function(){BX.Dom.show(this.getPanels()),this.getPanels().offsetHeight>0&&BX.Dom.removeClass(this.getContainer(),"main-grid-empty-footer")},hidePanels:function(){BX.Dom.hide(this.getPanels()),BX.Dom.addClass(this.getContainer(),"main-grid-empty-footer")},getTemplateRow:function(){var t=BX.Runtime.clone(this.getRows().getBodyChild(!0).find((function(t){return"template_0"===t.getId()}))),e=BX.Runtime.clone(t.getNode());BX.Dom.prepend(e,this.getBody());var i=e.querySelector('[type="checkbox"]');return i&&(BX.Dom.attr(i,"disabled",null),BX.Dom.attr(i,"data-disabled",null)),new BX.Grid.Row(this,e)},getRowEditorValue:function(t){return this.rows=null,this.getRows().getSelected(t).map((function(t){return t.getEditorValue()}))},getRowEditorActionPanel:function(){return this.rowEditorActionPanel||(this.rowEditorActionPanel=BX.Dom.create({tag:"div",props:{className:"main-ui-grid-row-editor-actions-panel"},children:[BX.Dom.create({tag:"span",props:{className:"ui-btn ui-btn-success"},text:this.arParams.SAVE_BUTTON_LABEL,events:{click:this.saveRows.bind(this)}}),BX.Dom.create({tag:"span",props:{className:"ui-btn ui-btn-link"},text:this.arParams.CANCEL_BUTTON_LABEL,events:{click:this.hideRowsEditor.bind(this)}})]})),this.rowEditorActionPanel},showRowEditorActionsPanel:function(){var t=this.getRowEditorActionPanel();BX.Dom.append(t,this.actionPanel.getPanel())},hideRowEditorActionsPanel:function(){BX.Dom.remove(this.getRowEditorActionPanel())},prependRowEditor:function(){return this.addRowEditor("prepend")},appendRowEditor:function(){return this.addRowEditor("append")},addRowEditor:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"prepend";BX.Dom.style(this.getTable(),"min-height",null);var e=this.getTemplateRow();return this.editableRows.push(e),"prepend"===t?e.prependTo(this.getBody()):e.appendTo(this.getBody()),e.show(),e.select(),e.edit(),this.getRows().reset(),this.getParam("ALLOW_ROWS_SORT")&&this.rowsSortable.reinit(),this.getParam("ALLOW_COLUMNS_SORT")&&this.colsSortable.reinit(),this.hideEmptyStub(),e},hideRowsEditor:function(){this.editableRows.forEach((function(t){BX.Dom.remove(t.getNode())})),this.editableRows=[]},saveRows:function(){var t=this,e=this.getRowEditorValue(!0);this.emitAsync("onAddRowsAsync",{rows:e}).then((function(e){e.forEach((function(e,i){var n=t.editableRows[i];n&&(n.editCancel(),n.unselect(),n.makeCountable(),n.setId(e.id),n.setActions(e.actions),n.setCellsContent(e.columns))})),t.bindOnRowEvents(),t.updateCounterDisplayed(),t.updateCounterSelected(),t.editableRows=[]}))},getRealtime:function(){var t=this;return this.cache.remember("realtime",(function(){return new BX.Grid.Realtime({grid:t})}))}}}()})(this.window=this.window||{},BX.Event,BX.UI,BX);