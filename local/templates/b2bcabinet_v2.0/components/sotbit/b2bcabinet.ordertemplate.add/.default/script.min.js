window.JCB2BOrderTemplateAdd||(window.JCB2BOrderTemplateAdd=function(t){this.siteId=t.siteId||"",this.componentPath=t.componentPath||"",this.parameters=t.parameters||"",this.filesInputName=t.inputName,this.modal=document.querySelector(t.modalSelector),this.form=document.querySelector(t.formSelector),this.btnSend=document.querySelector(t.btnSendSelector),this.formData={},this.path_to_detail=t.path_to_detail,this.errorBlock=document.querySelector(t.errorBlockSelector),this.subscribeChangeUploadedFiles(this);const e=new MutationObserver(function(t){for(let e of t)e.target.classList.contains("show")||(this.resetForm(),this.hideError())}.bind(this));this.modal&&document.body.appendChild(this.modal),e.observe(this.modal,{childList:!1,subtree:!1,characterDataOldValue:!0,attributeFilter:["class"]}),this.btnSend&&(BX.unbindAll(this.btnSend),BX.bind(this.btnSend,"click",BX.delegate(this.createOrderTemplate,this))),this.uploudFilesCounter=0},window.JCB2BOrderTemplateAdd.prototype={createOrderTemplate:function(){if(this.showWait(),!this.checkFiles())return this.showError(BX.message("error_no_file")),void this.closeWait();BX.ajax.runComponentAction("sotbit:b2bcabinet.ordertemplate.add","createOrderTemplate",{signedParameters:this.parameters,mode:"class",data:{formData:this.formData}}).then(function(t){this.closeWait(),document.location.replace(path_to_detail.replace("#ID#",t.data))}.bind(this),function(t){var e="";t.errors.forEach((function(t,r,i){e+=t.message+"\n"})),this.showError(e),this.closeWait()}.bind(this))},subscribeChangeUploadedFiles:function(t){const e=document.querySelector(".file-placeholder-tbody");new MutationObserver((function(e){for(let r of e){let e=Array.prototype.slice.call(r.target.style).indexOf("display");r.target.classList.contains("files-storage")?t.uploudFilesCounter+=1:e>-1&&(t.uploudFilesCounter-=1)}t.uploudFilesCounter>0?t.btnSend.disabled=!1:t.btnSend.disabled=!0})).observe(e,{attributes:!0,subtree:!0})},resetForm:function(){var t=this.form.querySelectorAll(".del-but");if(t)for(var e=0;e<t.length;e++)t[e].click()},showWait:function(){var t=this.btnSend.querySelector("i");this.btnSend.setAttribute("disabled",!0),t.setAttribute("class","spinner-grow vertical-align-top me-2")},closeWait:function(){var t=this.btnSend.querySelector("i");this.btnSend.removeAttribute("disabled"),t.setAttribute("class","")},hideError:function(){this.errorBlock.textContent="",this.errorBlock.style.display="none"},showError:function(t){this.errorBlock.textContent=t,this.errorBlock.style.display="block"},checkFiles:function(){return this.formData=BX.ajax.prepareForm(this.form),this.formData.data[this.filesInputName]}});