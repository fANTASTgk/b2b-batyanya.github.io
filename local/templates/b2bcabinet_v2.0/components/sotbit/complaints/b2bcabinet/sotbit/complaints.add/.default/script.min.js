const DatatableAdvanced=function(){const t=function(){if(!$().DataTable)return;$.extend($.fn.dataTable.defaults,{autoWidth:!1,columnDefs:[{orderable:!0,targets:[0],width:"100%"},{orderable:!1,targets:"_all",createdCell:(t,a,e,s,n)=>{n>1&&e.length-1>n&&t.setAttribute("data-title",document.querySelector(`#complaint-positions__grid thead th:nth-child(${n+1})`).textContent)}},{orderable:!1,targets:[-1],width:95}],order:[[0,"asc"]],dom:'<"datatable-header"f<"datatable-add"b>l><"datatable-content"<"datatable-scroll"t><"datatable-footer"ip>>',language:{sZeroRecords:BX.message("SOTBIT_COMPLAINTS_POSITIONS_TABLE_EMPTY_FILTER"),sInfo:BX.message("SOTBIT_COMPLAINTS_POSITIONS_TABLE_PAGINATION_TITLE")+" _MAX_",sInfoEmpty:"",sInfoFiltered:"",search:'<div class="form-control-feedback form-control-feedback-start flex-fill">_INPUT_<div class="form-control-feedback-icon"><i class="ph-magnifying-glass text-primary"></i></div></div>',emptyTable:BX.message("SOTBIT_COMPLAINTS_POSITIONS_TABLE_EMPTY"),searchPlaceholder:BX.message("SOTBIT_COMPLAINTS_POSITIONS_TABLE_SEARCHPLACEHOLDER"),lengthMenu:'<span class="me-2">'+BX.message("SOTBIT_COMPLAINTS_POSITIONS_TABLE_COUNT_ITEMS")+"</span> _MENU_",paginate:{first:"First",last:"Last",next:"rtl"==$("html").attr("dir")?'<i class="ph-caret-left fs-sm align-middle"></i>':'<i class="ph-caret-right fs-sm align-middle"></i>',previous:"rtl"==$("html").attr("dir")?'<i class="ph-caret-right fs-sm align-middle"></i>':'<i class="ph-caret-left fs-sm align-middle"></i>'}}}),$(".datatable-show-all").DataTable({lengthMenu:[[10,25,50,-1],[10,25,50,"All"]]}),$(".datatable-dom-position").DataTable({dom:'<"datatable-header length-left"lp><"datatable-add"add><"datatable-scroll"t><"datatable-footer info-right"fi>'});const t=$(".datatable-highlight").DataTable();$(".dataTables_length select").attr("data-minimum-results-for-search","Infinity"),t.on("draw",(function(){DatatableAdvanced.touchspin()}))},a=function(){$(".touchspin-basic").each((function(){let t=2;1==$(this).attr("data-ratio")&&(t=0),""!=$(this).attr("data-ratio")&&""!=$(this).attr("data-max")?$(this).TouchSpin({initval:$(this).attr("data-ratio"),min:$(this).attr("data-ratio"),step:$(this).attr("data-ratio"),max:$(this).attr("data-max"),buttondown_class:"btn",buttonup_class:"btn",buttondown_txt:'<i class="ph-minus"></i>',buttonup_txt:'<i class="ph-plus"></i>',decimals:t}).addClass("fs-xs"):$(this).TouchSpin({initval:1,min:1,max:100,step:1,decimals:0}).addClass("fs-xs")}))};return{listProducts:[],init:function(){t(),a()},link:t,touchspin:function(){a()}}}();document.addEventListener("DOMContentLoaded",(function(){DatatableAdvanced.init(),App.initSelect2(),i(),document.querySelector(".datatable-add").innerHTML='<button type="button" class="complaints__add-position btn btn-primary btn-sm-icon ps-sm-3"><i class="ph-plus me-sm-2"></i><span class="d-none d-sm-block">'+BX.message("SOTBIT_COMPLAINTS_POSITIONS_BTN_ADD")+"</span></button>";const t=document.querySelector(".complaints-add-wrap"),a=t.querySelector("#complaint-add"),e=a.querySelector(".complaints__add-position"),s=t.querySelector(".complaint__error-block"),n=document.querySelector(".complaints-add__success-block");function i(){const t=document.querySelector(".dataTables_empty");t&&t.addEventListener("click",d)}function o(a){n.querySelector(".alert-success").textContent=a,t.remove(),n.style.display="block",n.scrollIntoView(!1)}function l(){s.innerHTML="",s.style.display="none"}function d(){if("ORDER"==comlaintsType){var t=document.getElementsByName("COMPLAINTS[PROPERTIES][ORDER_ID]")[0].value;""!==t&&(BX.SidePanel.Instance.destroy(searchPage),BX.SidePanel.Instance.open(searchPage,{requestMethod:"post",requestParams:{orderId:t},allowChangeHistory:!1,animationDuration:100,width:1450}))}else BX.SidePanel.Instance.open(searchPage,{allowChangeHistory:!1,animationDuration:100,width:1450})}a.addEventListener("submit",(function(t){t.preventDefault();const e=this.querySelector('button[type="submit"]');e.disabled=!0,BX.showWait(),$("#complaint-positions__grid").DataTable().data();const n=new FormData(a);$("#complaint-positions__grid").DataTable().cells().nodes().each((function(t){const a=t.querySelector('[data-item="position"]');a&&(n.has(a.name)?n.set(a.name,a.value):n.append(a.name,a.value))}));BX.ajax.runComponentAction("sotbit:complaints.add","addComplaint",{mode:"class",data:n}).then((function(t){t.data.success_title&&(l(),o(t.data.success_title)),e.disabled=!1,BX.closeWait()}),(function(t){const a=t.errors.filter((function(t){return 0==t.code}));0!=a.length?function(t){s.innerHTML=t,s.style.display="block",s.scrollIntoView(!1)}(a.map((function(t){return t.message})).join("<br>")):(l(),o(t.errors.filter((function(t){return null!=t.customData})).map((function(t){return t.customData})).join("<br>"))),e.disabled=!1,BX.closeWait()}))})),e&&e.addEventListener("click",d),BX.addCustomEvent("SidePanel.Slider:onMessage",(t=>{if("addPosition"===t.eventId)t.data.product&&(BX.util.in_array(t.data.product.ID,DatatableAdvanced.listProducts)?BX.onCustomEvent("B2BNotification",[BX.message("SOTBIT_POSITION_NAME_ADD_NOTIFICATION")+t.data.product.NAME+"<br>"+BX.message("SOTBIT_POSITION_NOT_ADD_NOTIFICATION"),"false"]):(DatatableAdvanced.listProducts.push(t.data.product.ID),renderRowItem(t.data.product),BX.onCustomEvent("B2BNotification",[BX.message("SOTBIT_POSITION_NAME_ADD_NOTIFICATION")+t.data.product.NAME+"<br>"+BX.message("SOTBIT_POSITION_ADD_NOTIFICATION"),"success"])));else if("addPositions"===t.eventId&&t.data.productIds){let a=[];t.data.productIds.forEach((e=>{BX.util.in_array(e,DatatableAdvanced.listProducts)||(DatatableAdvanced.listProducts.push(e),a.push(t.data.allProducts[e]))})),a.length?(renderRowsItem(a),BX.onCustomEvent("B2BNotification",[BX.message("SOTBIT_POSITION_ADD_PRODUCTS")+a.length+BX.message("SOTBIT_POSITION_ADD_PRODUCTS_NOTIFICATION"),"success"])):BX.onCustomEvent("B2BNotification",[BX.message("SOTBIT_POSITION_ALL_ADD"),"false"])}})),$("#complaint-positions__grid tbody").on("click",".delete-position",(function(){const t=$(this).siblings().attr("value");$("#complaint-positions__grid").DataTable().row($(this).parents("tr")).remove().draw(),BX.onCustomEvent("B2BNotification",[BX.message("SOTBIT_COMPLAINTS_POSITION_NAME_NOT")+$(this).attr("data-name")+"<br>"+BX.message("SOTBIT_COMPLAINTS_POSITION_NOT"),"success"]),DatatableAdvanced.listProducts=DatatableAdvanced.listProducts.filter((a=>a!==t)),i()})),$("#complaint-positions__grid thead").on("click",".delete-all-position",(function(){DatatableAdvanced.listProducts=[],$("#complaint-positions__grid").DataTable().rows().remove().draw(),BX.onCustomEvent("B2BNotification",[BX.message("SOTBIT_COMPLAINTS_POSITIONS_ALL_NOT"),"success"]),i()})),$().TouchSpin}));