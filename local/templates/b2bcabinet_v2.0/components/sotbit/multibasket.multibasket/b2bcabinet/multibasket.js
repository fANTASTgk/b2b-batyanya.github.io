/*! For license information please see multibasket.js.LICENSE.txt */
!function(){"use strict";function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(e)}function e(){e=function(){return o};var o={},i=Object.prototype,s=i.hasOwnProperty,n=Object.defineProperty||function(t,e,o){t[e]=o.value},a="function"==typeof Symbol?Symbol:{},r=a.iterator||"@@iterator",d=a.asyncIterator||"@@asyncIterator",c=a.toStringTag||"@@toStringTag";function l(t,e,o){return Object.defineProperty(t,e,{value:o,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{l({},"")}catch(t){l=function(t,e,o){return t[e]=o}}function h(t,e,o,i){var s=e&&e.prototype instanceof p?e:p,a=Object.create(s.prototype),r=new S(i||[]);return n(a,"_invoke",{value:b(t,o,r)}),a}function u(t,e,o){try{return{type:"normal",arg:t.call(e,o)}}catch(t){return{type:"throw",arg:t}}}o.wrap=h;var m={};function p(){}function f(){}function E(){}var N={};l(N,r,(function(){return this}));var T=Object.getPrototypeOf,y=T&&T(T(I([])));y&&y!==i&&s.call(y,r)&&(N=y);var k=E.prototype=p.prototype=Object.create(N);function v(t){["next","throw","return"].forEach((function(e){l(t,e,(function(t){return this._invoke(e,t)}))}))}function B(e,o){function i(n,a,r,d){var c=u(e[n],e,a);if("throw"!==c.type){var l=c.arg,h=l.value;return h&&"object"==t(h)&&s.call(h,"__await")?o.resolve(h.__await).then((function(t){i("next",t,r,d)}),(function(t){i("throw",t,r,d)})):o.resolve(h).then((function(t){l.value=t,r(l)}),(function(t){return i("throw",t,r,d)}))}d(c.arg)}var a;n(this,"_invoke",{value:function(t,e){function s(){return new o((function(o,s){i(t,e,o,s)}))}return a=a?a.then(s,s):s()}})}function b(t,e,o){var i="suspendedStart";return function(s,n){if("executing"===i)throw new Error("Generator is already running");if("completed"===i){if("throw"===s)throw n;return{value:void 0,done:!0}}for(o.method=s,o.arg=n;;){var a=o.delegate;if(a){var r=_(a,o);if(r){if(r===m)continue;return r}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if("suspendedStart"===i)throw i="completed",o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);i="executing";var d=u(t,e,o);if("normal"===d.type){if(i=o.done?"completed":"suspendedYield",d.arg===m)continue;return{value:d.arg,done:o.done}}"throw"===d.type&&(i="completed",o.method="throw",o.arg=d.arg)}}}function _(t,e){var o=e.method,i=t.iterator[o];if(void 0===i)return e.delegate=null,"throw"===o&&t.iterator.return&&(e.method="return",e.arg=void 0,_(t,e),"throw"===e.method)||"return"!==o&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+o+"' method")),m;var s=u(i,t.iterator,e.arg);if("throw"===s.type)return e.method="throw",e.arg=s.arg,e.delegate=null,m;var n=s.arg;return n?n.done?(e[t.resultName]=n.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,m):n:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,m)}function g(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function C(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function S(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(g,this),this.reset(!0)}function I(t){if(t){var e=t[r];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,i=function e(){for(;++o<t.length;)if(s.call(t,o))return e.value=t[o],e.done=!1,e;return e.value=void 0,e.done=!0,e};return i.next=i}}return{next:A}}function A(){return{value:void 0,done:!0}}return f.prototype=E,n(k,"constructor",{value:E,configurable:!0}),n(E,"constructor",{value:f,configurable:!0}),f.displayName=l(E,c,"GeneratorFunction"),o.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===f||"GeneratorFunction"===(e.displayName||e.name))},o.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,E):(t.__proto__=E,l(t,c,"GeneratorFunction")),t.prototype=Object.create(k),t},o.awrap=function(t){return{__await:t}},v(B.prototype),l(B.prototype,d,(function(){return this})),o.AsyncIterator=B,o.async=function(t,e,i,s,n){void 0===n&&(n=Promise);var a=new B(h(t,e,i,s),n);return o.isGeneratorFunction(e)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},v(k),l(k,c,"Generator"),l(k,r,(function(){return this})),l(k,"toString",(function(){return"[object Generator]"})),o.keys=function(t){var e=Object(t),o=[];for(var i in e)o.push(i);return o.reverse(),function t(){for(;o.length;){var i=o.pop();if(i in e)return t.value=i,t.done=!1,t}return t.done=!0,t}},o.values=I,S.prototype={constructor:S,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(C),!t)for(var e in this)"t"===e.charAt(0)&&s.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function o(o,i){return a.type="throw",a.arg=t,e.next=o,i&&(e.method="next",e.arg=void 0),!!i}for(var i=this.tryEntries.length-1;i>=0;--i){var n=this.tryEntries[i],a=n.completion;if("root"===n.tryLoc)return o("end");if(n.tryLoc<=this.prev){var r=s.call(n,"catchLoc"),d=s.call(n,"finallyLoc");if(r&&d){if(this.prev<n.catchLoc)return o(n.catchLoc,!0);if(this.prev<n.finallyLoc)return o(n.finallyLoc)}else if(r){if(this.prev<n.catchLoc)return o(n.catchLoc,!0)}else{if(!d)throw new Error("try statement without catch or finally");if(this.prev<n.finallyLoc)return o(n.finallyLoc)}}}},abrupt:function(t,e){for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o];if(i.tryLoc<=this.prev&&s.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var n=i;break}}n&&("break"===t||"continue"===t)&&n.tryLoc<=e&&e<=n.finallyLoc&&(n=null);var a=n?n.completion:{};return a.type=t,a.arg=e,n?(this.method="next",this.next=n.finallyLoc,m):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),m},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var o=this.tryEntries[e];if(o.finallyLoc===t)return this.complete(o.completion,o.afterLoc),C(o),m}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var o=this.tryEntries[e];if(o.tryLoc===t){var i=o.completion;if("throw"===i.type){var s=i.arg;C(o)}return s}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,o){return this.delegate={iterator:I(t),resultName:e,nextLoc:o},"next"===this.method&&(this.arg=void 0),m}},o}function o(t,e,o,i,s,n,a){try{var r=t[n](a),d=r.value}catch(t){return void o(t)}r.done?e(d):Promise.resolve(d).then(i,s)}function i(t){return function(){var e=this,i=arguments;return new Promise((function(s,n){var a=t.apply(e,i);function r(t){o(a,s,n,r,d,"next",t)}function d(t){o(a,s,n,r,d,"throw",t)}r(void 0)}))}}function s(t,e){for(var o=0;o<e.length;o++){var i=e[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,a(i.key),i)}}function n(t,e,o){return(e=a(e))in t?Object.defineProperty(t,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[e]=o,t}function a(e){var o=function(e,o){if("object"!==t(e)||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var s=i.call(e,"string");if("object"!==t(s))return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===t(o)?o:String(o)}var r=function(){function t(o){var s=this,a=o.result,r=o.params;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),n(this,"componentWraperId","sotbit_multibasket_components"),n(this,"dataEntity",{multibasketCurrent:"multibasket__current",currentName:"current_name",currentColor:"current_color",currentQuantity:"current_quantity",currentArrow:"current_arrow",basketsList:"baskets_list",basketItem:"basket_item",basketAdd:"basket_add",otherColor:"other_color",otherRemove:"other_remove",otherEdit:"other_edit",otherBasketWraper:"otherbasket_wraper",showOtherBusket:"show_other_busket",modalWindow:"modal-window",modalTitle:"modal__title",modalButtonOk:"modal-button-ok",modalButtonClose:"modal-button-close",modalButtonCloseTop:"modal-button-close-top",modalColorItemChecbox:"color-item-checbox",modalColorsItems:"colors-items",colorItemSelected:"color-item-selected",otherName:"other_name",basketTotalPrice:"basket-total-price",productsHeader:"products-header",productItem:"product-item",productItemsList:"product-items-list",poroductPhoto:"poroduct_photo",productName:"product-name",productPrice:"product-price",productTotalPrice:"product-total-price",btnToOrderPage:"btn-to-order-page",btnDeleteProduct:"btn-delete-product",btnShowList:"btn_show_list",multibasketNotification:"multibasket__notification",multibasketNotificationWrapper:"multibasket__notification_wrapper",newBasketName:"new_basket_name",toolTip:"tool-tip"}),n(this,"curentSeletedColor",null),n(this,"notification",{}),n(this,"selectedBasketId",null),n(this,"root",void 0),n(this,"domNods",void 0),this.params=r,this.toolTipTimer=null,this.basketNeedsHidden()||(this.baskets=a.BASKETS,this.currentBasket=a.CURRENT_BASKET,this.notification=a.BASKET_CHANGE_NOTIFICATIONS,this.getDomElements(),this.installEventHandlers(),BX.addCustomEvent(window,"OnBasketChange",i(e().mark((function t(){return e().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,s.sendRequest("GET",{});case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})))),this.additionsBasketListRoot=null,this.basketSelectedAitems=[])}var o,a,r,d,c,l,h,u;return o=t,a=[{key:"setAdditionsBasketListRoot",value:function(t){this.additionsBasketListRoot=t}},{key:"setSelectedProductsInBasket",value:function(t){this.basketSelectedAitems=t}},{key:"getEntity",value:function(t,e){return t&&e?arguments.length>2&&void 0!==arguments[2]&&arguments[2]?t.querySelectorAll('[data-entity="'+e+'"]'):t.querySelector('[data-entity="'+e+'"]'):null}},{key:"getDomElements",value:function(){var t;this.root=document.getElementById(this.componentWraperId),this.domNods=(n(t={multibasketCurrent:this.getEntity(this.root,this.dataEntity.multibasketCurrent),currentColor:this.getEntity(this.root,this.dataEntity.currentColor,!0),currentName:this.getEntity(this.root,this.dataEntity.currentName),currentArrow:this.getEntity(this.root,this.dataEntity.currentArrow),otherBasketWraper:this.getEntity(this.root,this.dataEntity.otherBasketWraper)},"currentArrow",this.getEntity(this.root,this.dataEntity.currentArrow)),n(t,"multibasketNotification",this.getEntity(this.root,this.dataEntity.multibasketNotification)),n(t,"toolTip",this.getEntity(this.root,this.dataEntity.toolTip)),t),this.domNods.multibasketNotificationWrapper=this.getEntity(this.root,this.dataEntity.multibasketNotificationWrapper),this.domNods.multibasketNotificationWrapper||(this.domNods.multibasketNotificationWrapper=this.domNods.multibasketNotification),"Y"===this.params.POSITION_FIXED&&"Y"===this.params.SHOW_PRODUCTS&&(this.domNods.btnShowList=this.getEntity(this.root,this.dataEntity.btnShowList),this.domNods.btnShowList.innerText=BX.message.SOTBIT_BULTIBASKET_CLOSE_FIXET_LIST),"Y"===this.params.SHOW_PRODUCTS&&(this.domNods.productsHeader=this.getEntity(this.root,this.dataEntity.productsHeader),this.domNods.productItem=this.getEntity(this.root,this.dataEntity.productItem),this.domNods.productItemsList=this.getEntity(this.root,this.dataEntity.productItemsList),this.domNods.btnToOrderPage=this.getEntity(this.root,this.dataEntity.btnToOrderPage)),"Y"!==this.params.SHOW_NUM_PRODUCTS||this.basketNeedsHidden()||(this.domNods.currentQuantity=this.getEntity(this.root,this.dataEntity.currentQuantity),this.domNods.currentQuantity.style="display: block;"),"Y"===this.params.SHOW_TOTAL_PRICE&&(this.domNods.basketTotalPrice=this.getEntity(this.root,this.dataEntity.basketTotalPrice)),this.domNods.basketsList=this.getEntity(this.domNods.otherBasketWraper,this.dataEntity.basketsList),this.domNods.basketItem=this.getEntity(this.domNods.basketsList,this.dataEntity.basketItem),this.domNods.basketAdd=this.getEntity(this.domNods.otherBasketWraper,this.dataEntity.basketAdd),this.domNods.modalWindow=this.getEntity(this.root,this.dataEntity.modalWindow),this.domNods.modalName=this.getEntity(this.domNods.modalWindow,this.dataEntity.modalName),this.domNods.modalButtonOk=this.getEntity(this.domNods.modalWindow,this.dataEntity.modalButtonOk),this.domNods.modalButtonClose=this.getEntity(this.domNods.modalWindow,this.dataEntity.modalButtonClose),this.domNods.modalButtonCloseTop=this.getEntity(this.domNods.modalWindow,this.dataEntity.modalButtonCloseTop),this.domNods.modalColorItemChecbox=this.getEntity(this.domNods.modalWindow,this.dataEntity.modalColorItemChecbox),this.domNods.modalColorsItems=this.getEntity(this.domNods.modalWindow,this.dataEntity.modalColorsItems),this.domNods.colorItemSelected=this.getEntity(this.domNods.modalWindow,this.dataEntity.colorItemSelected),this.domNods.newBasketName=this.getEntity(this.domNods.modalWindow,this.dataEntity.newBasketName),this.domNods.newBasketName.setAttribute("maxlength",20)}},{key:"installEventHandlers",value:function(){var t=this;this.domNods.currentArrow.addEventListener("click",(function(e){e.preventDefault(),t.showOtherBasketEvent(e)})),this.domNods.multibasketCurrent.addEventListener("mouseover",this.showOtherBasketEvent.bind(this)),this.domNods.multibasketCurrent.addEventListener("mouseout",this.showOtherBasketEvent.bind(this)),this.domNods.otherBasketWraper.addEventListener("mouseover",this.showOtherBasketEvent.bind(this)),this.domNods.otherBasketWraper.addEventListener("mouseout",this.showOtherBasketEvent.bind(this)),this.domNods.basketAdd.addEventListener("click",this.showModalButtonEvent.bind(this)),this.domNods.basketAdd.addEventListener("mouseover",this.hideBasketToolTip.bind(this)),this.domNods.modalButtonClose.addEventListener("click",this.modalButtonCloseEvent.bind(this)),this.domNods.modalButtonCloseTop.addEventListener("click",this.modalButtonCloseEvent.bind(this)),this.domNods.modalWindow.addEventListener("click",this.modalButtonCloseFonEvent.bind(this)),this.domNods.modalButtonOk.addEventListener("click",this.modalButtonOkEvent.bind(this)),this.domNods.multibasketNotificationWrapper.addEventListener("click",this.closeNotifications.bind(this)),void 0!==this.domNods.btnShowList&&this.domNods.btnShowList.addEventListener("click",(function(){"none"===t.domNods.productItemsList.style.display?(t.domNods.btnShowList.innerText=BX.message.SOTBIT_BULTIBASKET_CLOSE_FIXET_LIST,t.domNods.productItemsList.style="display: block;",void 0!==t.domNods.productsHeader&&t.currentBasket.ITEMS_QUANTITY>0&&(t.domNods.productsHeader.style="display: block;")):(t.domNods.btnShowList.innerText=BX.message.SOTBIT_BULTIBASKET_SHOW_FIXET_LIST,t.domNods.productItemsList.style="display: none;",void 0!==t.domNods.productsHeader&&(t.domNods.productsHeader.style="display: none;"))})),Array.prototype.slice.call(this.domNods.modalColorsItems.childNodes).forEach((function(e){e instanceof HTMLDivElement&&e.addEventListener("click",t.colorChekBoxEvent.bind(t))}))}},{key:"render",value:function(){this.basketNeedsHidden()||(this.renderProducts(),this.renderTotalPrice(),this.renderBaskets(),this.renderAdditionsBasketList(),"Y"===this.params.POSITION_FIXED&&(this.setBasketListPosition(),this.setFixedBasketHeight(),this.calculateTopMarginByFixedBasket()),this.basketChangeNotifications())}},{key:"colorChekBoxEvent",value:function(t){if(t.currentTarget.classList.contains("modal__active")){this.removeColorCheckBoxMarker();var e=this.domNods.modalColorItemChecbox.cloneNode(!0);e.style="display: flex;",t.currentTarget.appendChild(e),this.curentSeletedColor=t.currentTarget.getAttribute("style").slice(-7,-1)}}},{key:"removeColorCheckBoxMarker",value:function(){var t=this;Array.prototype.slice.call(this.domNods.modalColorsItems.childNodes).forEach((function(e){if(e instanceof HTMLDivElement){var o=t.getEntity(e,t.dataEntity.modalColorItemChecbox);o instanceof HTMLDivElement&&o.remove()}}))}},{key:"setColorCheckBoxSelectedMarker",value:function(t,e){var o=this,i=this.baskets.map((function(t){return t.COLOR})),s="modal__active",n=this.domNods.colorItemSelected;this.curentSeletedColor=e,Array.prototype.slice.call(this.domNods.modalColorsItems.childNodes).forEach((function(a){if(a instanceof HTMLDivElement&&"set"===t){if(a.getAttribute("style").slice(-7,-1)===e){var r=o.domNods.modalColorItemChecbox.cloneNode(!0);return r.style="display: flex;",void a.appendChild(r)}if(i.includes(a.getAttribute("style").slice(-7,-1))){a.classList.remove(s);var d=n.cloneNode(!0);d.style="display: block;",a.append(d)}}else a instanceof HTMLDivElement&&"unset"===t&&(a.classList.contains(s)||(a.classList.add(s),Array.prototype.slice.call(a.childNodes).forEach((function(t){return t.remove()}))))}))}},{key:"showOtherBasketEvent",value:function(t){var e="multibasket__current-arrow__show",o="otherbasket_wraper_active";"mouseover"===t.type?(this.domNods.currentArrow.classList.add(e),this.domNods.otherBasketWraper.classList.add(o)):"mouseout"===t.type&&(this.domNods.otherBasketWraper.classList.remove(o),this.domNods.currentArrow.classList.remove(e))}},{key:"recalculateBasket",value:function(){var t=this.getCurrentPage(),e=t===this.params.BASKET_PAGE_URL||t===this.params.BASKET_PAGE_URL+"index.php";("Y"!==this.params.ONLY_BASKET_PAGE_RECALCULATE||e)&&("EVENT"!==this.params.RECALCULATE_BASKET&&window.location.reload(),BX.onCustomEvent(window,"sotbitMultibasketSwitch",this.baskets))}},{key:"getCurrentPage",value:function(){return window.location.pathname}},{key:"showModalButtonEvent",value:function(t,e,o,i){this.selectedBasketId=o,this.setColorCheckBoxSelectedMarker("set",e),this.domNods.newBasketName.value=i||BX.message.SOTBIT_BULTIBASKET_NEW_BASKET,this.getEntity(this.domNods.modalWindow,this.dataEntity.colorItemSelected,!0).length===Array.prototype.slice.call(this.domNods.modalColorsItems.childNodes).filter((function(t){return t instanceof HTMLDivElement})).length+1?(this.domNods.modalWindow.querySelector(".modal__title").innerText=BX.message.SOTBIT_BULTIBASKET_REMOVE_NOT_USE_BASKET,this.domNods.newBasketName.setAttribute("disabled",!0)):o?(this.domNods.modalWindow.querySelector(".modal__title").innerText=BX.message.SOTBIT_BULTIBASKET_UPDATE_BASKET,this.domNods.newBasketName.removeAttribute("disabled")):(this.domNods.modalWindow.querySelector(".modal__title").innerText=BX.message.SOTBIT_BULTIBASKET_CREATE_NEW_BASKET,this.domNods.newBasketName.removeAttribute("disabled")),this.getEntity(this.domNods.modalWindow,this.dataEntity.modalTitle),this.domNods.modalWindow.classList.add("multibasket__modal__active")}},{key:"modalButtonCloseEvent",value:function(){this.domNods.modalWindow.classList.remove("multibasket__modal__active"),this.removeColorCheckBoxMarker(),this.setColorCheckBoxSelectedMarker("unset")}},{key:"modalButtonCloseFonEvent",value:function(t){t.target.querySelector(".multibasket__edit-form")&&(this.domNods.modalWindow.classList.remove("multibasket__modal__active"),this.removeColorCheckBoxMarker(),this.setColorCheckBoxSelectedMarker("unset"))}},{key:"removeBasketEvent",value:(u=i(e().mark((function t(o){return e().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.sendRequest("DELETE",{ID:o});case 2:case"end":return t.stop()}}),t,this)}))),function(t){return u.apply(this,arguments)})},{key:"setCurrentBasketEvent",value:(h=i(e().mark((function t(o){return e().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.sendRequest("UPDATE",{ID:o,CURRENT_BASKET:!0});case 2:this.recalculateBasket();case 3:case"end":return t.stop()}}),t,this)}))),function(t){return h.apply(this,arguments)})},{key:"modalButtonOkEvent",value:(l=i(e().mark((function t(){var o,i,s=this;return e().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.curentSeletedColor){t.next=2;break}return t.abrupt("return",alert(BX.message.SOTBIT_BULTIBASKET_YOU_NEED_TO_CHOOSE_A_COLOR_FIRST));case 2:if(""!==this.domNods.newBasketName.value.trim()){t.next=4;break}return t.abrupt("return",alert(BX.message.SOTBIT_BULTIBASKET_YOU_NEED_TO_CHOOSE_A_NAME_FIRST));case 4:return o=this.selectedBasketId?"UPDATE":"CREATE",t.next=7,this.sendRequest(o,{ID:this.selectedBasketId,COLOR:this.curentSeletedColor,NAME:encodeURI(this.domNods.newBasketName.value)});case 7:if("CREATE"!==o){t.next=12;break}return i=function(){for(var t in s.baskets)if(s.baskets[t].COLOR===s.curentSeletedColor)return s.baskets[t].ID}(),this.createNewBasketNotification(this.curentSeletedColor,'"'.concat(this.domNods.newBasketName.value,'"')),t.next=12,this.setCurrentBasketEvent(i);case 12:this.domNods.modalWindow.classList.remove("multibasket__modal__active"),this.selectedBasketId=null,this.curentSeletedColor=null,this.removeColorCheckBoxMarker(),this.setColorCheckBoxSelectedMarker("unset");case 18:case"end":return t.stop()}}),t,this)}))),function(){return l.apply(this,arguments)})},{key:"sendRequest",value:(c=i(e().mark((function t(o,i,s){var n,a,r;return e().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,BX.ajax.runAction("sotbit:multibasket.MultibasketController.any",{data:{action:o,requestData:JSON.stringify(i),viewParam:JSON.stringify({SHOW_TOTAL_PRICE:"Y"===this.params.SHOW_TOTAL_PRICE,SHOW_SUMMARY:"Y"===this.params.SHOW_SUMMARY,SHOW_IMAGE:"Y"===this.params.SHOW_IMAGE,SHOW_PRICE:"Y"===this.params.SHOW_PRICE,SHOW_PRODUCTS:"Y"===this.params.SHOW_PRODUCTS}),addionalsParams:JSON.stringify(s)}});case 3:r=t.sent,this.baskets=null!==(n=r.data.BASKETS)&&void 0!==n?n:this.baskets,this.currentBasket=null!==(a=r.data.CURRENT_BASKET)&&void 0!==a?a:this.currentBasket,this.notification=r.data.BASKET_CHANGE_NOTIFICATIONS?r.data.BASKET_CHANGE_NOTIFICATIONS:{},this.render(),t.next=13;break;case 10:t.prev=10,t.t0=t.catch(0),console.log(t.t0);case 13:case"end":return t.stop()}}),t,this,[[0,10]])}))),function(t,e,o){return c.apply(this,arguments)})},{key:"sendBasketItemRequest",value:(d=i(e().mark((function t(o,i){return e().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,BX.showWait(),t.next=4,BX.ajax.runAction("sotbit:multibasket.BasketItemController.any",{data:{action:o,basketItemId:i}});case 4:"success"===t.sent.status&&BX.onCustomEvent(window,"OnBasketChange",[]),BX.closeWait(),t.next=12;break;case 9:t.prev=9,t.t0=t.catch(0),console.log(t.t0);case 12:case"end":return t.stop()}}),t,null,[[0,9]])}))),function(t,e){return d.apply(this,arguments)})},{key:"setBasketListPosition",value:function(){"Y"===this.params.POSITION_FIXED&&(this.domNods.otherBasketWraper.style="position: relative;")}},{key:"setFixedBasketHeight",value:function(){if("Y"===this.params.SHOW_PRODUCTS){var t="multibasket__products_height";this.domNods.productItemsList.classList.remove(t);var e=document.documentElement.clientHeight;this.domNods.productItemsList.clientHeight>.65*e?this.domNods.productItemsList.classList.add(t):this.domNods.productItemsList.classList.remove(t)}}},{key:"basketNeedsHidden",value:function(){if("Y"===this.params.HIDE_ON_BASKET_PAGES){var t=this.getCurrentPage();if(t===this.params.BASKET_PAGE_URL||t===this.params.PATH_TO_ORDER)return!0}return!1}},{key:"renderProducts",value:function(){var t=this;void 0!==this.domNods.productItem&&void 0!==this.domNods.productItemsList&&(Array.prototype.slice.call(this.domNods.productItemsList.childNodes).forEach((function(t){return t.remove()})),this.currentBasket.ITEMS.forEach((function(e){var o=t.domNods.productItem.cloneNode(!0);"Y"===t.params.SHOW_IMAGE&&(t.getEntity(o,t.dataEntity.poroductPhoto).src=e.PICTURE);var i=t.getEntity(o,t.dataEntity.productName);if(i.href=e.DETAIL_PAGE_URL,i.innerHTML=e.NAME,"Y"===t.params.SHOW_PRICE){var s=t.getEntity(o,t.dataEntity.productPrice),n="<strong>".concat(e.PRICE,"</strong>"),a="<strong>".concat(e.CURRENCY," </strong>"),r="<span>".concat(e.BASE_PRICE,"</span>"),d="<span>".concat(e.CURRENCY,"</span>");s.innerHTML=n+a+r+d}if("Y"===t.params.SHOW_SUMMARY){var c=t.getEntity(o,t.dataEntity.productTotalPrice),l="<strong>".concat(e.QUANTITY," </strong>"),h="<span>".concat(e.MEASURE_NAME," </span>"),u="<span>".concat(BX.message.SOTBIT_BULTIBASKET_TOTAL_PRICE," </span>"),m="<strong>".concat(e.FINAL_PRICE,"</strong>"),p="<strong>".concat(e.CURRENCY," </strong>");c.innerHTML=l+h+u+m+p}t.getEntity(o,t.dataEntity.btnDeleteProduct).addEventListener("click",(function(){return t.sendBasketItemRequest("DELETE",e.BASKET_ID)})),t.domNods.productItemsList.appendChild(o)}))),void 0!==this.domNods.productsHeader&&void 0!==this.domNods.productItemsList&&(this.currentBasket.ITEMS_QUANTITY>0?(this.domNods.productItemsList.style="display: block;",this.domNods.productsHeader.style="display: block;",this.domNods.btnToOrderPage.style="display: block;"):(this.domNods.productsHeader.style="display: none;",this.domNods.productItemsList.style="display: none;",this.domNods.btnToOrderPage.style="display: none;"))}},{key:"renderTotalPrice",value:function(){if(void 0!==this.domNods.basketTotalPrice)if(this.currentBasket.ITEMS_QUANTITY>0){this.domNods.basketTotalPrice.style="display: block;";var t="<span>".concat(BX.message.SOTBIT_BULTIBASKET_TOTAL_PRICE," </span>"),e="<strong>".concat(this.currentBasket.TOTAL_PRICE,"</strong>");this.domNods.basketTotalPrice.innerHTML=t+e}else this.domNods.basketTotalPrice.style="display: none;"}},{key:"renderBaskets",value:function(){var t=this,e=this.baskets.filter((function(t){return t.CURRENT_BASKET}))[0];Array.prototype.slice.call(this.domNods.currentColor).forEach((function(t){return t.style="background-color: #".concat(e.COLOR,";")})),this.domNods.currentName.innerText=e.MAIN?e.NAME?e.NAME:BX.message.SOTBIT_BULTIBASKET_MAIN_BASKET:e.NAME?e.NAME:BX.message.SOTBIT_BULTIBASKET_OHER_BASKET,void 0!==this.domNods.currentQuantity&&(this.domNods.currentQuantity.innerText=this.currentBasket.ITEMS_QUANTITY);var o=this.getBaksetList();Array.prototype.slice.call(this.domNods.basketsList.childNodes).forEach((function(t){return t.remove()})),o.forEach((function(e){return t.domNods.basketsList.appendChild(e)})),Array.prototype.slice.call(this.domNods.modalColorsItems.childNodes).forEach((function(e){e instanceof HTMLDivElement&&e.addEventListener("click",t.colorChekBoxEvent.bind(t))}))}},{key:"renderAdditionsBasketList",value:function(){var t=this;if(this.additionsBasketListRoot){var e=this.getAdditonalBasketList(this.moveItemsToBusket.bind(this));Array.prototype.slice.call(this.additionsBasketListRoot.childNodes).forEach((function(t){return t.remove()})),e.forEach((function(e){return t.additionsBasketListRoot.appendChild(e)}))}}},{key:"getBaksetList",value:function(){var t=this;return this.baskets.filter((function(t){return!Boolean(t.CURRENT_BASKET)})).map((function(e){var o=t.domNods.basketItem.cloneNode(!0);return o.addEventListener("click",(function(o){t.dataEntity.basketItem===o.currentTarget.dataset.entity&&t.setCurrentBasketEvent(e.ID)})),t.getEntity(o,t.dataEntity.otherColor).style="background-color: #".concat(e.COLOR,";"),t.getEntity(o,t.dataEntity.otherName).innerText=e.MAIN?e.NAME?e.NAME:BX.message.SOTBIT_BULTIBASKET_MAIN_BASKET:e.NAME?e.NAME:BX.message.SOTBIT_BULTIBASKET_OHER_BASKET,e.MAIN?(t.getEntity(o,t.dataEntity.otherRemove).remove(),t.getEntity(o,t.dataEntity.otherEdit).remove()):(t.getEntity(o,t.dataEntity.otherRemove).addEventListener("click",function(o){o.stopPropagation(),t.removeBasketEvent(e.ID)}.bind(t)),t.getEntity(o,t.dataEntity.otherEdit).addEventListener("click",(function(o){o.stopPropagation(),t.showModalButtonEvent(o,e.COLOR,e.ID,e.NAME)}))),o.addEventListener("mouseover",t.showBasketToolTip.bind(t)),o.addEventListener("mouseout",t.hideBasketToolTip.bind(t)),o}))}},{key:"getAdditonalBasketList",value:function(){var t=this;return this.baskets.filter((function(t){return!Boolean(t.CURRENT_BASKET)})).map((function(e){var o=t.domNods.basketItem.cloneNode(!0);return o.addEventListener("click",(function(o){t.dataEntity.basketItem===o.currentTarget.dataset.entity&&t.moveItemsToBusket(e.ID)})),t.getEntity(o,t.dataEntity.otherColor).style="background-color: #".concat(e.COLOR,";"),t.getEntity(o,t.dataEntity.otherName).innerText=e.MAIN?e.NAME?e.NAME:BX.message.SOTBIT_BULTIBASKET_MAIN_BASKET:e.NAME?e.NAME:BX.message.SOTBIT_BULTIBASKET_OHER_BASKET,t.getEntity(o,t.dataEntity.otherRemove).remove(),t.getEntity(o,t.dataEntity.otherEdit).remove(),o.addEventListener("mouseover",t.showBasketToolTip.bind(t)),o.addEventListener("mouseout",t.hideBasketToolTip.bind(t)),o}))}},{key:"calculateTopMarginByFixedBasket",value:function(){"vcenter"===this.params.POSITION_VERTICAL&&(this.root.style="margin-top: -".concat(Math.round(this.root.offsetHeight/2),"px"))}},{key:"basketChangeNotifications",value:function(){var t=this;if(this.notification.order&&this.notification.order.fromColor){var e=this.createNotificationText(BX.message.SOTBIT_BULTIBASKET_ORDER_PROCESSED),o=this.createNotificationBasketColor(this.notification.order.fromColor),i=this.createNotificationText('"'.concat(this.notification.order.fromName,'"'),"white-space: nowrap;"),s=this.createNotificationText(BX.message.SOTBIT_BULTIBASKET_BASKET_REMOVED);this.domNods.multibasketNotification.appendChild(e),this.domNods.multibasketNotification.appendChild(o),this.domNods.multibasketNotification.appendChild(i),this.domNods.multibasketNotification.appendChild(s)}if(this.notification.order&&this.notification.order.toColor){var n=document.createElement("br"),a=this.createNotificationText(BX.message.SOTBIT_BULTIBASKET_OHER_BASKET),r=this.createNotificationBasketColor(this.notification.order.toColor),d=this.createNotificationText(BX.message.SOTBIT_BULTIBASKET_NEW_MAIN),c=this.createNotificationText('"'.concat(this.notification.order.toName,'"'),"white-space: nowrap;");this.domNods.multibasketNotification.appendChild(n),this.domNods.multibasketNotification.appendChild(a),this.domNods.multibasketNotification.appendChild(r),this.domNods.multibasketNotification.appendChild(c),this.domNods.multibasketNotification.appendChild(d)}if(this.notification.united&&this.notification.united.fromColor&&this.notification.united.toColor){var l=this.createNotificationText(BX.message.SOTBIT_BULTIBASKET_ITEMS_BASKTET_FROM),h=this.createNotificationBasketColor(this.notification.united.fromColor),u=this.createNotificationText('"'.concat(this.notification.united.fromName,'"'),"white-space: nowrap;"),m=document.createElement("br"),p=thi.createNotificationText(BX.message.SOTBIT_BULTIBASKET_ITEMS_BASKTET_TO),f=this.createNotificationBasketColor(this.notification.united.toColor),E=this.createNotificationText('"'.concat(this.notification.united.toName,'"'),"white-space: nowrap;");this.domNods.multibasketNotification.appendChild(l),this.domNods.multibasketNotification.appendChild(h),this.domNods.multibasketNotification.appendChild(u),this.domNods.multibasketNotification.appendChild(m.cloneNode(!0)),this.domNods.multibasketNotification.appendChild(p),this.domNods.multibasketNotification.appendChild(f),this.domNods.multibasketNotification.appendChild(E),this.domNods.multibasketNotification.appendChild(m)}if(this.notification.changeColor&&this.notification.changeColor.length>0&&this.notification.changeColor.forEach((function(e){var o=t.createNotificationText(BX.message.SOTBIT_BULTIBASKET_BASKET_ADD),i=t.createNotificationBasketColor(t.notification.united.fromColor),s=t.createNotificationText('"'.concat(t.notification.united.fromName,'"'),"white-space: nowrap;"),n=t.createNotificationText(BX.message.SOTBIT_BULTIBASKET_COLOR_CHANGE),a=t.createNotificationBasketColor(t.notification.united.toColor),r=t.createNotificationText('"'.concat(t.notification.united.toName,'"'),"white-space: nowrap;"),d=document.createElement("br");t.domNods.multibasketNotification.appendChild(o),t.domNods.multibasketNotification.appendChild(i),t.domNods.multibasketNotification.appendChild(s),t.domNods.multibasketNotification.appendChild(n),t.domNods.multibasketNotification.appendChild(a),t.domNods.multibasketNotification.appendChild(r),t.domNods.multibasketNotification.appendChild(d)})),this.notification.moveProductToBasket&&this.notification.moveProductToBasket.toBasketColor&&Array.isArray(this.notification.moveProductToBasket.productsName)){var N=this.createNotificationText(BX.message.SOTBIT_BULTIBASKET_ITEMS_NAMES),T=this.createNotificationText("".concat(this.notification.moveProductToBasket.productsName[0]," "));if(this.domNods.multibasketNotification.appendChild(N),this.domNods.multibasketNotification.appendChild(T),this.notification.moveProductToBasket.productsName.length>1){var y=this.createNotificationText(BX.message.SOTBIT_BULTIBASKET_AND_OTHER);this.domNods.multibasketNotification.appendChild(y)}var k=document.createElement("br"),v=this.createNotificationText(BX.message.SOTBIT_BULTIBASKET_ITEMS_MOVE),B=this.createNotificationBasketColor(this.notification.moveProductToBasket.toBasketColor),b=this.createNotificationText('"'.concat(this.notification.moveProductToBasket.toBasketName,'"'),"white-space: nowrap;");this.domNods.multibasketNotification.appendChild(k),this.domNods.multibasketNotification.appendChild(v),this.domNods.multibasketNotification.appendChild(B),this.domNods.multibasketNotification.appendChild(b)}this.domNods.multibasketNotification.childNodes.length>0&&this.renderNotification()}},{key:"renderNotification",value:function(){var t=this,e="notification__show";this.domNods.multibasketNotificationWrapper.removeAttribute("style"),this.domNods.multibasketNotificationWrapper.classList.add(e),setTimeout((function(){t.domNods.multibasketNotificationWrapper.classList.remove(e),setTimeout((function(){t.domNods.multibasketNotificationWrapper.setAttribute("style","display: none;"),Array.prototype.slice.call(t.domNods.multibasketNotification.childNodes).forEach((function(t){return t.remove()}))}),1e3)}),5e3)}},{key:"closeNotifications",value:function(){var t=this;this.domNods.multibasketNotificationWrapper.classList.remove("notification__show"),setTimeout((function(){t.domNods.multibasketNotificationWrapper.setAttribute("style","display: none;"),Array.prototype.slice.call(t.domNods.multibasketNotification.childNodes).forEach((function(t){return t.remove()}))}),1e3)}},{key:"getTextMaxWidth",value:function(){return this.root.offsetWidth-65}},{key:"showBasketToolTip",value:function(t){clearTimeout(this.toolTipTimer);var e=t.currentTarget,o=t.clientX,i=t.clientY;this.toolTipTimer=setTimeout(function(t,e,o){var i=this,s=this.getEntity(t,this.dataEntity.otherName).textContent;this.domNods.toolTip.innerText=s;var n=this.getTextMaxWidth();if(!this.domNods.toolTip.getAttribute("style").includes("visible")&&n<=this.domNods.toolTip.clientWidth){var a=window.innerWidth-e+25,r=o+25;this.domNods.toolTip.style="isibility: visible; right: ".concat(a,"px; top: ").concat(r,"px;"),setTimeout((function(){i.domNods.toolTip.style="visibility: collapse"}),7e3)}else this.domNods.toolTip.style="visibility: collapse"}.bind(this,e,o,i),500)}},{key:"hideBasketToolTip",value:function(t){clearTimeout(this.toolTipTimer),t.target.getAttribute("data-entity")===t.currentTarget.getAttribute("data-entity")&&(this.domNods.toolTip.style="visibility: collapse")}},{key:"moveItemsToBusket",value:(r=i(e().mark((function t(o){var i;return e().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=this.basketSelectedAitems.map((function(t){return{ID:t.ID,PRODUCT_ID:t.PRODUCT_ID}})),this.domNods.toolTip.style="visibility: collapse",t.next=4,this.sendRequest("MOVE_ITEMS_TO_ANOTHER_BASKET",{ID:o},i);case 4:this.notification.moveBasketItems=this.basketSelectedAitems.map((function(t){return t.NAME})),this.recalculateBasket(),BX.onCustomEvent("OnBasketChangeAfterMove");case 7:case"end":return t.stop()}}),t,this)}))),function(t){return r.apply(this,arguments)})},{key:"createNewBasketNotification",value:function(t,e){var o=this.createNotificationText(BX.message.SOTBIT_BULTIBASKET_NEW_BASKET_CREATED),i=this.createNotificationBasketColor(t),s=this.createNotificationText(e||"");this.domNods.multibasketNotification.appendChild(o),this.domNods.multibasketNotification.appendChild(i),this.domNods.multibasketNotification.appendChild(s)}},{key:"createNotificationBasketColor",value:function(t){var e=document.createElement("span"),o=document.createElement("span"),i=getComputedStyle(this.domNods.multibasketNotificationWrapper).backgroundColor;o.setAttribute("style","color: ".concat(i)),o.innerText="1";var s=document.createElement("span");return s.classList.add("notification__basket_color"),s.setAttribute("style","background-color: #".concat(t,"; color: #").concat(t,"; border-radius: 4px;")),s.innerText="111",e.append(o.cloneNode(!0)),e.append(s),e.append(o),e}},{key:"createNotificationText",value:function(t,e){var o=t||"",i=document.createElement("span");return i.innerHTML=o,e&&i.setAttribute("style","white-space: nowrap;"),i}}],a&&s(o.prototype,a),Object.defineProperty(o,"prototype",{writable:!1}),t}();BX.namespace("Sotbit.MultibasketComponent"),BX.Sotbit.MultibasketComponent.class=r}();