function OfferlistPriceListAdd(t){SweetAlert.initComponents(),this.params=t,!0!==this.params.AJAX_CALL||this.params.ORDER?(new ProductsPriceLIst(this.params.ORDER),this.initFormAction()):this.initGetComponent()}function ProductsPriceLIst(t){this.actualProduct={},this.dataProduct={},this.productRowElement={},this.totalSumWrap=document.querySelector('[data-entity="total-sum"]'),this.inputAllMargin=document.querySelector('[data-entity="margin-all"]'),this.buttonToggleSignMargin=document.querySelector('[data-entity="toggle-margin-all"]'),this.currency=t.ORDER_FIELDS.CURRENCY,BX.Currency.loadCurrencyFormat(this.currency),t.BASKET_ITEMS.forEach((t=>this.initProductAction(t))),this.initAllMarginProducts()}OfferlistPriceListAdd.prototype={initGetComponent:function(){this.btnGetComponent=document.getElementById(this.params.BUTTON_GET_COMPONENT),document.body.append(document.getElementById(this.params.RESULT_BLOCK)),this.btnGetComponent&&this.btnGetComponent.addEventListener("click",(()=>{BX.showWait(),BX.ajax.runComponentAction("sotbit:offerlist.pricelist.add","getComponentAjax",{mode:"class",signedParameters:this.params.signedParameters,data:{sotbit_set_site_template:this.params.templateSigns}}).then((t=>{BX.closeWait(),document.getElementById(this.params.RESULT_BLOCK).innerHTML=t.data.html,BX.ajax.processScripts(BX.processHTML(t.data.html,!1).SCRIPT),document.querySelector('[data-bs-target="#'+this.params.MODAL+'"]').click()}),(t=>{BX.closeWait(),"no_item"===t.errors[0].code?SweetAlert.showError(t.errors[0].message):SweetAlert.showError(t.errors.map((t=>t.message)).join("\n"))}))}))},initFormAction:function(){this.formAdd=document.getElementById(this.params.FORM_ADD),this.formAdd.addEventListener("submit",(t=>{t.preventDefault();var e=new FormData(t.target);BX.showWait(),BX.ajax.runComponentAction("sotbit:offerlist.pricelist.add","addPriceList",{mode:"class",signedParameters:this.params.signedParameters,data:e}).then((t=>{BX.closeWait(),t.data.detail_page_url&&window.location.assign(t.data.detail_page_url)}),(t=>{BX.closeWait(),SweetAlert.showError(t.data)}))}))}},ProductsPriceLIst.prototype={initProductAction:function(t){this.initActualProduct(t),this.saveProductData(t);const e=document.querySelector(`[data-entity="product"][data-id="${t.PRODUCT_ID}"]`);this.productRowElement[t.PRODUCT_ID]={productId:t.PRODUCT_ID,quantity:e.querySelector('[data-entity="quantity"]'),price:e.querySelector('[data-entity="price"]'),total:e.querySelector('[data-entity="total"]'),margin:e.querySelector('[data-entity="margin"]'),toggleMargin:e.querySelector('[data-entity="toggle-margin"]')},this.productRowElement[t.PRODUCT_ID].quantity.addEventListener("input",(e=>this.changeQuantity(t.PRODUCT_ID,e.target.value))),this.productRowElement[t.PRODUCT_ID].price.addEventListener("input",(e=>this.changePrice(t.PRODUCT_ID,e.target.value))),this.productRowElement[t.PRODUCT_ID].margin.addEventListener("input",(e=>{this.setSignNumberForGreateOrLassNull(this.actualProduct[t.PRODUCT_ID].MARGIN,e.target.value,this.productRowElement[t.PRODUCT_ID].toggleMargin),this.changeMargin(t.PRODUCT_ID,e.target.value)})),this.productRowElement[t.PRODUCT_ID].toggleMargin.addEventListener("click",(()=>this.toggleMargin(t.PRODUCT_ID,this.productRowElement[t.PRODUCT_ID].toggleMargin)))},initAllMarginProducts:function(){this.inputAllMargin.addEventListener("input",(t=>{this.setSignNumberForGreateOrLassNull(t.target.dataset.prevValue,t.target.value,this.buttonToggleSignMargin);for(let e of Object.values(this.productRowElement))this.setSignNumberForGreateOrLassNull(this.actualProduct[e.productId].MARGIN,t.target.value,e.toggleMargin),this.changeMargin(e.productId,t.target.value);t.target.dataset.prevValue=t.target.value})),this.buttonToggleSignMargin.addEventListener("click",(()=>{let t="minus"===this.buttonToggleSignMargin.dataset.numberSign?"plus":"minus";this.inputAllMargin.value=-this.inputAllMargin.value,this.changeSignNumberMargin(this.buttonToggleSignMargin,t);for(let e of Object.values(this.productRowElement))this.changeSignNumberMargin(e.toggleMargin,t),this.changeMargin(e.productId,this.inputAllMargin.value)}))},changeMargin:function(t,e){this.actualProduct[t].MARGIN=e,this.actualProduct[t].PRICE=e/100*this.dataProduct[t].PRICE+this.dataProduct[t].PRICE,this.changeProductRow(t)},changeQuantity:function(t,e){e=Number(e),this.actualProduct[t].QUANTITY=e,this.changeProductRow(t)},changePrice:function(t,e){((e=Number(e.replace(/\s+/g,"")))||0===e)&&(this.actualProduct[t].PRICE=e,this.actualProduct[t].MARGIN=(this.actualProduct[t].PRICE-this.dataProduct[t].PRICE)/this.dataProduct[t].PRICE*100,this.changeProductRow(t))},changeProductRow:function(t){this.actualProduct[t].TOTAL=this.actualProduct[t].QUANTITY*this.actualProduct[t].PRICE,this.productRowElement[t].quantity.value=this.actualProduct[t].QUANTITY,this.productRowElement[t].margin.value=Math.round(100*parseFloat(this.actualProduct[t].MARGIN||0))/100,this.productRowElement[t].price.value=this.htmlEntityDecode(BX.Currency.currencyFormat(this.actualProduct[t].PRICE,this.actualProduct[t].CURRENCY,!1)),this.productRowElement[t].total.innerHTML=BX.Currency.currencyFormat(this.actualProduct[t].TOTAL,this.actualProduct[t].CURRENCY,!0);let e=0;for(let t in this.actualProduct)e+=this.actualProduct[t].TOTAL;this.totalSumWrap.innerHTML=BX.Currency.currencyFormat(e,this.currency,!0)},htmlEntityDecode:function(t){let e=document.createElement("div"),a="";return e.innerHTML=t,a=e.textContent,e.textContent="",a},toggleMargin:function(t,e){let a="minus"===e.dataset.numberSign?"plus":"minus";this.changeSignNumberMargin(e,a),this.changeMargin(t,-this.actualProduct[t].MARGIN)},changeSignNumberMargin:function(t,e){t.dataset.numberSign=e,t.firstElementChild.classList=`ph-${e}`},setSignNumberForGreateOrLassNull:function(t,e,a){t<=0&&e>0?this.changeSignNumberMargin(a,"plus"):t>=0&&e<0&&this.changeSignNumberMargin(a,"minus")},saveProductData:function(t){this.dataProduct[t.PRODUCT_ID]={PRICE:Number(t.PRICE.replace(/\s+/g,""))}},initActualProduct:function(t){this.actualProduct[t.PRODUCT_ID]={QUANTITY:t.QUANTITY,PRICE:Number(t.PRICE.replace(/\s+/g,"")),TOTAL:Number(t.TOTAL),CURRENCY:t.CURRENCY,MARGIN:0}}};