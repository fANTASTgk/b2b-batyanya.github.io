class RegionsChoose{constructor(){this.getRegion(),this.rootId="regions_choose_component",this.rootDropDownId="regions_choose_component_dropdown",this.selectRegionID="regions_choose_select-city__modal",this.questionRegionId=null,this.loctionList=null,this.root=document.getElementById(this.rootId),this.rootDropDown=document.getElementById(this.rootDropDownId),this.selectRegion=document.getElementById(this.selectRegionID),this.setEvents()}getEntity(t,e,i=!1){return t&&e?i?t.querySelectorAll('[data-entity="'+e+'"]'):t.querySelector('[data-entity="'+e+'"]'):null}setEvents(){document.body.appendChild(this.selectRegion);const t=this.getEntity(this.rootDropDown,"select-city__dropdown__choose__yes"),e=this.getEntity(this.rootDropDown,"select-city__dropdown__choose__no"),i=this.getEntity(this.selectRegion,"select-city__modal__submit__input"),o=this.getEntity(this.selectRegion,"select-city__modal__submit__btn");t.addEventListener("click",(()=>this.onSetRegion(this.questionRegionId))),e.addEventListener("click",(()=>this.onShowALLRegions())),this.root.addEventListener("click",(()=>this.onShowALLRegions())),i.addEventListener("input",(t=>this.onInputSearch(t))),o.addEventListener("click",(()=>{const t=Object.keys(this.loctionList).filter((t=>i.value===this.loctionList[t]));0!==t.length?(this.onSetRegion(t[0]),this.onShowALLRegions(!1)):this.getEntity(this.selectRegion,"select-city__modal__submit__block-wrap__input_wrap_error").setAttribute("style","")})),new MutationObserver((t=>{t.forEach((t=>{"attributes"===t.type&&"class"===t.attributeName&&this.toggleCity()}))})).observe(this.selectRegion,{attributes:!0,characterDataOldValue:!0})}onSetRegion(t){BX.ajax.runAction("sotbit:regions.ChooseComponentController.setRegion",{data:{regionId:t}}).then((t=>t.data.actions.forEach((e=>this[e](t.data)))),(t=>{}))}dropDownShow(t){t?this.rootDropDown.setAttribute("style","display: block;"):this.rootDropDown.setAttribute("style","display: none;")}onShowALLRegions(){if(null!==this.loctionList)return this.SHOW_SELECT_REGIONS(this.loctionList);BX.ajax.runAction("sotbit:regions.ChooseComponentController.showLocations",{}).then((t=>t.data.actions.forEach((e=>this[e](t.data)))),(t=>{}))}getRegion(){const t=new URLSearchParams(window.location.search);this.removeRegionGetParams(t),BX.ajax.runAction("sotbit:regions.ChooseComponentController.getRegion",{data:{redirectRegionId:t.get("redirectRegionId")}}).then((t=>t.data.actions.forEach((e=>this[e](t.data)))),(t=>{}))}SHOW_REGION_NAME({currentRegionName:t}){this.getEntity(this.root,"select-city__block__text-city").innerText=t,this.getEntity(this.selectRegion,"select-city__js").innerText=t}SHOW_QUESTION({currentRegionName:t,currentRegionId:e}){this.questionRegionId=e,this.dropDownShow(!0);const i=this.getEntity(this.rootDropDown,"select-city__dropdown__title");i.innerText=i.textContent.replace("###",t).trim()}CONFIRM_DOMAIN({currentRegionName:t}){this.dropDownShow(!1);this.getEntity(this.root,"select-city__block__text-city").innerText=t,this.getEntity(this.selectRegion,"select-city__js").innerText=t}SHOW_SELECT_REGIONS({allRegions:t}){if(null!==this.loctionList)return;const e=this.getEntity(this.selectRegion,"select-city__modal__list");this.loctionList=t;let i=0;for(let o in t){const n=document.createElement("li");if(n.setAttribute("data-entity","select-city__modal__list__item"),n.setAttribute("class","select-city__modal__list__item"),n.innerText=t[o],n.addEventListener("click",(()=>{this.onSetRegion(o)})),e.append(n),i++,i>14)return}}REDIRECT_TO_SUBDOMAIN({currentRegionCode:t,currentRegionId:e}){const i=window.location.hostname,o=window.location.protocol,n=window.location.href.replace(i,t),s=new URL(n,`${o}${t}`);s.searchParams.set("redirectRegionId",e),window.location.href=s.toString()}CONFIRM_CITY({}){}onInputSearch(t){const e="regions_vars";this.getEntity(this.selectRegion,e,!0).forEach((t=>t.remove()));const i=t.currentTarget.value,o=this.getEntity(this.selectRegion,"select-city__modal__submit__vars");if(this.getEntity(this.selectRegion,"select-city__modal__submit__block-wrap__input_wrap_error").setAttribute("style","display: none;"),i.length<2)return void o.setAttribute("style","display: none;");const n=t.currentTarget,s=Object.keys(this.loctionList).filter((t=>new RegExp("^"+i,"i").test(this.loctionList[t])));s.length>0?o.setAttribute("style","display: block;"):o.setAttribute("style","display: none;"),s.forEach((t=>{const s=document.createElement("div");s.setAttribute("data-entity",e),s.setAttribute("class",e),s.setAttribute("tabindex",0),s.innerHTML="<b>"+this.loctionList[t].slice(0,i.length)+"</b>"+this.loctionList[t].slice(i.length),s.addEventListener("click",(()=>{n.value=this.loctionList[t],this.getEntity(this.selectRegion,e,!0).forEach((t=>t.remove())),o.setAttribute("style","display: none;")})),o.append(s)}))}removeRegionGetParams(t){if(t.has("redirectRegionId")){const t=new URL(window.location.href,window.location.href);t.searchParams.delete("redirectRegionId"),window.history.replaceState(null,"",t)}}toggleCity(){this.getEntity(this.root,"select-city").classList.toggle("show")}}